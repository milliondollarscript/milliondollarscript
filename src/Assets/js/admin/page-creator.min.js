(d=>{let e={config:{currentStep:1,totalSteps:5,selectedPageTypes:[],previewData:null,configurationLoadTimeout:null},init:function(){this.bindEvents(),this.initializeSteps(),this.loadInitialState()},bindEvents:function(){d(document).on("change",'input[name="implementation_type"]',this.handleImplementationTypeChange.bind(this)),d(document).on("change",'input[name="page_types[]"]',this.handlePageTypeChange.bind(this)),d(document).on("change",'input[name="create_mode"]',this.handleCreateModeChange.bind(this)),d("#mds-quick-create-all").on("click",this.handleQuickCreateAll.bind(this)),d("#mds-grid-sort-type-btn").on("click",this.handleGridSortType.bind(this)),d("#mds-grid-sort-direction-btn").on("click",this.handleGridSortDirection.bind(this)),d("#mds-preview-creation").on("click",this.handlePreviewCreation.bind(this)),d("#mds-create-pages, #mds-create-pages-bottom").on("click",this.handleCreatePages.bind(this)),d("#mds-page-creator-form").on("submit",this.handleFormSubmit.bind(this)),d(document).on("click",".mds-modal-close, #mds-modal-ok",this.hideModal.bind(this)),d(document).on("click",".mds-modal-overlay",this.hideModal.bind(this)),d(document).on("keydown",this.handleModalKeydown.bind(this)),d(document).on("click",".mds-step-nav",this.handleStepNavigation.bind(this))},initializeSteps:function(){d(".mds-creator-step").each(function(e){0===e?d(this).addClass("active"):d(this).addClass("inactive")})},loadInitialState:function(){this.updateSelectedPageTypes(),this.loadPageConfigurations(),this.initializeCreateModeSelection(),this.performGridSort()},handleImplementationTypeChange:function(e){var t=d(e.target).val();this.updateImplementationInfo(t),this.updateCreateButton(),this.config.previewData&&d("#mds-preview-panel").is(":visible")&&this.handlePreviewCreation(e)},handlePageTypeChange:function(e){this.updateSelectedPageTypes(),this.config.configurationLoadTimeout&&clearTimeout(this.config.configurationLoadTimeout),this.config.configurationLoadTimeout=setTimeout(()=>{this.loadPageConfigurations()},300),this.updateCreateButton()},handleCreateModeChange:function(e){d(e.target).val();d(".mds-create-mode-option").removeClass("selected"),d(e.target).closest(".mds-create-mode-option").addClass("selected"),this.config.previewData&&d("#mds-preview-panel").is(":visible")&&this.handlePreviewCreation(e)},initializeCreateModeSelection:function(){var e=d('input[name="create_mode"]:checked');0<e.length&&(d(".mds-create-mode-option").removeClass("selected"),e.closest(".mds-create-mode-option").addClass("selected"))},handleQuickCreateAll:function(e){e.preventDefault(),d('input[name="implementation_type"][value="block"]').prop("checked",!0).trigger("change"),d('input[name="page_types[]"]').prop("checked",!0).trigger("change"),setTimeout(()=>{this.goToStep(5);var e=d('.mds-creator-step[data-step="5"]');0<e.length&&d("html, body").animate({scrollTop:e.offset().top-100},800),this.startPreviewButtonBlink()},500)},handleGridSortType:function(e){e.preventDefault();let t=d(e.currentTarget);0!==t.length&&(e="id"===t.data("sort-by")?"name":"id",t.data("sort-by",e),t.find(".sort-label").text(e.toUpperCase()),t.addClass("active"),setTimeout(()=>{t.removeClass("active")},200),this.performGridSort())},handleGridSortDirection:function(e){e.preventDefault();let t=d(e.currentTarget);var a,i;0!==t.length&&(e="asc"===t.data("sort-direction")?"desc":"asc",t.data("sort-direction",e),a=t.find(".sort-direction"),i=t.find(".sort-direction-label"),"asc"==e?(a.removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up"),i.text("ASC")):(a.removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down"),i.text("DESC")),t.addClass("active"),setTimeout(()=>{t.removeClass("active")},200),this.performGridSort())},performGridSort:function(){var e=d("#mds-grid-sort-type-btn"),t=d("#mds-grid-sort-direction-btn");0!==e.length&&0!==t.length&&(e=e.data("sort-by"),t=t.data("sort-direction"),this.sortGridOptions(e,t))},sortGridOptions:function(n,o){let t=d("#mds-grid-selector");var e,a,i;0!==t.length&&(a=t.find("option"),e=t.val(),0!==(a=a.filter(function(){return d(this).val()&&""!==d(this).val()})).length)&&((i=a.toArray()).sort((e,t)=>{let a,i,s=(i="id"===n?(a=parseInt(d(e).val())||0,parseInt(d(t).val())||0):(a=d(e).text().toLowerCase(),d(t).text().toLowerCase()),0);return a>i?s=1:a<i&&(s=-1),"asc"===o?s:-s}),a.remove(),i.forEach(e=>{t.append(e)}),e)&&0<t.find(`option[value="${e}"]`).length&&t.val(e)},updateSelectedPageTypes:function(){this.config.selectedPageTypes=[],d('input[name="page_types[]"]:checked').each((e,t)=>{this.config.selectedPageTypes.push(d(t).val())})},loadPageConfigurations:function(){var e;0===this.config.selectedPageTypes.length?d("#mds-page-configurations").empty():(e={action:"mds_get_page_configuration",nonce:mdsPageCreator.nonce,page_types:this.config.selectedPageTypes},d("#mds-page-configurations").html('<div class="mds-loading">Loading configurations...</div>'),d.post(mdsPageCreator.ajaxUrl,e).done(e=>{e.success?(d("#mds-page-configurations").html(e.data.html),this.initializeConfigurationFields()):this.showError("Failed to load page configurations")}).fail(()=>{this.showError("Network error loading configurations")}))},initializeConfigurationFields:function(){d(".mds-page-config select").each(function(){}),d('.mds-page-config input[type="number"]').on("change",function(){var e=parseFloat(d(this).attr("min")),t=parseFloat(d(this).attr("max")),a=parseFloat(d(this).val());!isNaN(e)&&a<e&&d(this).val(e),!isNaN(t)&&t<a&&d(this).val(t)})},handlePreviewCreation:function(e){e.preventDefault(),this.stopPreviewButtonBlink();var e=this.getFormData();this.validateFormData(e)&&(d("#mds-preview-creation").prop("disabled",!0).text(mdsPageCreator.strings.preview),e={action:"mds_get_creation_preview",nonce:mdsPageCreator.nonce,...e},d.post(mdsPageCreator.ajaxUrl,e).done(e=>{e.success?(this.config.previewData=e.data,this.displayPreview(e.data),d("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!1)):this.showError(e.data||"Preview generation failed")}).fail(()=>{this.showError("Network error generating preview")}).always(()=>{d("#mds-preview-creation").prop("disabled",!1).text("Preview Creation")}))},handleCreatePages:function(e){e.preventDefault();let t=this.getFormData();if(this.validateFormData(t)){let e=mdsPageCreator.strings.confirm_create;"update_existing"===t.create_mode&&(e=mdsPageCreator.strings.confirm_update),"undefined"!=typeof MDSModalUtility?MDSModalUtility.confirm(e,()=>{this.processCreatePages(t)}):confirm(e)&&this.processCreatePages(t)}},processCreatePages:function(e){d("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!0).text(mdsPageCreator.strings.creating);e={action:"mds_creator_create_pages",nonce:mdsPageCreator.nonce,...e};d.post(mdsPageCreator.ajaxUrl,e).done(e=>{e.success?(this.displayResults(e.data),this.showSuccess(mdsPageCreator.strings.success)):this.showError(e.data||"Page creation failed")}).fail((e,t,a)=>{this.showError("Network error creating pages: "+a)}).always(()=>{d("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!1).text("Create Pages")})},handleFormSubmit:function(e){e.preventDefault(),this.handleCreatePages(e)},getFormData:function(){let i={};return i.implementation_type=d('input[name="implementation_type"]:checked').val(),i.page_types=[],d('input[name="page_types[]"]:checked').each(function(){i.page_types.push(d(this).val())}),i.create_mode=d('input[name="create_mode"]:checked').val()||"create_new",i.selected_grid_id=d("#mds-grid-selector").val(),i.configurations={},d(".mds-page-config").each(function(){let a=d(this).data("page-type");i.configurations[a]={},d(this).find("input, select, textarea").each(function(){var e,t=d(this).attr("name");t&&t.includes(`[${a}]`)&&(e=t.match(/\[([^\]]+)\]$/)[1],"checkbox"===d(this).attr("type")?t.includes("[]")?(i.configurations[a][e]||(i.configurations[a][e]=[]),d(this).is(":checked")&&i.configurations[a][e].push(d(this).val())):i.configurations[a][e]=d(this).is(":checked"):i.configurations[a][e]=d(this).val())})}),i},validateFormData:function(e){return e.implementation_type?!(!e.page_types||0===e.page_types.length)||(this.showError("Please select at least one page type"),!1):(this.showError("Please select an implementation type"),!1)},displayPreview:function(e){let a='<div class="mds-preview-summary">';a=(a+=`<p><strong>Pages to create:</strong> ${e.pages_to_create.length}</p>`)+`<p><strong>Estimated time:</strong> ${e.estimated_time} seconds</p>`+"</div>",e.warnings&&0<e.warnings.length&&(a=(a+='<div class="mds-preview-warnings">')+"<h4>Warnings:</h4><ul>",e.warnings.forEach(e=>{a+=`<li>${e}</li>`}),a+="</ul></div>"),e.recommendations&&0<e.recommendations.length&&(a=(a+='<div class="mds-preview-recommendations">')+"<h4>Recommendations:</h4><ul>",e.recommendations.forEach(e=>{a+=`<li>${e}</li>`}),a+="</ul></div>"),a=(a=(a+='<div class="mds-preview-pages">')+'<h4>Pages to be created:</h4><table class="wp-list-table widefat fixed striped">')+"<thead><tr><th>Page Type</th><th>Title</th><th>Implementation</th><th>Status</th><th>Existing Page Details</th></tr></thead><tbody>",e.pages_to_create.forEach(e=>{a=(a=(a=(a=(a+="<tr>")+`<td><strong>${e.page_type}</strong></td>`)+`<td>${e.title}</td>`)+`<td>${e.implementation_type}</td>`)+`<td>${e.status||(e.existing_page?"Will update existing":"Will create new")}</td>`;let t="";e.existing_page_data?(e=e.existing_page_data,t=(t=(t=(t+='<div class="mds-existing-page-info">')+`<div><strong>ID:</strong> ${e.id}</div>`)+`<div><strong>Title:</strong> "${e.title}"</div>`)+`<div><strong>Status:</strong> ${e.status}</div>`,e.date_modified&&(t+=`<div><strong>Modified:</strong> ${e.date_modified}</div>`),e.author&&(t+=`<div><strong>Author:</strong> ${e.author}</div>`),t+='<div class="mds-page-links">',e.url&&(t+=`<a href="${e.url}" target="_blank" class="button button-small">View Page</a> `),e.edit_link&&(t+=`<a href="${e.edit_link}" target="_blank" class="button button-small">Edit Page</a>`),t+="</div></div>"):t="<em>No existing page</em>",a=a+`<td>${t}</td>`+"</tr>"}),a=(a+="</tbody>")+"</table></div>",d("#mds-preview-content").html(a),d("#mds-preview-panel").show(),0<d("#mds-preview-panel").length&&d("html, body").animate({scrollTop:d("#mds-preview-panel").offset().top-50},600)},displayResults:function(e){let t='<div class="mds-results-summary">';t=(t=(t+=`<p><strong>Created:</strong> ${e.total_created} pages</p>`)+`<p><strong>Updated:</strong> ${e.total_updated} pages</p>`)+`<p><strong>Errors:</strong> ${e.total_errors}</p>`+"</div>",e.created_pages&&0<e.created_pages.length&&(t=(t+='<div class="mds-results-created">')+"<h4>Created Pages:</h4><ul>",e.created_pages.forEach(e=>{t+=`<li><a href="${e.page_url}" target="_blank">${e.page_title}</a> (${e.page_type})</li>`}),t+="</ul></div>"),e.updated_pages&&0<e.updated_pages.length&&(t=(t+='<div class="mds-results-updated">')+"<h4>Updated Pages:</h4><ul>",e.updated_pages.forEach(e=>{t+=`<li><a href="${e.page_url}" target="_blank">${e.page_title}</a> (${e.page_type})</li>`}),t+="</ul></div>"),e.errors&&0<e.errors.length&&(t=(t+='<div class="mds-results-errors">')+"<h4>Errors:</h4><ul>",e.errors.forEach(e=>{t+=`<li class="error">${e}</li>`}),t+="</ul></div>"),d("#mds-results-content").html(t),d("#mds-results-panel").show(),0<d("#mds-results-panel").length&&d("html, body").animate({scrollTop:d("#mds-results-panel").offset().top},500)},updateImplementationInfo:function(e){d(".mds-implementation-option").removeClass("selected"),d(`input[value="${e}"]`).closest(".mds-implementation-option").addClass("selected")},updateCreateButton:function(){var e=0<d('input[name="page_types[]"]:checked').length,t=0<d('input[name="implementation_type"]:checked').length,e=e&&t;d("#mds-preview-creation").prop("disabled",!e),e&&!d("#mds-preview-creation").hasClass("blinking")&&this.startPreviewButtonBlink()},startPreviewButtonBlink:function(){var e=d("#mds-preview-creation");e.prop("disabled")||e.hasClass("blinking")||e.addClass("blinking")},stopPreviewButtonBlink:function(){d("#mds-preview-creation").removeClass("blinking")},showModal:function(e,t,a,i){var s=d("#mds-notification-modal"),n=d("#mds-modal-icon"),o=d("#mds-modal-title"),r=d("#mds-modal-message");n.removeClass("error success warning info").addClass(e);n.attr("data-icon",{error:"✕",success:"✓",warning:"!",info:"i"}[e]||"i"),o.text(t),r.html(a),s.fadeIn(200),s.data("callback",i),setTimeout(()=>{d("#mds-modal-ok").focus()},250)},hideModal:function(){var e=d("#mds-notification-modal"),t=e.data("callback");e.fadeOut(200),"function"==typeof t&&setTimeout(t,200)},showError:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.error(e,t):this.showModal("error","Error",e,t)},showSuccess:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.success(e,t):this.showModal("success","Success",e,t)},showWarning:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.warning(e,t):this.showModal("warning","Warning",e,t)},showInfo:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.info(e,t):this.showModal("info","Information",e,t)},handleModalKeydown:function(e){!d("#mds-notification-modal").is(":visible")||"Escape"!==e.key&&"Enter"!==e.key||(e.preventDefault(),this.hideModal())},handleStepNavigation:function(e){e.preventDefault();e=d(e.target).data("step");this.goToStep(e)},goToStep:function(e){e<1||e>this.config.totalSteps||(d(".mds-creator-step").removeClass("active").addClass("inactive"),d(`.mds-creator-step[data-step="${e}"]`).removeClass("inactive").addClass("active"),this.config.currentStep=e)}};d(document).ready(function(){0<d(".mds-create-pages").length&&e.init()})})(jQuery);