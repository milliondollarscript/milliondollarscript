!function(e){"use strict";const t={config:{currentStep:1,totalSteps:5,selectedPageTypes:[],previewData:null,configurationLoadTimeout:null},init:function(){this.bindEvents(),this.initializeSteps(),this.loadInitialState()},bindEvents:function(){e(document).on("change",'input[name="implementation_type"]',this.handleImplementationTypeChange.bind(this)),e(document).on("change",'input[name="page_types[]"]',this.handlePageTypeChange.bind(this)),e(document).on("change",'input[name="create_mode"]',this.handleCreateModeChange.bind(this)),e("#mds-quick-create-all").on("click",this.handleQuickCreateAll.bind(this)),e("#mds-grid-sort-type-btn").on("click",this.handleGridSortType.bind(this)),e("#mds-grid-sort-direction-btn").on("click",this.handleGridSortDirection.bind(this)),e("#mds-preview-creation").on("click",this.handlePreviewCreation.bind(this)),e("#mds-create-pages, #mds-create-pages-bottom").on("click",this.handleCreatePages.bind(this)),e("#mds-page-creator-form").on("submit",this.handleFormSubmit.bind(this)),e(document).on("click",".mds-modal-close, #mds-modal-ok",this.hideModal.bind(this)),e(document).on("click",".mds-modal-overlay",this.hideModal.bind(this)),e(document).on("keydown",this.handleModalKeydown.bind(this)),e(document).on("click",".mds-step-nav",this.handleStepNavigation.bind(this))},initializeSteps:function(){e(".mds-creator-step").each((function(t){0===t?e(this).addClass("active"):e(this).addClass("inactive")}))},loadInitialState:function(){this.updateSelectedPageTypes(),this.loadPageConfigurations(),this.initializeCreateModeSelection(),this.performGridSort()},handleImplementationTypeChange:function(t){const a=e(t.target).val();this.updateImplementationInfo(a),this.updateCreateButton(),this.config.previewData&&e("#mds-preview-panel").is(":visible")&&this.handlePreviewCreation(t)},handlePageTypeChange:function(e){this.updateSelectedPageTypes(),this.config.configurationLoadTimeout&&clearTimeout(this.config.configurationLoadTimeout),this.config.configurationLoadTimeout=setTimeout((()=>{this.loadPageConfigurations()}),300),this.updateCreateButton()},handleCreateModeChange:function(t){e(t.target).val();e(".mds-create-mode-option").removeClass("selected"),e(t.target).closest(".mds-create-mode-option").addClass("selected"),this.config.previewData&&e("#mds-preview-panel").is(":visible")&&this.handlePreviewCreation(t)},initializeCreateModeSelection:function(){const t=e('input[name="create_mode"]:checked');t.length>0&&(e(".mds-create-mode-option").removeClass("selected"),t.closest(".mds-create-mode-option").addClass("selected"))},handleQuickCreateAll:function(t){t.preventDefault(),e('input[name="implementation_type"][value="block"]').prop("checked",!0).trigger("change"),e('input[name="page_types[]"]').prop("checked",!0).trigger("change"),setTimeout((()=>{this.goToStep(5);const t=e('.mds-creator-step[data-step="5"]');t.length>0&&e("html, body").animate({scrollTop:t.offset().top-100},800),this.startPreviewButtonBlink()}),500)},handleGridSortType:function(t){t.preventDefault();const a=e(t.currentTarget);if(0===a.length)return;const i="id"===a.data("sort-by")?"name":"id";a.data("sort-by",i);a.find(".sort-label").text(i.toUpperCase()),a.addClass("active"),setTimeout((()=>{a.removeClass("active")}),200),this.performGridSort()},handleGridSortDirection:function(t){t.preventDefault();const a=e(t.currentTarget);if(0===a.length)return;const i="asc"===a.data("sort-direction")?"desc":"asc";a.data("sort-direction",i);const s=a.find(".sort-direction"),n=a.find(".sort-direction-label");"asc"===i?(s.removeClass("dashicons-arrow-down").addClass("dashicons-arrow-up"),n.text("ASC")):(s.removeClass("dashicons-arrow-up").addClass("dashicons-arrow-down"),n.text("DESC")),a.addClass("active"),setTimeout((()=>{a.removeClass("active")}),200),this.performGridSort()},performGridSort:function(){const t=e("#mds-grid-sort-type-btn"),a=e("#mds-grid-sort-direction-btn");if(0===t.length||0===a.length)return;const i=t.data("sort-by"),s=a.data("sort-direction");this.sortGridOptions(i,s)},sortGridOptions:function(t,a){const i=e("#mds-grid-selector");if(0===i.length)return;const s=i.find("option"),n=i.val(),o=s.filter((function(){return e(this).val()&&""!==e(this).val()}));if(0===o.length)return;const r=o.toArray();r.sort(((i,s)=>{let n,o;"id"===t?(n=parseInt(e(i).val())||0,o=parseInt(e(s).val())||0):(n=e(i).text().toLowerCase(),o=e(s).text().toLowerCase());let r=0;return n>o?r=1:n<o&&(r=-1),"asc"===a?r:-r})),o.remove(),r.forEach((e=>{i.append(e)})),n&&i.find(`option[value="${n}"]`).length>0&&i.val(n)},updateSelectedPageTypes:function(){this.config.selectedPageTypes=[],e('input[name="page_types[]"]:checked').each(((t,a)=>{this.config.selectedPageTypes.push(e(a).val())}))},loadPageConfigurations:function(){if(0===this.config.selectedPageTypes.length)return void e("#mds-page-configurations").empty();const t={action:"mds_get_page_configuration",nonce:mdsPageCreator.nonce,page_types:this.config.selectedPageTypes};e("#mds-page-configurations").html('<div class="mds-loading">Loading configurations...</div>'),e.post(mdsPageCreator.ajaxUrl,t).done((t=>{t.success?(e("#mds-page-configurations").html(t.data.html),this.initializeConfigurationFields()):this.showError("Failed to load page configurations")})).fail((()=>{this.showError("Network error loading configurations")}))},initializeConfigurationFields:function(){e(".mds-page-config select").each((function(){})),e('.mds-page-config input[type="number"]').on("change",(function(){const t=parseFloat(e(this).attr("min")),a=parseFloat(e(this).attr("max")),i=parseFloat(e(this).val());!isNaN(t)&&i<t&&e(this).val(t),!isNaN(a)&&i>a&&e(this).val(a)}))},handlePreviewCreation:function(t){t.preventDefault(),this.stopPreviewButtonBlink();const a=this.getFormData();if(!this.validateFormData(a))return;e("#mds-preview-creation").prop("disabled",!0).text(mdsPageCreator.strings.preview);const i={action:"mds_get_creation_preview",nonce:mdsPageCreator.nonce,...a};e.post(mdsPageCreator.ajaxUrl,i).done((t=>{t.success?(this.config.previewData=t.data,this.displayPreview(t.data),e("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!1)):this.showError(t.data||"Preview generation failed")})).fail((()=>{this.showError("Network error generating preview")})).always((()=>{e("#mds-preview-creation").prop("disabled",!1).text("Preview Creation")}))},handleCreatePages:function(e){e.preventDefault();const t=this.getFormData();if(!this.validateFormData(t))return;let a=mdsPageCreator.strings.confirm_create;"update_existing"===t.create_mode&&(a=mdsPageCreator.strings.confirm_update),"undefined"==typeof MDSModalUtility?confirm(a)&&this.processCreatePages(t):MDSModalUtility.confirm(a,(()=>{this.processCreatePages(t)}))},processCreatePages:function(t){e("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!0).text(mdsPageCreator.strings.creating);const a={action:"mds_creator_create_pages",nonce:mdsPageCreator.nonce,...t};e.post(mdsPageCreator.ajaxUrl,a).done((e=>{e.success?(this.displayResults(e.data),this.showSuccess(mdsPageCreator.strings.success)):this.showError(e.data||"Page creation failed")})).fail(((e,t,a)=>{this.showError("Network error creating pages: "+a)})).always((()=>{e("#mds-create-pages, #mds-create-pages-bottom").prop("disabled",!1).text("Create Pages")}))},handleFormSubmit:function(e){e.preventDefault(),this.handleCreatePages(e)},getFormData:function(){const t={};return t.implementation_type=e('input[name="implementation_type"]:checked').val(),t.page_types=[],e('input[name="page_types[]"]:checked').each((function(){t.page_types.push(e(this).val())})),t.create_mode=e('input[name="create_mode"]:checked').val()||"create_new",t.selected_grid_id=e("#mds-grid-selector").val(),t.configurations={},e(".mds-page-config").each((function(){const a=e(this).data("page-type");t.configurations[a]={},e(this).find("input, select, textarea").each((function(){const i=e(this).attr("name");if(i&&i.includes(`[${a}]`)){const s=i.match(/\[([^\]]+)\]$/)[1];"checkbox"===e(this).attr("type")?i.includes("[]")?(t.configurations[a][s]||(t.configurations[a][s]=[]),e(this).is(":checked")&&t.configurations[a][s].push(e(this).val())):t.configurations[a][s]=e(this).is(":checked"):t.configurations[a][s]=e(this).val()}}))})),t},validateFormData:function(e){return e.implementation_type?!(!e.page_types||0===e.page_types.length)||(this.showError("Please select at least one page type"),!1):(this.showError("Please select an implementation type"),!1)},displayPreview:function(t){let a='<div class="mds-preview-summary">';a+=`<p><strong>Pages to create:</strong> ${t.pages_to_create.length}</p>`,a+=`<p><strong>Estimated time:</strong> ${t.estimated_time} seconds</p>`,a+="</div>",t.warnings&&t.warnings.length>0&&(a+='<div class="mds-preview-warnings">',a+="<h4>Warnings:</h4>",a+="<ul>",t.warnings.forEach((e=>{a+=`<li>${e}</li>`})),a+="</ul>",a+="</div>"),t.recommendations&&t.recommendations.length>0&&(a+='<div class="mds-preview-recommendations">',a+="<h4>Recommendations:</h4>",a+="<ul>",t.recommendations.forEach((e=>{a+=`<li>${e}</li>`})),a+="</ul>",a+="</div>"),a+='<div class="mds-preview-pages">',a+="<h4>Pages to be created:</h4>",a+='<table class="wp-list-table widefat fixed striped">',a+="<thead><tr><th>Page Type</th><th>Title</th><th>Implementation</th><th>Status</th><th>Existing Page Details</th></tr></thead>",a+="<tbody>",t.pages_to_create.forEach((e=>{a+="<tr>",a+=`<td><strong>${e.page_type_label||e.page_type}</strong></td>`,a+=`<td>${e.title}</td>`,a+=`<td>${e.implementation_type}</td>`,a+=`<td>${e.status||(e.existing_page?"Will update existing":"Will create new")}</td>`;let t="";if(e.existing_page_data){const a=e.existing_page_data;t+='<div class="mds-existing-page-info">',t+=`<div><strong>ID:</strong> ${a.id}</div>`,t+=`<div><strong>Title:</strong> "${a.title}"</div>`,t+=`<div><strong>Status:</strong> ${a.status}</div>`,a.date_modified&&(t+=`<div><strong>Modified:</strong> ${a.date_modified}</div>`),a.author&&(t+=`<div><strong>Author:</strong> ${a.author}</div>`),t+='<div class="mds-page-links">',a.url&&(t+=`<a href="${a.url}" target="_blank" class="button button-small">View Page</a> `),a.edit_link&&(t+=`<a href="${a.edit_link}" target="_blank" class="button button-small">Edit Page</a>`),t+="</div>",t+="</div>"}else t="<em>No existing page</em>";a+=`<td>${t}</td>`,a+="</tr>"})),a+="</tbody>",a+="</table>",a+="</div>",e("#mds-preview-content").html(a),e("#mds-preview-panel").show(),e("#mds-preview-panel").length>0&&e("html, body").animate({scrollTop:e("#mds-preview-panel").offset().top-50},600)},displayResults:function(t){let a='<div class="mds-results-summary">';a+=`<p><strong>Created:</strong> ${t.total_created} pages</p>`,a+=`<p><strong>Updated:</strong> ${t.total_updated} pages</p>`,a+=`<p><strong>Errors:</strong> ${t.total_errors}</p>`,a+="</div>",t.created_pages&&t.created_pages.length>0&&(a+='<div class="mds-results-created">',a+="<h4>Created Pages:</h4>",a+="<ul>",t.created_pages.forEach((e=>{a+=`<li><a href="${e.page_url}" target="_blank">${e.page_title}</a> (${e.page_type})</li>`})),a+="</ul>",a+="</div>"),t.updated_pages&&t.updated_pages.length>0&&(a+='<div class="mds-results-updated">',a+="<h4>Updated Pages:</h4>",a+="<ul>",t.updated_pages.forEach((e=>{a+=`<li><a href="${e.page_url}" target="_blank">${e.page_title}</a> (${e.page_type})</li>`})),a+="</ul>",a+="</div>"),t.errors&&t.errors.length>0&&(a+='<div class="mds-results-errors">',a+="<h4>Errors:</h4>",a+="<ul>",t.errors.forEach((e=>{a+=`<li class="error">${e}</li>`})),a+="</ul>",a+="</div>"),e("#mds-results-content").html(a),e("#mds-results-panel").show(),e("#mds-results-panel").length>0&&e("html, body").animate({scrollTop:e("#mds-results-panel").offset().top},500)},updateImplementationInfo:function(t){e(".mds-implementation-option").removeClass("selected"),e(`input[value="${t}"]`).closest(".mds-implementation-option").addClass("selected")},updateCreateButton:function(){const t=e('input[name="page_types[]"]:checked').length>0,a=e('input[name="implementation_type"]:checked').length>0,i=t&&a;e("#mds-preview-creation").prop("disabled",!i),i&&!e("#mds-preview-creation").hasClass("blinking")&&this.startPreviewButtonBlink()},startPreviewButtonBlink:function(){const t=e("#mds-preview-creation");t.prop("disabled")||t.hasClass("blinking")||t.addClass("blinking")},stopPreviewButtonBlink:function(){e("#mds-preview-creation").removeClass("blinking")},showModal:function(t,a,i,s){const n=e("#mds-notification-modal"),o=e("#mds-modal-icon"),r=e("#mds-modal-title"),d=e("#mds-modal-message");o.removeClass("error success warning info").addClass(t);o.attr("data-icon",{error:"✕",success:"✓",warning:"!",info:"i"}[t]||"i"),r.text(a),d.html(i),n.fadeIn(200),n.data("callback",s),setTimeout((()=>{e("#mds-modal-ok").focus()}),250)},hideModal:function(){const t=e("#mds-notification-modal"),a=t.data("callback");t.fadeOut(200),"function"==typeof a&&setTimeout(a,200)},showError:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.error(e,t):this.showModal("error","Error",e,t)},showSuccess:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.success(e,t):this.showModal("success","Success",e,t)},showWarning:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.warning(e,t):this.showModal("warning","Warning",e,t)},showInfo:function(e,t){"undefined"!=typeof MDSModalUtility?MDSModalUtility.info(e,t):this.showModal("info","Information",e,t)},handleModalKeydown:function(t){e("#mds-notification-modal").is(":visible")&&("Escape"===t.key||"Enter"===t.key)&&(t.preventDefault(),this.hideModal())},handleStepNavigation:function(t){t.preventDefault();const a=e(t.target).data("step");this.goToStep(a)},goToStep:function(t){t<1||t>this.config.totalSteps||(e(".mds-creator-step").removeClass("active").addClass("inactive"),e(`.mds-creator-step[data-step="${t}"]`).removeClass("inactive").addClass("active"),this.config.currentStep=t)}};e(document).ready((function(){e(".mds-create-pages").length>0&&t.init()}))}(jQuery);