(function($){let ExtensionsPage={init:function(){this.bindEvents(),this.initTabs()},bindEvents:function(){$(".nav-tab").on("click",this.handleTabClick),$(document).on("click",".install-extension",this.handleInstallExtension),$(document).on("click",".activate-extension",this.handleActivateExtension),$(document).on("click",".deactivate-extension",this.handleDeactivateExtension),$(document).on("click",".update-extension",this.handleUpdateExtension),$("#mds-check-updates-btn").on("click",this.handleCheckUpdates)},initTabs:function(){let hash=window.location.hash;if(hash&&$(hash+"-extensions").length)this.showTab(hash.replace("#",""));else this.showTab("available")},handleTabClick:function(e){e.preventDefault();let tab=$(this).attr("href").replace("#","");if(ExtensionsPage.showTab(tab),history.pushState)history.pushState(null,null,"#"+tab)},showTab:function(tab){$(".nav-tab").removeClass("nav-tab-active"),$('.nav-tab[href="#'+tab+'"]').addClass("nav-tab-active"),$(".tab-content").removeClass("active"),$("#"+tab+"-extensions").addClass("active")},handleInstallExtension:function(e){e.preventDefault();let $button=$(this),extensionId=$button.data("extension-id"),extensionName=$button.data("extension-name"),isPremium=$button.data("is-premium")===1;if(!confirm(mdsExtensions.strings.confirm_install))return;ExtensionsPage.setButtonLoading($button,mdsExtensions.strings.installing),$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_install",nonce:mdsExtensions.nonce,extension_id:extensionId,extension_name:extensionName,is_premium:isPremium?"1":""},success:function(response){if(response.success)ExtensionsPage.showNotice(response.data.message||mdsExtensions.strings.extension_installed,"success"),ExtensionsPage.refreshExtensions();else ExtensionsPage.showNotice(response.data.message||"Installation failed","error")},error:function(){ExtensionsPage.showNotice("Installation failed","error")},complete:function(){ExtensionsPage.setButtonLoading($button,!1)}})},handleActivateExtension:function(e){e.preventDefault();let $button=$(this),extensionFile=$button.data("extension-file");ExtensionsPage.setButtonLoading($button,mdsExtensions.strings.activating),$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_activate",nonce:mdsExtensions.nonce,extension_file:extensionFile},success:function(response){if(response.success)ExtensionsPage.showNotice(response.data.message||mdsExtensions.strings.extension_activated,"success"),ExtensionsPage.refreshInstalledExtensions();else ExtensionsPage.showNotice(response.data.message||"Activation failed","error")},error:function(){ExtensionsPage.showNotice("Activation failed","error")},complete:function(){ExtensionsPage.setButtonLoading($button,!1)}})},handleDeactivateExtension:function(e){e.preventDefault();let $button=$(this),extensionFile=$button.data("extension-file");ExtensionsPage.setButtonLoading($button,mdsExtensions.strings.deactivating),$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_deactivate",nonce:mdsExtensions.nonce,extension_file:extensionFile},success:function(response){if(response.success)ExtensionsPage.showNotice(response.data.message||mdsExtensions.strings.extension_deactivated,"success"),ExtensionsPage.refreshInstalledExtensions();else ExtensionsPage.showNotice(response.data.message||"Deactivation failed","error")},error:function(){ExtensionsPage.showNotice("Deactivation failed","error")},complete:function(){ExtensionsPage.setButtonLoading($button,!1)}})},handleUpdateExtension:function(e){e.preventDefault();let $button=$(this),extensionId=$button.data("extension-id"),extensionName=$button.data("extension-name");if(!confirm(mdsExtensions.strings.confirm_update))return;ExtensionsPage.setButtonLoading($button,mdsExtensions.strings.updating),$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_update",nonce:mdsExtensions.nonce,extension_id:extensionId,extension_name:extensionName},success:function(response){if(response.success)ExtensionsPage.showNotice(response.data.message||mdsExtensions.strings.extension_updated,"success"),ExtensionsPage.refreshExtensions();else ExtensionsPage.showNotice(response.data.message||"Update failed","error")},error:function(){ExtensionsPage.showNotice("Update failed","error")},complete:function(){ExtensionsPage.setButtonLoading($button,!1)}})},handleCheckUpdates:function(e){e.preventDefault();let $button=$(this);ExtensionsPage.setButtonLoading($button,mdsExtensions.strings.checking_updates),$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_check_updates",nonce:mdsExtensions.nonce},success:function(response){if(response.success){if(ExtensionsPage.showNotice(response.data.message,"success"),response.data.updates_available>0)ExtensionsPage.refreshExtensions()}else ExtensionsPage.showNotice(response.data.message||"Check failed","error")},error:function(){ExtensionsPage.showNotice("Check for updates failed","error")},complete:function(){ExtensionsPage.setButtonLoading($button,!1)}})},refreshExtensions:function(){$.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_refresh",nonce:mdsExtensions.nonce},success:function(response){if(response.success)window.location.reload()}})},refreshInstalledExtensions:function(){window.location.reload()},setButtonLoading:function($button,loadingText){if(loadingText)$button.data("original-text",$button.text()),$button.text(loadingText),$button.prop("disabled",!0),$button.closest(".extension-card").addClass("loading");else $button.text($button.data("original-text")||$button.text()),$button.prop("disabled",!1),$button.closest(".extension-card").removeClass("loading")},showNotice:function(message,type){type=type||"info";let $notice=$('<div class="notice notice-'+type+' is-dismissible"><p>'+message+"</p></div>");if($("#mds-extensions-notices").empty().append($notice),type==="success")setTimeout(function(){$notice.fadeOut()},5000);$("html, body").animate({scrollTop:$(".wrap").offset().top-50},300)}};$(document).ready(function(){ExtensionsPage.init()})})(jQuery);
