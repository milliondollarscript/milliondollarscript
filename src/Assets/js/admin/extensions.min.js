(i=>{let a={init:function(){this.bindEvents(),this.initTabs()},bindEvents:function(){i(".nav-tab").on("click",this.handleTabClick),i(document).on("click",".install-extension",this.handleInstallExtension),i(document).on("click",".activate-extension",this.handleActivateExtension),i(document).on("click",".deactivate-extension",this.handleDeactivateExtension),i(document).on("click",".update-extension",this.handleUpdateExtension),i("#mds-check-updates-btn").on("click",this.handleCheckUpdates)},initTabs:function(){var e=window.location.hash;e&&i(e+"-extensions").length?this.showTab(e.replace("#","")):this.showTab("available")},handleTabClick:function(e){e.preventDefault();e=i(this).attr("href").replace("#","");a.showTab(e),history.pushState&&history.pushState(null,null,"#"+e)},showTab:function(e){i(".nav-tab").removeClass("nav-tab-active"),i('.nav-tab[href="#'+e+'"]').addClass("nav-tab-active"),i(".tab-content").removeClass("active"),i("#"+e+"-extensions").addClass("active")},handleInstallExtension:function(e){e.preventDefault();let t=i(this);var e=t.data("extension-id"),n=t.data("extension-name"),s=1===t.data("is-premium");confirm(mdsExtensions.strings.confirm_install)&&(a.setButtonLoading(t,mdsExtensions.strings.installing),i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_install",nonce:mdsExtensions.nonce,extension_id:e,extension_name:n,is_premium:s?"1":""},success:function(e){e.success?(a.showNotice(e.data.message||mdsExtensions.strings.extension_installed,"success"),a.refreshExtensions()):a.showNotice(e.data.message||"Installation failed","error")},error:function(){a.showNotice("Installation failed","error")},complete:function(){a.setButtonLoading(t,!1)}}))},handleActivateExtension:function(e){e.preventDefault();let t=i(this);e=t.data("extension-file");a.setButtonLoading(t,mdsExtensions.strings.activating),i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_activate",nonce:mdsExtensions.nonce,extension_file:e},success:function(e){e.success?(a.showNotice(e.data.message||mdsExtensions.strings.extension_activated,"success"),a.refreshInstalledExtensions()):a.showNotice(e.data.message||"Activation failed","error")},error:function(){a.showNotice("Activation failed","error")},complete:function(){a.setButtonLoading(t,!1)}})},handleDeactivateExtension:function(e){e.preventDefault();let t=i(this);e=t.data("extension-file");a.setButtonLoading(t,mdsExtensions.strings.deactivating),i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_deactivate",nonce:mdsExtensions.nonce,extension_file:e},success:function(e){e.success?(a.showNotice(e.data.message||mdsExtensions.strings.extension_deactivated,"success"),a.refreshInstalledExtensions()):a.showNotice(e.data.message||"Deactivation failed","error")},error:function(){a.showNotice("Deactivation failed","error")},complete:function(){a.setButtonLoading(t,!1)}})},handleUpdateExtension:function(e){e.preventDefault();let t=i(this);var e=t.data("extension-id"),n=t.data("extension-name");confirm(mdsExtensions.strings.confirm_update)&&(a.setButtonLoading(t,mdsExtensions.strings.updating),i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_update",nonce:mdsExtensions.nonce,extension_id:e,extension_name:n},success:function(e){e.success?(a.showNotice(e.data.message||mdsExtensions.strings.extension_updated,"success"),a.refreshExtensions()):a.showNotice(e.data.message||"Update failed","error")},error:function(){a.showNotice("Update failed","error")},complete:function(){a.setButtonLoading(t,!1)}}))},handleCheckUpdates:function(e){e.preventDefault();let t=i(this);a.setButtonLoading(t,mdsExtensions.strings.checking_updates),i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_check_updates",nonce:mdsExtensions.nonce},success:function(e){e.success?(a.showNotice(e.data.message,"success"),0<e.data.updates_available&&a.refreshExtensions()):a.showNotice(e.data.message||"Check failed","error")},error:function(){a.showNotice("Check for updates failed","error")},complete:function(){a.setButtonLoading(t,!1)}})},refreshExtensions:function(){i.ajax({url:mdsExtensions.ajaxurl,type:"POST",data:{action:"mds_extensions_refresh",nonce:mdsExtensions.nonce},success:function(e){e.success&&window.location.reload()}})},refreshInstalledExtensions:function(){window.location.reload()},setButtonLoading:function(e,t){t?(e.data("original-text",e.text()),e.text(t),e.prop("disabled",!0),e.closest(".extension-card").addClass("loading")):(e.text(e.data("original-text")||e.text()),e.prop("disabled",!1),e.closest(".extension-card").removeClass("loading"))},showNotice:function(e,t){let n=i('<div class="notice notice-'+(t=t||"info")+' is-dismissible"><p>'+e+"</p></div>");i("#mds-extensions-notices").empty().append(n),"success"===t&&setTimeout(function(){n.fadeOut()},5e3),i("html, body").animate({scrollTop:i(".wrap").offset().top-50},300)}};i(document).ready(function(){a.init()})})(jQuery);