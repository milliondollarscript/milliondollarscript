(d=>{let l={create:function(e,t,a,s=null){var o=d("<div>",{class:"mds-notification-modal",id:"mds-notification-modal"}),i=d("<div>",{class:"mds-modal-overlay"}),n=d("<div>",{class:"mds-modal-content mds-"+e}),t=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text(t),d("<button>",{class:"mds-modal-close",type:"button","aria-label":"Close"}).html("&times;")),e=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:`mds-notification-icon mds-${e}-icon`}),d("<div>",{class:"mds-notification-content"}).append(d("<p>").html(a)));if(s&&0<s.length){let t=d("<div>",{class:"mds-notification-details"}).append(d("<h4>").text("Details"),d("<ul>"));s.forEach(function(e){t.find("ul").append(d("<li>").text(e))}),e.find(".mds-notification-content").append(t)}a=d("<div>",{class:"mds-modal-footer"}).append(d("<button>",{class:"button button-primary mds-modal-close",type:"button"}).text("OK"));return n.append(t,e,a),o.append(i,n),o},show:function(e,t,a,s=null,o=null){this.hide();e=this.create(e,t,a,s);d("body").append(e),e.fadeIn(300),e.find(".mds-modal-content").addClass("mds-modal-show"),e.find(".mds-modal-close").on("click",function(){l.hide(),o&&"function"==typeof o&&o()}),e.find(".mds-modal-overlay").on("click",function(){l.hide()}),d(document).on("keydown.mds-modal",function(e){27===e.keyCode&&l.hide()})},hide:function(){let e=d("#mds-notification-modal, #mds-confirmation-modal");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()})),d(document).off("keydown.mds-modal")},showConfirmation:function(e,t,a,s=null){this.hide();var o=d("<div>",{class:"mds-notification-modal",id:"mds-confirmation-modal"}),i=d("<div>",{class:"mds-modal-overlay"}),n=d("<div>",{class:"mds-modal-content mds-info"}),e=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text(e),d("<button>",{class:"mds-modal-close",type:"button","aria-label":"Close"}).html("&times;")),t=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:"mds-notification-icon mds-info-icon"}),d("<div>",{class:"mds-notification-content"}).append(d("<p>").html(t))),r=d("<div>",{class:"mds-modal-footer"}).append(d("<button>",{class:"button mds-modal-cancel",type:"button"}).text("Cancel"),d("<button>",{class:"button button-primary mds-modal-confirm",type:"button"}).text("OK"));n.append(e,t,r),o.append(i,n),d("body").append(o),o.fadeIn(300),o.find(".mds-modal-content").addClass("mds-modal-show"),o.find(".mds-modal-close, .mds-modal-cancel, .mds-modal-overlay").on("click",function(){l.hide(),s&&"function"==typeof s&&s()}),o.find(".mds-modal-confirm").on("click",function(){l.hide(),a&&"function"==typeof a&&a()}),d(document).on("keydown.mds-modal",function(e){27===e.keyCode&&(l.hide(),s)&&"function"==typeof s&&s()})}},r={config:{ajaxUrl:mdsPageManagement.ajaxUrl,nonce:mdsPageManagement.nonce,strings:mdsPageManagement.strings},progressInterval:null,currentProgress:0,operationState:{isRunning:!1,operationType:null,startTime:null},init:function(){this.bindEvents(),this.initializeFilters(),this.initializeModals(),this.loadInitialData()},bindEvents:function(){d("#mds-scan-all-pages").on("click",this.scanAllPages.bind(this)),d("#mds-repair-all-issues").on("click",this.repairAllPages.bind(this)),d("#mds-export-page-data").on("click",this.exportData.bind(this)),d("#mds-refresh-list").on("click",this.refreshData.bind(this)),"function"==typeof this.bulkUpdateImplementations&&d("#mds-bulk-update-implementations").on("click",this.bulkUpdateImplementations.bind(this)),"function"==typeof this.validateAllPages&&d("#mds-validate-all-pages").on("click",this.validateAllPages.bind(this)),d("#mds-scan-errors").on("click",this.scanForErrors.bind(this)),d("#mds-fix-all-errors").on("click",this.fixAllErrors.bind(this)),d("#mds-reset-page-statuses").on("click",this.resetPageStatuses.bind(this)),d(document).on("click",".mds-status-help-link",this.showPageErrorHelp.bind(this)),d("#mds-filter-form").on("submit",this.applyFilters.bind(this)),d(".mds-clear-filters").on("click",this.clearFilters.bind(this)),d(document).on("click",".mds-view-details",this.viewPageDetails.bind(this)),d(document).on("click",".mds-scan-page",this.scanSinglePage.bind(this)),d(document).on("click",".mds-repair-page",this.repairSinglePage.bind(this)),d(document).on("click",".mds-configure-page",this.configurePage.bind(this)),d(document).on("click",".mds-delete-page",this.deletePage.bind(this)),d(document).on("click",".mds-activate-page",this.activatePage.bind(this)),d(document).on("click",".mds-deactivate-page",this.deactivatePage.bind(this)),d("#doaction, #doaction2").on("click",this.handleBulkAction.bind(this)),d(document).on("click",".mds-modal-close",this.closeModal.bind(this)),d(document).on("click",".mds-modal",function(e){e.target===this&&r.closeModal()}),mdsPageManagement.autoRefresh&&setInterval(this.refreshStats.bind(this),3e4)},initializeFilters:function(){d("#mds-page-type-filter, #mds-status-filter, #mds-implementation-filter").on("change",function(){d("#mds-filter-form").submit()});let e;d("#mds-search-input").on("input",function(){clearTimeout(e),e=setTimeout(function(){d("#mds-filter-form").submit()},500)})},initializeModals:function(){},loadInitialData:function(){this.refreshStats()},startOperation:function(e){return this.operationState.isRunning?(this.showNotice("warning",`Another operation (${this.operationState.operationType}) is already running. Please wait for it to complete.`),!1):(this.operationState.isRunning=!0,this.operationState.operationType=e,this.operationState.startTime=Date.now(),!0)},endOperation:function(){this.operationState.isRunning=!1,this.operationState.operationType=null,this.operationState.startTime=null},isOperationRunning:function(){return this.operationState.isRunning},scanAllPages:function(e){e.preventDefault(),this.startOperation("Scan All Pages")&&(e=this.config.strings.confirm_scan_all||"Are you sure you want to scan all pages? This will check all published pages for MDS content and may take some time.",l.showConfirmation("Confirm Scan All Pages",e,()=>{this.startChunkedScan()},()=>{this.endOperation()}))},startChunkedScan:function(){this.showProgress("Initializing scan...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_all_pages_start",nonce:this.config.nonce},success:function(e){e.success?r.processScanBatches(e.data):(r.showNotice("error",e.data||"Failed to initialize scan"),r.hideProgress(),r.endOperation())},error:function(){r.showNotice("error","An error occurred while initializing scan."),r.hideProgress(),r.endOperation()}})},processScanBatches:function(e){let{scan_id:s,total_pages:t,total_batches:a}=e,o=0,i=()=>{var e;o>=a?this.completeScan(s,t):(e=`Scanning pages...<br>(${10*o+1}-${Math.min(10*(o+1),t)} of ${t})`,this.updateProgress(e,this.currentProgress),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_all_pages_batch",scan_id:s,batch_number:o,nonce:this.config.nonce},success:function(e){var t,a;e.success?(t=e.data,o++,a=`Processed ${t.processed_pages} of ${t.total_pages} pages<br>(${t.found_pages} MDS pages found)`,r.updateProgress(a,t.progress_percentage),t.is_complete?r.completeScan(s,t.total_pages,t.found_pages):setTimeout(i,200)):(r.showNotice("error",e.data||"Batch processing failed"),r.hideProgress(),r.endOperation())},error:function(){r.showNotice("error","Error processing batch "+(o+1)),r.hideProgress(),r.endOperation()}}))};i()},completeScan:function(e,t,a){this.updateProgress("Scan completed!",100),setTimeout(()=>{this.hideProgress(),this.endOperation();var e=void 0!==a?`Scan completed! Processed ${t} pages and found ${a} MDS pages.`:`Scan completed! Processed ${t} pages.`;l.show("success","Scan Complete",e,null,function(){r.refreshData()})},4e3)},repairAllPages:function(e){e.preventDefault();e=this.config.strings.confirm_repair_all||"Are you sure you want to repair all pages with issues?";l.showConfirmation("Confirm Repair All",e,()=>{this.showProgress("Repairing pages...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_repair_all_pages",nonce:this.config.nonce},success:function(e){e.success?l.show("success","Repair Complete",e.data.message,null,function(){r.refreshData()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while repairing pages.")},complete:function(){r.hideProgress()}})})},exportData:function(e){e.preventDefault();var t=d(e.target).data("format")||"json",e=d(e.target).data("include-content")||!1,a=d("<form>").attr("method","POST").attr("action",this.config.ajaxUrl).css("display","none");a.append(d("<input>").attr("name","action").val("mds_export_page_data")),a.append(d("<input>").attr("name","nonce").val(this.config.nonce)),a.append(d("<input>").attr("name","format").val(t)),a.append(d("<input>").attr("name","include_content").val(e?"1":"")),d("body").append(a),a.submit(),a.remove(),this.showNotice("success","Export started. Download should begin shortly.")},refreshData:function(e){e&&e.preventDefault(),this.showProgress("Refreshing data...",0),window.location.reload()},refreshStats:function(){d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_stats",nonce:this.config.nonce},success:function(e){e.success&&r.updateStats(e.data)}})},updateStats:function(e){d(".mds-stat-card.total .mds-stat-number").text(e.total||0),d(".mds-stat-card.active .mds-stat-number").text(e.active||0),d(".mds-stat-card.needs-attention .mds-stat-number").text(e.needs_attention||0),d(".mds-stat-card.auto-detected .mds-stat-number").text(e.auto_detected||0)},applyFilters:function(e){e.preventDefault();e=d(e.target).serialize();let a=new URL(window.location);new URLSearchParams(e).forEach((e,t)=>{e?a.searchParams.set(t,e):a.searchParams.delete(t)}),window.location.href=a.toString()},clearFilters:function(e){e.preventDefault(),d("#mds-filter-form")[0].reset();e=new URL(window.location);e.search="",window.location.href=e.toString()},viewPageDetails:function(e){e.preventDefault();e=d(e.target).closest("[data-page-id]").data("page-id");this.showProgress("Loading page details...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_details",page_id:e,nonce:this.config.nonce},success:function(e){e.success?r.showPageDetailsModal(e.data):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while loading page details.")},complete:function(){r.hideProgress()}})},scanSinglePage:function(e){e.preventDefault();var t=d(e.target).closest("[data-page-id]").data("page-id");let a=d(e.target).closest("button");a.prop("disabled",!0).html('<span class="mds-spinner"></span> Scanning...'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_single_page",page_id:t,nonce:this.config.nonce},success:function(e){var t;e.success?e.data.offer_removal?(t=e.data.message+"<br><br>Would you like to remove this page from MDS management? The WordPress page will not be deleted.",l.showConfirmation("Page is Not an MDS Page",t,()=>{r.removePageFromList(e.data.page_id,e.data.page_title)},()=>{window.location.reload()})):l.show("success","Page Scan Complete",e.data.message,null,function(){window.location.reload()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while scanning the page.")},complete:function(){a.prop("disabled",!1).html('<span class="dashicons dashicons-search"></span>')}})},repairSinglePage:function(e){e.preventDefault();let t=d(e.target).closest("[data-page-id]").data("page-id"),a=d(e.target).closest("button");e=this.config.strings.confirm_repair_page||"Are you sure you want to repair this page?";l.showConfirmation("Confirm Repair",e,()=>{a.prop("disabled",!0).html('<span class="mds-spinner"></span> Repairing...'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_repair_single_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?(l.show("success","Page Repair Complete",e.data.message),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while repairing the page.")},complete:function(){a.prop("disabled",!1).html('<span class="dashicons dashicons-admin-tools"></span>')}})},()=>{})},deletePage:function(e){e.preventDefault();let t=d(e.target).closest("[data-page-id]").data("page-id");e=`Are you sure you want to delete "${d(e.target).closest("tr").find(".row-title").text()}"? This action cannot be undone.`;l.showConfirmation("Confirm Delete",e,()=>{this.showProgress("Deleting page...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_delete_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?l.show("success","Page Deleted",e.data.message,null,function(){window.location.reload()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while deleting the page.")},complete:function(){r.hideProgress()}})},()=>{})},activatePage:function(e){e.preventDefault();var t=d(e.target).closest("[data-page-id]").data("page-id");let a=d(e.target).closest("button");a.prop("disabled",!0).html('<span class="mds-spinner"></span>'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_activate_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?l.show("success","Page Activated",e.data.message,null,function(){window.location.reload()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while activating the page.")},complete:function(){a.prop("disabled",!1).html('<span class="dashicons dashicons-yes"></span>')}})},deactivatePage:function(e){e.preventDefault();var t=d(e.target).closest("[data-page-id]").data("page-id");let a=d(e.target).closest("button");a.prop("disabled",!0).html('<span class="mds-spinner"></span>'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_deactivate_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?l.show("success","Page Deactivated",e.data.message,null,function(){window.location.reload()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while deactivating the page.")},complete:function(){a.prop("disabled",!1).html('<span class="dashicons dashicons-minus"></span>')}})},removePageFromList:function(a,e,t){let s,o;o="function"==typeof e?(s=null,e):(s=e,t),this.showProgress("Removing from MDS management...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_bulk_page_action",action_type:"remove_from_list",page_ids:[a],nonce:this.config.nonce},success:function(e){var t;e.success?(t=s||"Page ID "+a,o&&"function"==typeof o?o():l.show("success","Removed from Management",`"${t}" has been removed from MDS management. The WordPress page was not deleted.`,null,function(){window.location.reload()})):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while removing the page from management.")},complete:function(){r.hideProgress()}})},configurePage:function(e){e.preventDefault();e=d(e.target).closest("[data-page-id]").data("page-id");this.showProgress("Loading configuration...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_config",page_id:e,nonce:this.config.nonce},success:function(e){e.success?r.showConfigurationModal(e.data):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while loading configuration.")},complete:function(){r.hideProgress()}})},handleBulkAction:function(e){e.preventDefault();let t=d(e.target).siblings("select").val(),a=d('input[name="page_ids[]"]:checked').map(function(){return this.value}).get();t&&0!==a.length?(e=`Are you sure you want to ${t} ${a.length} page(s)?`,l.showConfirmation("Confirm Bulk Action",e,()=>{this.showProgress(`Processing ${t}...`,0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_bulk_page_action",action_type:t,page_ids:a,nonce:this.config.nonce},success:function(e){e.success?(l.show("success","Bulk Action Complete",e.data.message),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while processing the bulk action.")},complete:function(){r.hideProgress()}})},()=>{})):this.showNotice("warning","Please select pages and an action.")},showPageDetailsModal:function(e){d("#mds-page-details-content").html(e.html),d("#mds-page-details-modal").dialog({modal:!0,width:800,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,close:function(){d("#mds-page-details-content").empty()}}),d(".mds-fix-error-btn").off("click").on("click",function(){let e=d(this).data("page-id"),a=d(this).data("error");l.showConfirmation("Confirm Fix Error","Are you sure you want to fix this error?",()=>{let t=d(this);t.prop("disabled",!0).text("Fixing..."),d.ajax({url:r.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_page_error",page_id:e,error:JSON.stringify(a),nonce:r.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),t.closest(".mds-error-item").fadeOut(),setTimeout(function(){window.location.reload()},1e3)):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){t.prop("disabled",!1).text("Fix This Error")}})},()=>{})})},showConfigurationModal:function(e){var t=`
                <form id="mds-page-config-form" data-original-implementation="${e.content_type}">
                    <input type="hidden" name="page_id" value="${e.page_id}">
                    <table class="form-table">
                        <tr>
                            <th><label for="page_type">Page Type</label></th>
                            <td>
                                <select name="page_type" id="page_type">
                                    ${this.getPageTypeOptions(e.page_type)}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="implementation_type">Implementation</label></th>
                            <td>
                                <select name="implementation_type" id="implementation_type">
                                    ${this.getImplementationOptions(e.content_type)}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="auto_scan">Auto Scan</label></th>
                            <td>
                                <input type="checkbox" name="auto_scan" id="auto_scan" ${e.auto_scan?"checked":""}>
                                <label for="auto_scan">Automatically scan this page for changes</label>
                            </td>
                        </tr>
                    </table>
                </form>
            `;d("#mds-page-config-modal").html(t),d("#mds-page-config-modal").dialog({modal:!0,title:"Configure Page: "+e.title,width:600,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,buttons:{Cancel:function(){d(this).dialog("close")},"Save Configuration":function(){r.savePageConfig()}},close:function(){d("#mds-page-config-modal").empty()}})},getPageTypeOptions:function(e){var t,a;let s="";for([t,a]of Object.entries({grid:"Pixel Grid",order:"Order Page","write-ad":"Write Advertisement","confirm-order":"Order Confirmation",payment:"Payment Processing",manage:"Manage Ads","thank-you":"Thank You",list:"Advertiser List",upload:"File Upload","no-orders":"No Orders"}))s+=`<option value="${t}" ${t===e?"selected":""}>${a}</option>`;return s},getImplementationOptions:function(e){var t,a;let s="";for([t,a]of Object.entries({shortcode:"Shortcode",block:"Block"}))s+=`<option value="${t}" ${t===e?"selected":""}>${a}</option>`;return s},savePageConfig:function(){let e=d("#mds-page-config-form").serialize();var t=d("#mds-page-config-form").data("original-implementation"),a=d("#implementation_type").val();t&&t!==a?l.showConfirmation("Confirm Implementation Change","Changing the implementation type will convert the page content. Are you sure you want to continue?",()=>{this.performSavePageConfig(e)},()=>{}):this.performSavePageConfig(e)},performSavePageConfig:function(e){d.ajax({url:this.config.ajaxUrl,type:"POST",data:e+"&action=mds_save_page_config&nonce="+this.config.nonce+"&convert_implementation=1",success:function(e){e.success?(l.show("success","Configuration Saved",e.data.message),d("#mds-page-config-modal").dialog("close"),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while saving configuration.")}})},closeModal:function(){d("#mds-page-details-modal").hasClass("ui-dialog-content")&&d("#mds-page-details-modal").dialog("close"),d("#mds-page-config-modal").hasClass("ui-dialog-content")&&d("#mds-page-config-modal").dialog("close")},showProgress:function(t,a=0){if(0!==a||d("#mds-progress-indicator").length||(this.currentProgress=0),!d("#mds-progress-indicator").length){let e=d("<div>",{class:"mds-notification-modal",id:"mds-progress-indicator"});var s=d("<div>",{class:"mds-modal-overlay"}),o=d("<div>",{class:"mds-modal-content mds-progress-content"}),i=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text("Processing...")),n=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:"mds-progress-spinner"}).append(d("<div>",{class:"mds-spinner"})),d("<div>",{class:"mds-progress"}).append(d("<div>",{class:"mds-progress-bar",id:"mds-progress-bar",style:`width: ${Math.max(a,10)}%`}).text(Math.round(a)+"%")),d("<p>",{class:"mds-progress-message",id:"mds-progress-message"}).text(t));o.append(i,n),e.append(s,o),d("body").append(e)}i=Math.max(a,this.currentProgress),this.currentProgress=i,n=Math.max(i,10);d("#mds-progress-message").html(t),d("#mds-progress-bar").css("width",n+"%").text(Math.round(i)+"%");let e=d("#mds-progress-indicator");e.fadeIn(300),e.find(".mds-modal-content").addClass("mds-modal-show"),0===a&&0===this.currentProgress&&this.startSimulatedProgress()},updateProgress:function(e,t){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null);var t=Math.max(t,this.currentProgress),a=(this.currentProgress=t,Math.max(t,10));d("#mds-progress-message").html(e),d("#mds-progress-bar").css("width",a+"%").text(Math.round(t)+"%")},startSimulatedProgress:function(){this.progressInterval&&clearInterval(this.progressInterval);let t=Math.max(this.currentProgress,10);this.progressInterval=setInterval(()=>{var e;this.progressInterval&&(e=3*Math.random()+1,t=Math.min(t+e,75),this.currentProgress=t,(e=d("#mds-progress-bar")).length&&e.css("width",t+"%").text(Math.round(t)+"%"),75<=t)&&(clearInterval(this.progressInterval),this.progressInterval=null)},300+200*Math.random())},hideProgress:function(){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),this.currentProgress=0;let e=d("#mds-progress-indicator");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()}))},scanForErrors:function(e){e.preventDefault();let t=d(e.target);e=d("#mds-error-results");let a=d("#mds-error-progress");var s=d("#mds-error-progress-text");let o=d("#mds-fix-all-errors");t.prop("disabled",!0),a.show(),s.text("Scanning for errors..."),e.hide(),o.hide(),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_errors",nonce:this.config.nonce},success:function(t){if(t.success)r.displayErrorResults(t.data),0<t.data.auto_fixable&&o.show().text(`Fix ${t.data.auto_fixable} Auto-Fixable Errors`);else{let e="Scan failed";var a=[];t.data?"string"==typeof t.data?e+=": "+t.data:t.data.message?(e+=": "+t.data.message,t.data.debug_info&&(t.data.debug_info.error&&a.push("Error: "+t.data.debug_info.error),t.data.debug_info.file)&&t.data.debug_info.line&&a.push("Location: "+t.data.debug_info.file+":"+t.data.debug_info.line)):t.data.error?e+=": "+t.data.error:e+=": Unable to complete scan":e+=": No specific error information available",l.show("error","Scan Error",e,0<a.length?a:null)}},error:function(e,t,a){var s=[];e.status&&s.push("HTTP Status: "+e.status),t&&"error"!==t&&s.push("Status: "+t),a&&s.push("Error: "+a),l.show("error","Connection Error","Unable to connect to server",0<s.length?s:null)},complete:function(){t.prop("disabled",!1),a.hide()}})},fixAllErrors:function(s){s.preventDefault(),l.showConfirmation("Confirm Fix All Errors","Are you sure you want to fix all auto-fixable errors? This will modify page content.",()=>{let e=d(s.target),t=d("#mds-error-progress");var a=d("#mds-error-progress-text");e.prop("disabled",!0),t.show(),a.text("Fixing errors..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_all_errors",nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success",e.data.message),d("#mds-scan-errors").trigger("click"),r.refreshStats()):r.showNotice("error","Error fixing failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while fixing errors.")},complete:function(){e.prop("disabled",!1),t.hide()}})},()=>{})},resetPageStatuses:function(s){s.preventDefault(),l.showConfirmation("Confirm Reset Page Statuses","Are you sure you want to reset all page statuses? This will re-validate all pages and update their statuses based on current validation rules.",()=>{let e=d(s.target).closest("button"),t=d("#mds-error-progress");var a=d("#mds-error-progress-text");this.setButtonLoading(e,!0),e.prop("disabled",!0),t.show(),a.text("Resetting page statuses..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_reset_page_statuses",nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success",e.data.message),setTimeout(function(){window.location.reload()},1500)):r.showNotice("error","Status reset failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while resetting page statuses.")},complete:function(){r.setButtonLoading(e,!1),e.prop("disabled",!1),t.hide()}})},()=>{})},displayErrorResults:function(e){var t=d("#mds-error-results"),a=t.find(".mds-error-list");if(0===e.total_errors)a.html('<div class="mds-no-errors"><p>No errors found! All pages appear to be functioning correctly.</p></div>');else{let s="";e.errors.forEach(function(e){var t=e.auto_fixable?"auto-fixable":"manual-fix",a="high"===e.severity?"critical":"";s+=`
                        <div class="mds-error-item ${t} ${a}" data-page-id="${e.page_id}">
                            <div class="mds-error-item-content">
                                <div class="mds-error-item-title">
                                    <span class="dashicons dashicons-warning"></span>
                                    ${e.page_title} - ${e.message}
                                </div>
                                <div class="mds-error-item-details">
                                    ${e.description}
                                </div>
                                <div class="mds-error-item-meta">
                                    <span class="error-type">Type: ${e.type}</span>
                                    <span class="error-severity">Severity: ${e.severity}</span>
                                    <span class="error-fixable">${e.auto_fixable?"Auto-fixable":"Manual fix required"}</span>
                                </div>
                            </div>
                            <div class="mds-error-item-actions">
                                <button type="button" class="button button-small mds-view-error-details" data-error='${JSON.stringify(e)}'>
                                    Details
                                </button>
                                ${e.auto_fixable?'<button type="button" class="button button-primary button-small mds-fix-single-error" data-error=\''+JSON.stringify(e)+"'>Fix</button>":""}
                            </div>
                        </div>
                    `}),a.html(s)}t.show(),d(".mds-view-error-details").off("click").on("click",this.showErrorDetails.bind(this)),d(".mds-fix-single-error").off("click").on("click",this.fixSingleError.bind(this))},showErrorDetails:function(e){var e=JSON.parse(d(e.target).attr("data-error"));let t=`
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Page:</div>
                    <div class="mds-error-detail-value">${e.page_title} (ID: ${e.page_id})</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Error Type:</div>
                    <div class="mds-error-detail-value">${e.type}</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Severity:</div>
                    <div class="mds-error-detail-value">${e.severity}</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Description:</div>
                    <div class="mds-error-detail-value">${e.description}</div>
                </div>
            `;e.suggested_fix&&(t+=`
                    <div class="mds-suggested-fixes">
                        <h4>Suggested Fix:</h4>
                        <div class="mds-suggested-fix ${e.auto_fixable?"mds-auto-fixable":""}">
                            <div class="mds-suggested-fix-title">${e.auto_fixable?"Automatic Fix Available":"Manual Fix Required"}</div>
                            <div class="mds-suggested-fix-description">
                                <code>${e.suggested_fix}</code>
                            </div>
                        </div>
                    </div>
                `),d("#mds-error-modal").length?(d("#mds-modal-title").text("Error Details"),d("#mds-modal-body").html(t),d("#mds-modal-fix").toggle(e.auto_fixable).attr("data-error",JSON.stringify(e)),d("#mds-error-modal").show()):(e=`
                    <strong>Page:</strong> ${e.page_title}<br>
                    <strong>Type:</strong> ${e.type}<br>
                    <strong>Description:</strong> ${e.description}
                `,l.show("info","Error Details",e))},fixSingleError:function(e){let t=JSON.parse(d(e.target).attr("data-error")),a=d(e.target);l.showConfirmation("Confirm Fix Error",`Are you sure you want to fix this error on "${t.page_title}"?`,()=>{a.prop("disabled",!0).text("Fixing..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_error",error:JSON.stringify(t),nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),a.closest(".mds-error-item").fadeOut(),r.refreshStats()):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){a.prop("disabled",!1).text("Fix")}})},()=>{})},showPageErrorHelp:function(e){e.preventDefault();let t=d(e.target).closest("[data-page-id]").data("page-id")||d(e.target).data("page-id");t?(this.showProgress("Scanning page for specific errors...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_page_errors",page_id:t,nonce:this.config.nonce},success:function(e){e.success?e.data.errors&&0<e.data.errors.length?r.showPageErrorModal(e.data,t):r.showNotice("info","No specific errors found for this page. It may have resolved automatically."):r.showNotice("error","Error scanning failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while scanning the page.")},complete:function(){r.hideProgress()}})):this.showNotice("error","Unable to identify page for error scanning")},showPageErrorModal:function(e,a){var t=e.errors;let s=`
                <div class="mds-page-error-help">
                    <h3>Errors found for: ${e.page_title||"Page ID "+a}</h3>
                    <p>The following issues were detected on this page:</p>
                    <div class="mds-page-errors-list">
            `;t.forEach(function(e){var t=e.auto_fixable?'<span class="dashicons dashicons-yes-alt" style="color: #46b450;"></span>':'<span class="dashicons dashicons-warning" style="color: #ffb900;"></span>';s+=`
                    <div class="mds-page-error-item ${e.auto_fixable?"auto-fixable":"manual-fix"}">
                        <div class="mds-error-header">
                            ${t}
                            <strong>${e.message}</strong>
                            <span class="mds-error-severity mds-severity-${e.severity}">${e.severity}</span>
                        </div>
                        <div class="mds-error-description">${e.description}</div>
                        ${e.suggested_fix?`<div class="mds-error-fix"><strong>Suggested Fix:</strong> <code>${e.suggested_fix}</code></div>`:""}
                        ${e.auto_fixable?`<button type="button" class="button button-primary button-small mds-fix-page-error" data-page-id="${a}" data-error='${JSON.stringify(e)}'>Apply Fix</button>`:"<p><em>This error requires manual intervention.</em></p>"}
                    </div>
                `}),s+=`
                    </div>
                    <div class="mds-error-help-actions">
                        <button type="button" class="button button-secondary mds-rescan-page" data-page-id="${a}">Re-scan Page</button>
                        <button type="button" class="button mds-view-all-errors">View All Page Errors</button>
                    </div>
                </div>
            `,d.fn.dialog?(0===d("#mds-page-error-help-modal").length&&d("body").append('<div id="mds-page-error-help-modal" style="display: none;"></div>'),d("#mds-page-error-help-modal").html(s),d("#mds-page-error-help-modal").dialog({title:"Page Error Details & Solutions",modal:!0,width:700,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,close:function(){d(this).empty()}}),d(".mds-fix-page-error").on("click",this.fixSinglePageError.bind(this)),d(".mds-rescan-page").on("click",function(){d("#mds-page-error-help-modal").dialog("close"),d(`.mds-status-help-link[data-page-id="${a}"]`).trigger("click")}),d(".mds-view-all-errors").on("click",function(){d("#mds-page-error-help-modal").dialog("close"),d("#mds-scan-errors").trigger("click"),setTimeout(function(){d("html, body").animate({scrollTop:d("#mds-error-results").offset().top-50},500)},500)})):(e=t.map(e=>`â€¢ ${e.message}: `+e.description).join("<br>"),l.show("warning","Page Errors Found",e))},fixSinglePageError:function(e){let t=d(e.target).data("page-id"),a=JSON.parse(d(e.target).attr("data-error")),s=d(e.target);l.showConfirmation("Confirm Fix Error",`Fix this error: "${a.message}"?`,()=>{s.prop("disabled",!0).text("Fixing..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_page_error",page_id:t,error:JSON.stringify(a),nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),s.closest(".mds-page-error-item").fadeOut(),r.refreshStats(),setTimeout(function(){window.location.reload()},1e3)):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){s.prop("disabled",!1).text("Apply Fix")}})},()=>{})},showValidationResults:function(t){let a=`
                <div class="mds-validation-results">
                    <div class="mds-validation-summary">
                        <p><strong>Validation Summary:</strong></p>
                        <ul>
                            <li>Pages checked: ${t.total_checked}</li>
                            <li>Still valid: ${t.still_valid}</li>
                            <li>Invalid pages: ${t.invalid_pages.length}</li>
                        </ul>
                    </div>
            `,o=(0<t.invalid_pages.length?(a+=`
                    <div class="mds-invalid-pages">
                        <h4>Pages that no longer appear to be MDS pages:</h4>
                        <div class="mds-invalid-pages-list">
                `,t.invalid_pages.forEach(function(e){a+=`
                        <div class="mds-invalid-page-item" data-page-id="${e.id}">
                            <div class="mds-invalid-page-info">
                                <strong>${e.title}</strong>
                                <div class="mds-invalid-page-reason">${e.reason}</div>
                            </div>
                            <div class="mds-invalid-page-actions">
                                <button type="button" class="button button-small mds-remove-invalid-page" data-page-id="${e.id}">
                                    <span class="dashicons dashicons-trash"></span>
                                    Remove from MDS Management
                                </button>
                            </div>
                        </div>
                    `}),a+=`
                        </div>
                        <div class="mds-validation-bulk-actions">
                            <button type="button" class="button button-primary" id="mds-remove-all-invalid">
                                <span class="dashicons dashicons-trash"></span>
                                Remove All Invalid Pages
                            </button>
                            <button type="button" class="button button-secondary" id="mds-validation-refresh">
                                <span class="dashicons dashicons-update"></span>
                                Refresh Page
                            </button>
                        </div>
                    </div>
                `):a+=`
                    <div class="mds-validation-no-invalid">
                        <h4>All pages are valid!</h4>
                        <p>All pages in MDS management still contain proper MDS content and are functioning correctly.</p>
                    </div>
                `,0<t.errors.length&&(a+=`
                    <div class="mds-validation-errors">
                        <h4>Errors during validation:</h4>
                        <ul>
                `,t.errors.forEach(function(e){a+=`<li>Page ID ${e.page_id}: ${e.error}</li>`}),a+=`
                        </ul>
                    </div>
                `),a+="</div>",d("<div>",{class:"mds-notification-modal",id:"mds-validation-results-modal"}));var e=d("<div>",{class:"mds-modal-overlay"}),s=d("<div>",{class:"mds-modal-content mds-validation-modal"}),i=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text("Validation Results"),d("<button>",{class:"mds-modal-close",type:"button","aria-label":"Close"}).html("&times;")),n=d("<div>",{class:"mds-modal-body"}).html(a);s.append(i,n),o.append(e,s),d("body").append(o),o.fadeIn(300),o.find(".mds-modal-content").addClass("mds-modal-show"),o.find(".mds-modal-close, .mds-modal-overlay").on("click",function(){o.fadeOut(300,function(){o.remove(),window.location.reload()})}),o.on("click",".mds-remove-invalid-page",function(){let e=d(this).data("page-id"),t=d(this),a=t.closest(".mds-invalid-page-item");var s=a.find("strong").text();o.hide(),l.showConfirmation("Remove from MDS Management",`Are you sure you want to remove "${s}" from MDS management? This will not delete the WordPress page.`,()=>{o.show(),t.prop("disabled",!0).html('<span class="dashicons dashicons-trash"></span> Removing...'),r.removePageFromList(e,function(){a.fadeOut(function(){0===o.find(".mds-invalid-page-item:visible").length?o.fadeOut(300,function(){o.remove(),l.show("success","All Invalid Pages Removed","All invalid pages have been removed from MDS management.",null,function(){window.location.reload()})}):t.prop("disabled",!1).html('<span class="dashicons dashicons-trash"></span> Remove from MDS Management')})})},()=>{o.show()})}),o.on("click","#mds-remove-all-invalid",function(){let e=d(this),a=t.invalid_pages.map(e=>e.id);o.hide(),l.showConfirmation("Remove All Invalid Pages",`Are you sure you want to remove all ${a.length} invalid pages from MDS management? This will not delete the WordPress pages.`,()=>{o.show(),e.prop("disabled",!0).text("Removing...");let t=0;a.forEach(function(e){r.removePageFromList(e,function(){++t===a.length&&o.fadeOut(300,function(){o.remove(),l.show("success","Bulk Removal Complete",a.length+" pages have been removed from MDS management.",null,function(){window.location.reload()})})})})},()=>{o.show()})}),o.on("click","#mds-validation-refresh",function(){o.fadeOut(300,function(){o.remove(),window.location.reload()})})},showNotice:function(e,t){var a="error"===e?"Error":"success"===e?"Success":"warning"===e?"Warning":"Information";l.show(e,a,t)},setButtonLoading:function(e,t){e=e.find(".dashicons");t?(e.data("original-class")||e.data("original-class",e.attr("class")),e.removeClass().addClass("dashicons dashicons-update-alt").css({animation:"rotation 2s infinite linear"})):(t=e.data("original-class"))&&(e.removeClass().attr("class",t).css("animation",""),e.removeData("original-class"))}};d(document).ready(function(){"undefined"!=typeof mdsPageManagement&&mdsPageManagement?r.init():console.error("MDS Page Management: Localization object not found. Please ensure the page management interface is properly loaded.")}),window.MDSPageManagement=r})(jQuery);