jQuery(document).ready(function(i){let t={create:function(e,a,n,s=null){var t=i("<div>",{class:"mds-notification-modal",id:"mds-notification-modal"}),d=i("<div>",{class:"mds-modal-overlay"}),o=i("<div>",{class:"mds-modal-content mds-"+e}),a=i("<div>",{class:"mds-modal-header"}).append(i("<h3>").text(a),i("<button>",{class:"mds-modal-close",type:"button","aria-label":mdsPageManagement.strings.close}).html("&times;")),e=i("<div>",{class:"mds-modal-body"}).append(i("<div>",{class:`mds-notification-icon mds-${e}-icon`}),i("<div>",{class:"mds-notification-content"}).append(i("<p>").html(n)));if(s&&0<s.length){let a=i("<div>",{class:"mds-notification-details"}).append(i("<h4>").text(mdsPageManagement.strings.details),i("<ul>"));s.forEach(function(e){a.find("ul").append(i("<li>").text(e))}),e.find(".mds-notification-content").append(a)}n=i("<div>",{class:"mds-modal-footer"}).append(i("<button>",{class:"button button-primary mds-modal-close",type:"button"}).text(mdsPageManagement.strings.ok));return o.append(a,e,n),t.append(d,o),t},show:function(e,a,n,s=null){this.hide();e=this.create(e,a,n,s);i("body").append(e),e.fadeIn(300),e.find(".mds-modal-content").addClass("mds-modal-show"),e.find(".mds-modal-close, .mds-modal-overlay").on("click",function(){t.hide()}),i(document).on("keydown.mds-modal",function(e){27===e.keyCode&&t.hide()})},hide:function(){let e=i("#mds-notification-modal");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()})),i(document).off("keydown.mds-modal")}},s={show:function(e,a=""){this.hide();var n=i("<div>",{class:"mds-progress-modal",id:"mds-progress-modal"}),s=i("<div>",{class:"mds-modal-overlay"}),t=i("<div>",{class:"mds-modal-content mds-progress-content"}),e=i("<div>",{class:"mds-modal-header"}).append(i("<h3>").text(e)),a=i("<div>",{class:"mds-modal-body"}).append(i("<div>",{class:"mds-progress-spinner"}).append(i("<div>",{class:"mds-spinner"})),i("<p>",{class:"mds-progress-message"}).text(a||mdsPageManagement.strings.processing));return t.append(e,a),n.append(s,t),i("body").append(n),n.fadeIn(300),n.find(".mds-modal-content").addClass("mds-modal-show"),n},updateMessage:function(e){i("#mds-progress-modal .mds-progress-message").text(e)},hide:function(){let e=i("#mds-progress-modal");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()}))}};i("#doaction, #doaction2").on("click",function(e){e.preventDefault();e=("doaction"===i(this).attr("id")?i("#bulk-action-selector-top"):i("#bulk-action-selector-bottom")).val();if("-1"===e)t.show("warning",mdsPageManagement.strings.no_action_selected,mdsPageManagement.strings.please_select_action);else{var a=i('input[name="page_ids[]"]:checked');if(0===a.length)t.show("warning",mdsPageManagement.strings.no_items_selected,mdsPageManagement.strings.please_select_items);else{var a=a.map(function(){return i(this).val()}).get();if("delete"===e){var n=1===a.length?mdsPageManagement.strings.confirm_delete_single:mdsPageManagement.strings.confirm_delete_multiple.replace("%d",a.length);if(!confirm(n))return}n=a,e=(e=>({scan:mdsPageManagement.strings.scanning_pages,repair:mdsPageManagement.strings.repairing_pages,delete:mdsPageManagement.strings.deleting_pages,activate:mdsPageManagement.strings.activating_pages,deactivate:mdsPageManagement.strings.deactivating_pages})[e]||mdsPageManagement.strings.processing)(a=e),s.show(mdsPageManagement.strings.processing_bulk_action,e+"..."),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_bulk_page_action",action_type:a,page_ids:n,nonce:mdsPageManagement.nonce},success:function(e){var a;s.hide(),e.success?(0<(a=e.data).error_count?t.show("warning",mdsPageManagement.strings.bulk_action_completed_with_errors,a.message,a.errors):t.show("success",mdsPageManagement.strings.bulk_action_completed,a.message),setTimeout(function(){location.reload()},2e3)):t.show("error",mdsPageManagement.strings.bulk_action_failed,e.data||mdsPageManagement.strings.unknown_error)},error:function(e,a,n){s.hide(),t.show("error",mdsPageManagement.strings.ajax_error,n||mdsPageManagement.strings.unknown_error)}})}}}),i(document).on("click",".mds-view-details",function(e){e.preventDefault();e=i(this).data("page-id");{let a=i("<div>",{title:mdsPageManagement.strings.page_details,id:"mds-page-details-modal"});a.dialog({modal:!0,width:600,height:500,resizable:!0,close:function(){i(this).dialog("destroy").remove()}}),a.html('<div class="loading">'+mdsPageManagement.strings.loading+"</div>"),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_get_page_details",page_id:e,nonce:mdsPageManagement.nonce},success:function(e){e.success?a.html(e.data.html):a.html('<div class="error">'+(e.data||mdsPageManagement.strings.failed_to_load)+"</div>")},error:function(){a.html('<div class="error">'+mdsPageManagement.strings.ajax_error+"</div>")}})}}),i(document).on("click",".mds-scan-page",function(e){e.preventDefault();e=i(this).data("page-id");{let a=i('.mds-scan-page[data-page-id="'+e+'"]'),n=a.html();a.prop("disabled",!0).html('<span class="mds-spinner"></span>'),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_scan_page",page_id:e,nonce:mdsPageManagement.nonce},success:function(e){a.prop("disabled",!1).html(n),e.success?(t.show("success",mdsPageManagement.strings.scan_completed,e.data.message),setTimeout(function(){location.reload()},1500)):t.show("error",mdsPageManagement.strings.scan_failed,e.data||mdsPageManagement.strings.unknown_error)},error:function(){a.prop("disabled",!1).html(n),t.show("error",mdsPageManagement.strings.ajax_error,mdsPageManagement.strings.scan_request_failed)}})}}),i(document).on("click",".mds-repair-page",function(e){e.preventDefault();e=i(this).data("page-id");{let a=i('.mds-repair-page[data-page-id="'+e+'"]'),n=a.html();a.prop("disabled",!0).html('<span class="mds-spinner"></span>'),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_repair_page",page_id:e,nonce:mdsPageManagement.nonce},success:function(e){a.prop("disabled",!1).html(n),e.success?(t.show("success",mdsPageManagement.strings.repair_completed,e.data.message),setTimeout(function(){location.reload()},1500)):t.show("error",mdsPageManagement.strings.repair_failed,e.data||mdsPageManagement.strings.unknown_error)},error:function(){a.prop("disabled",!1).html(n),t.show("error",mdsPageManagement.strings.ajax_error,mdsPageManagement.strings.repair_request_failed)}})}}),i(document).on("click",".mds-configure-page",function(e){e.preventDefault();e=i(this).data("page-id");{var n=e;let a=i("<div>",{title:mdsPageManagement.strings.page_configuration,id:"mds-page-config-modal"});a.dialog({modal:!0,width:500,height:400,resizable:!0,close:function(){i(this).dialog("destroy").remove()}}),a.html('<div class="loading">'+mdsPageManagement.strings.loading+"</div>"),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_get_page_config",page_id:n,nonce:mdsPageManagement.nonce},success:function(e){e.success?(a.html(e.data.html),a.find("#mds-page-config-form").on("submit",function(e){e.preventDefault();e=i(this).serialize()+"&page_id="+n+"&nonce="+mdsPageManagement.nonce;i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:"action=mds_save_page_config&"+e,success:function(e){e.success?(a.dialog("close"),t.show("success",mdsPageManagement.strings.configuration_saved,e.data.message),setTimeout(function(){location.reload()},1500)):t.show("error",mdsPageManagement.strings.configuration_failed,e.data||mdsPageManagement.strings.unknown_error)},error:function(){t.show("error",mdsPageManagement.strings.ajax_error,mdsPageManagement.strings.configuration_request_failed)}})})):a.html('<div class="error">'+(e.data||mdsPageManagement.strings.failed_to_load)+"</div>")},error:function(){a.html('<div class="error">'+mdsPageManagement.strings.ajax_error+"</div>")}})}}),i(document).on("click",".mds-status-help-link",function(e){e.preventDefault();var e=i(this).data("page-id");e=e,s.show(mdsPageManagement.strings.scanning_errors,mdsPageManagement.strings.analyzing_page_errors),i.ajax({url:mdsPageManagement.ajaxUrl,type:"POST",data:{action:"mds_scan_page_errors",page_id:e,nonce:mdsPageManagement.nonce},success:function(e){var a,n;s.hide(),e.success?(a=(n=e.data).message,n=n.errors||[],t.show("info",mdsPageManagement.strings.page_error_analysis,a,n)):t.show("error",mdsPageManagement.strings.error_scan_failed,e.data||mdsPageManagement.strings.unknown_error)},error:function(){s.hide(),t.show("error",mdsPageManagement.strings.ajax_error,mdsPageManagement.strings.error_scan_request_failed)}})}),window.mdsPageManagement=window.mdsPageManagement||{},window.mdsPageManagement.showNotification=t.show,window.mdsPageManagement.showProgress=s.show,window.mdsPageManagement.hideProgress=s.hide});