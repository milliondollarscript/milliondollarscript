!function(){function e(e,r,t){for(var a=[],i=0;i<e;++i){a.push(0),a.push(0);var n=r+Math.random()*(t-r);a.push(n+1),a.push(n),a.push(0),a.push(0),a.push(1),a.push(0)}return a}function r(e,r){if(!e)return null;var t=document.getElementById(r.name);if(!t)return null;var a=t.text,i=e.createShader(r.type);if(!i)return null;if(e.shaderSource(i,a),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS)){e.getShaderInfoLog(i);return null}return i}function t(e,t,a){if(!e)return null;var i=e.createProgram();if(!i)return null;for(var n=[],o=0;o<t.length;o++){var _=t[o];try{var l=r(e,_);if(!l)continue;e.attachShader(i,l),n.push(l)}catch(e){e(`Error creating shader ${_.name}:`,e)}}if(0===n.length)return null;if(a)try{e.transformFeedbackVaryings(i,a,e.INTERLEAVED_ATTRIBS)}catch(e){console.error("Transform feedback setup failed:",e)}if(e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS)){e.getProgramInfoLog(i);return null}for(var c=0;c<n.length;c++)e.deleteShader(n[c]);return i}function e(e,r,t){for(var a=[],i=0;i<e;++i){a.push(0),a.push(0);var n=r+Math.random()*(t-r);a.push(n+1),a.push(n),a.push(0),a.push(0),a.push(1),a.push(0)}return a}function a(e,r,t){e.bindVertexArray(t);for(var a=0;a<r.length;a++){var i=r[a];e.bindBuffer(e.ARRAY_BUFFER,i.buffer_object);var n=0;for(var o in i.attribs)if(i.attribs.hasOwnProperty(o)){var _=i.attribs[o];e.enableVertexAttribArray(_.location),e.vertexAttribPointer(_.location,_.num_components,_.type,!1,i.stride,n);n+=4*_.num_components,_.hasOwnProperty("divisor")&&e.vertexAttribDivisor(_.location,_.divisor)}}e.bindVertexArray(null),e.bindBuffer(e.ARRAY_BUFFER,null)}function i(r,i,n,o,_,l,c,u,s,d,m,p,f){if(!r)return{state:null,error:"INIT_FAILURE: Invalid WebGL context received.",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null};const g=p/f,h=Math.min(p,f)/512,A=[0,g>1?-.5:-.5*g],E=u*h,R=s*h,T=d.map((e=>e*h));try{if(_<o)throw"Invalid min-max age range.";if(c<l||l<-Math.PI||c>Math.PI)throw"Invalid theta range.";if(u>s)throw"Invalid min-max speed range.";var b,v;try{if(!(b=t(r,[{name:"particle-update-vert",type:r.VERTEX_SHADER},{name:"passthru-frag-shader",type:r.FRAGMENT_SHADER}],["v_Position","v_Age","v_Life","v_Velocity","v_Size","v_Rotation"])))throw error("Failed to create update program"),new Error("Update program creation failed")}catch(e){return{state:null,error:"Update program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}try{if(!(v=t(r,[{name:"particle-render-vert",type:r.VERTEX_SHADER},{name:"particle-render-frag",type:r.FRAGMENT_SHADER}],null)))throw new Error("Render program creation failed")}catch(e){return{state:null,error:"Render program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}if(!b||!v)return{state:null,error:"Shader program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null};var L={i_Position:{location:r.getAttribLocation(b,"i_Position"),num_components:2,type:r.FLOAT},i_Age:{location:r.getAttribLocation(b,"i_Age"),num_components:1,type:r.FLOAT},i_Life:{location:r.getAttribLocation(b,"i_Life"),num_components:1,type:r.FLOAT},i_Velocity:{location:r.getAttribLocation(b,"i_Velocity"),num_components:2,type:r.FLOAT},i_Size:{location:r.getAttribLocation(b,"i_Size"),num_components:1,type:r.FLOAT},i_Rotation:{location:r.getAttribLocation(b,"i_Rotation"),num_components:1,type:r.FLOAT}},y={i_Position:{location:r.getAttribLocation(v,"i_Position"),num_components:2,type:r.FLOAT,divisor:1},i_Age:{location:r.getAttribLocation(v,"i_Age"),num_components:1,type:r.FLOAT,divisor:1},i_Life:{location:r.getAttribLocation(v,"i_Life"),num_components:1,type:r.FLOAT,divisor:1},i_Size:{location:r.getAttribLocation(v,"i_Size"),num_components:1,type:r.FLOAT,divisor:1},i_Rotation:{location:r.getAttribLocation(v,"i_Rotation"),num_components:1,type:r.FLOAT,divisor:1}},F=[r.createVertexArray(),r.createVertexArray(),r.createVertexArray(),r.createVertexArray()],U=[r.createBuffer(),r.createBuffer()],I=new Float32Array([1,1,1,1,-1,1,0,1,-1,-1,0,0,1,1,1,1,-1,-1,0,0,1,-1,1,0]),S={i_Coord:{location:r.getAttribLocation(v,"i_Coord"),num_components:2,type:r.FLOAT},i_TexCoord:{location:r.getAttribLocation(v,"i_TexCoord"),num_components:2,type:r.FLOAT}},x=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,x),r.bufferData(r.ARRAY_BUFFER,I,r.STATIC_DRAW);var w=[{vao:F[0],buffers:[{buffer_object:U[0],stride:32,attribs:L}]},{vao:F[1],buffers:[{buffer_object:U[1],stride:32,attribs:L}]},{vao:F[2],buffers:[{buffer_object:U[0],stride:32,attribs:y},{buffer_object:x,stride:16,attribs:S}]},{vao:F[3],buffers:[{buffer_object:U[1],stride:32,attribs:y},{buffer_object:x,stride:16,attribs:S}]}],D=new Float32Array(e(i,o,_));r.bindBuffer(r.ARRAY_BUFFER,U[0]),r.bufferData(r.ARRAY_BUFFER,D,r.STREAM_DRAW),r.bindBuffer(r.ARRAY_BUFFER,U[1]),r.bufferData(r.ARRAY_BUFFER,D,r.STREAM_DRAW);for(var P=0;P<w.length;P++)a(r,w[P].buffers,w[P].vao);r.clearColor(0,0,0,0);var B=r.createTexture();r.bindTexture(r.TEXTURE_2D,B),r.texImage2D(r.TEXTURE_2D,0,r.RG8,512,512,0,r.RG,r.UNSIGNED_BYTE,function(e,r){for(var t=[],a=0;a<e*r;++a)t.push(255*Math.random()),t.push(255*Math.random());return new Uint8Array(t)}(512,512)),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.MIRRORED_REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.MIRRORED_REPEAT),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);var M=r.createTexture();r.bindTexture(r.TEXTURE_2D,M),r.texImage2D(r.TEXTURE_2D,0,r.RGBA8,m.width,m.height,0,r.RGBA,r.UNSIGNED_BYTE,m),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);var O={particle_sys_buffers:U,particle_sys_vaos:F,read:0,write:1,particle_update_program:b,particle_render_program:v,num_particles:D.length/8,old_timestamp:0,rg_noise:B,total_time:0,born_particles:0,birth_rate:n,gravity:d,origin:[0,0],min_theta:l,max_theta:c,min_speed:u,max_speed:s,particle_texture:M,gravity:T,origin:A,cur_particle_buffer:0};return{state:O,scaled_origin:A,scaled_min_speed:E,scaled_max_speed:R,scaled_gravity:T,error:null}}catch(e){return{state:null,error:`Critical error in init: ${e.message}`,scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}}function n(e,r,t){var a=r.born_particles,i=0===r.old_timestamp?0:t-r.old_timestamp;i>500&&(i=0),r.old_timestamp=t,e.canvas.width===r.canvas_width&&e.canvas.height===r.canvas_height||(r.canvas_width=e.canvas.width,r.canvas_height=e.canvas.height),r.born_particles<r.num_particles&&(r.born_particles=Math.min(r.num_particles,r.born_particles+r.birth_rate*i/1e3)),e.useProgram(r.particle_update_program),e.uniform1f(e.getUniformLocation(r.particle_update_program,"u_TotalTime"),t/1e3),e.uniform1f(e.getUniformLocation(r.particle_update_program,"u_TimeDelta"),i/1e3),e.bindVertexArray(r.particle_sys_vaos[r.read]),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,r.particle_sys_buffers[r.write]),e.enable(e.RASTERIZER_DISCARD),e.beginTransformFeedback(e.POINTS),e.drawArrays(e.POINTS,0,a),e.endTransformFeedback(),e.disable(e.RASTERIZER_DISCARD),e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,0,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT),e.useProgram(r.particle_render_program),e.bindVertexArray(r.particle_sys_vaos[r.read+2]),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,r.particle_texture),e.uniform1i(e.getUniformLocation(r.particle_render_program,"u_Sprite"),0),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE);var o=1;r.canvas_height>0&&(o=r.canvas_width/r.canvas_height),e.uniform1i(e.getUniformLocation(r.particle_render_program,"u_Sprite"),0),e.uniform1f(e.getUniformLocation(r.particle_render_program,"u_Aspect"),o),e.drawArraysInstanced(e.TRIANGLES,0,6,a),e.disable(e.BLEND);var _=r.read;r.read=r.write,r.write=_,window.requestAnimationFrame((function(t){n(e,r,t)}))}function o(){const e=document.getElementById("milliondollarscript-fire");if(!e)return;const r=e.getContext("webgl2")||null;if(!r)return;function t(){const r=e.parentElement;if(r){const t=r.getBoundingClientRect();e.width=Math.max(1,Math.floor(t.width)),e.height=Math.max(1,Math.floor(t.height)),r.style.height=`${e.height}px`,e.style.width="100%",e.style.height="100%"}}t(),window.addEventListener("resize",t);e.width,e.height;const a=new Image;a.src=e.getAttribute("data-particle-src"),a.onload=()=>{try{const t=e.width,o=e.height;let _;try{_=i(r,30,80,.4,.8,-Math.PI,Math.PI,.03,.6,[0,-.1],a,t,o)}catch(e){console.error("MAIN_ONLOAD_CATCH: Error during or immediately before init() call:",e)}const{state:l,error:c,scaled_origin:u,scaled_min_speed:s,scaled_max_speed:d,scaled_gravity:m}=_;if(c||!l||!l.particle_update_program||!l.particle_render_program)return;if(c||!l||!l.particle_update_program||!l.particle_render_program)return;l.canvas_width=t,l.canvas_height=o,r.useProgram(l.particle_update_program),r.uniform1f(r.getUniformLocation(l.particle_update_program,"u_MinSpeed"),s),r.uniform1f(r.getUniformLocation(l.particle_update_program,"u_MaxSpeed"),d),r.uniform1f(r.getUniformLocation(l.particle_update_program,"u_MouseInfluence"),0),function(e,r,t){let a,i=-1,n=-1,o=0,_=0,l=0;const c=e.getUniformLocation(t.particle_update_program,"u_MousePos"),u=e.getUniformLocation(t.particle_update_program,"u_MouseVelocity"),s=e.getUniformLocation(t.particle_update_program,"u_IsMouseMoving"),d=e.getUniformLocation(t.particle_update_program,"u_MouseInfluence");r.parentElement.addEventListener("mousemove",(d=>{jQuery(r).fadeIn(),e.useProgram(t.particle_update_program);const m=r.getBoundingClientRect(),p=m.width||1,f=m.height||1,g=(d.clientX-m.left)/p*2-1,h=(m.bottom-d.clientY)/f*2-1;e.uniform2f(c,g,h);const A=Date.now(),E=(A-o)/1e3;-1!==i&&E>.001&&(_=(g-i)/E,l=(h-n)/E,Math.sqrt(_*_+l*l)>.05&&(e.uniform2f(u,_,l),e.uniform1f(s,1),clearTimeout(a),a=setTimeout((()=>{e.useProgram(t.particle_update_program),e.uniform2f(u,0,0),e.uniform1f(s,0),jQuery(r).fadeOut()}),100))),i=g,n=h,o=A})),r.parentElement.addEventListener("mouseenter",(a=>{e.useProgram(t.particle_update_program),e.uniform1f(d,.5);const _=r.getBoundingClientRect();i=(a.clientX-_.left)/_.width*2-1,n=(_.bottom-a.clientY)/_.height*2-1,o=Date.now()})),r.parentElement.addEventListener("mouseleave",(()=>{e.useProgram(t.particle_update_program),e.uniform1f(d,0),e.uniform2f(c,-2,-2),e.uniform2f(u,0,0),e.uniform1f(s,0),clearTimeout(a),i=-1,n=-1}))}(r,e,l),window.requestAnimationFrame((e=>{n(r,l,e)}))}catch(e){console.error("Error initializing fire effect:",e)}},a.onerror=()=>{console.error("Failed to load particle image: "+a.src)}}window.main=o,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",o):o()}();