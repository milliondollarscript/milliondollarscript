(function(){function u(q,F){if(!q)return null;var N=document.getElementById(F.name);if(!N)return null;var J=N.text,K=q.createShader(F.type);if(!K)return null;q.shaderSource(K,J),q.compileShader(K);var Q=q.getShaderParameter(K,q.COMPILE_STATUS);if(!Q){var Z=q.getShaderInfoLog(K);return null}return K}function y(q,F,N){if(!q)return null;var J=q.createProgram();if(!J)return null;var K=[];for(var Q=0;Q<F.length;Q++){var Z=F[Q];try{var U=u(q,Z);if(!U)continue;q.attachShader(J,U),K.push(U)}catch(A){A(`Error creating shader ${Z.name}:`,A)}}if(K.length===0)return null;if(N)try{q.transformFeedbackVaryings(J,N,q.INTERLEAVED_ATTRIBS)}catch(A){console.error("Transform feedback setup failed:",A)}if(q.linkProgram(J),!q.getProgramParameter(J,q.LINK_STATUS)){var O=q.getProgramInfoLog(J);return null}for(var $=0;$<K.length;$++)q.deleteShader(K[$]);return J}function p(q,F){var N=[];for(var J=0;J<q*F;++J)N.push(Math.random()*255),N.push(Math.random()*255);return new Uint8Array(N)}function M(q,F,N){var J=[];for(var K=0;K<q;++K){J.push(0),J.push(0);var Q=F+Math.random()*(N-F);J.push(Q+1),J.push(Q),J.push(0),J.push(0),J.push(1),J.push(0)}return J}function c(q,F,N){q.bindVertexArray(N);for(var J=0;J<F.length;J++){var K=F[J];q.bindBuffer(q.ARRAY_BUFFER,K.buffer_object);var Q=0;for(var Z in K.attribs)if(K.attribs.hasOwnProperty(Z)){var U=K.attribs[Z];q.enableVertexAttribArray(U.location),q.vertexAttribPointer(U.location,U.num_components,U.type,!1,K.stride,Q);var O=4;if(Q+=U.num_components*O,U.hasOwnProperty("divisor"))q.vertexAttribDivisor(U.location,U.divisor)}}q.bindVertexArray(null),q.bindBuffer(q.ARRAY_BUFFER,null)}function d(q,F,N,J,K,Q,Z,U,O,$,A,C,G){if(!q)return{state:null,error:"INIT_FAILURE: Invalid WebGL context received.",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null};let R=C/G,E=Math.min(C,G)/512,S=[0,R>1?-0.5:-0.5*R],V=U*E,I=O*E,W=$.map((j)=>j*E);try{if(K<J)throw"Invalid min-max age range.";if(Z<Q||Q<-Math.PI||Z>Math.PI)throw"Invalid theta range.";if(U>O)throw"Invalid min-max speed range.";var H;try{if(H=y(q,[{name:"particle-update-vert",type:q.VERTEX_SHADER},{name:"passthru-frag-shader",type:q.FRAGMENT_SHADER}],["v_Position","v_Age","v_Life","v_Velocity","v_Size","v_Rotation"]),!H)throw error("Failed to create update program"),new Error("Update program creation failed")}catch(j){return{state:null,error:"Update program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}var B;try{if(B=y(q,[{name:"particle-render-vert",type:q.VERTEX_SHADER},{name:"particle-render-frag",type:q.FRAGMENT_SHADER}],null),!B)throw new Error("Render program creation failed")}catch(j){return{state:null,error:"Render program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}if(!H||!B)return{state:null,error:"Shader program creation failed",scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null};var P={i_Position:{location:q.getAttribLocation(H,"i_Position"),num_components:2,type:q.FLOAT},i_Age:{location:q.getAttribLocation(H,"i_Age"),num_components:1,type:q.FLOAT},i_Life:{location:q.getAttribLocation(H,"i_Life"),num_components:1,type:q.FLOAT},i_Velocity:{location:q.getAttribLocation(H,"i_Velocity"),num_components:2,type:q.FLOAT},i_Size:{location:q.getAttribLocation(H,"i_Size"),num_components:1,type:q.FLOAT},i_Rotation:{location:q.getAttribLocation(H,"i_Rotation"),num_components:1,type:q.FLOAT}},T={i_Position:{location:q.getAttribLocation(B,"i_Position"),num_components:2,type:q.FLOAT,divisor:1},i_Age:{location:q.getAttribLocation(B,"i_Age"),num_components:1,type:q.FLOAT,divisor:1},i_Life:{location:q.getAttribLocation(B,"i_Life"),num_components:1,type:q.FLOAT,divisor:1},i_Size:{location:q.getAttribLocation(B,"i_Size"),num_components:1,type:q.FLOAT,divisor:1},i_Rotation:{location:q.getAttribLocation(B,"i_Rotation"),num_components:1,type:q.FLOAT,divisor:1}},D=[q.createVertexArray(),q.createVertexArray(),q.createVertexArray(),q.createVertexArray()],k=[q.createBuffer(),q.createBuffer()],o=new Float32Array([1,1,1,1,-1,1,0,1,-1,-1,0,0,1,1,1,1,-1,-1,0,0,1,-1,1,0]),h={i_Coord:{location:q.getAttribLocation(B,"i_Coord"),num_components:2,type:q.FLOAT},i_TexCoord:{location:q.getAttribLocation(B,"i_TexCoord"),num_components:2,type:q.FLOAT}},X=q.createBuffer();q.bindBuffer(q.ARRAY_BUFFER,X),q.bufferData(q.ARRAY_BUFFER,o,q.STATIC_DRAW);var L=[{vao:D[0],buffers:[{buffer_object:k[0],stride:32,attribs:P}]},{vao:D[1],buffers:[{buffer_object:k[1],stride:32,attribs:P}]},{vao:D[2],buffers:[{buffer_object:k[0],stride:32,attribs:T},{buffer_object:X,stride:16,attribs:h}]},{vao:D[3],buffers:[{buffer_object:k[1],stride:32,attribs:T},{buffer_object:X,stride:16,attribs:h}]}],w=new Float32Array(M(F,J,K));q.bindBuffer(q.ARRAY_BUFFER,k[0]),q.bufferData(q.ARRAY_BUFFER,w,q.STREAM_DRAW),q.bindBuffer(q.ARRAY_BUFFER,k[1]),q.bufferData(q.ARRAY_BUFFER,w,q.STREAM_DRAW);for(var z=0;z<L.length;z++)c(q,L[z].buffers,L[z].vao);q.clearColor(0,0,0,0);var b=q.createTexture();q.bindTexture(q.TEXTURE_2D,b),q.texImage2D(q.TEXTURE_2D,0,q.RG8,512,512,0,q.RG,q.UNSIGNED_BYTE,p(512,512)),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_S,q.MIRRORED_REPEAT),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_WRAP_T,q.MIRRORED_REPEAT),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.NEAREST),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.NEAREST),q.enable(q.BLEND),q.blendFunc(q.SRC_ALPHA,q.ONE_MINUS_SRC_ALPHA);var v=q.createTexture();q.bindTexture(q.TEXTURE_2D,v),q.texImage2D(q.TEXTURE_2D,0,q.RGBA8,A.width,A.height,0,q.RGBA,q.UNSIGNED_BYTE,A),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MIN_FILTER,q.LINEAR),q.texParameteri(q.TEXTURE_2D,q.TEXTURE_MAG_FILTER,q.LINEAR);var f={particle_sys_buffers:k,particle_sys_vaos:D,read:0,write:1,particle_update_program:H,particle_render_program:B,num_particles:w.length/8,old_timestamp:0,rg_noise:b,total_time:0,born_particles:0,birth_rate:N,gravity:$,origin:[0,0],min_theta:Q,max_theta:Z,min_speed:U,max_speed:O,particle_texture:v,gravity:W,origin:S};return f.cur_particle_buffer=0,{state:f,scaled_origin:S,scaled_min_speed:V,scaled_max_speed:I,scaled_gravity:W,error:null}}catch(j){return{state:null,error:`Critical error in init: ${j.message}`,scaled_origin:null,scaled_min_speed:null,scaled_max_speed:null,scaled_gravity:null}}}function x(q,F,N){var J=F.born_particles,K=F.old_timestamp===0?0:N-F.old_timestamp;if(K>500)K=0;if(F.old_timestamp=N,q.canvas.width!==F.canvas_width||q.canvas.height!==F.canvas_height)F.canvas_width=q.canvas.width,F.canvas_height=q.canvas.height;if(F.born_particles<F.num_particles)F.born_particles=Math.min(F.num_particles,F.born_particles+F.birth_rate*K/1000);q.useProgram(F.particle_update_program),q.uniform1f(q.getUniformLocation(F.particle_update_program,"u_TotalTime"),N/1000),q.uniform1f(q.getUniformLocation(F.particle_update_program,"u_TimeDelta"),K/1000),q.bindVertexArray(F.particle_sys_vaos[F.read]),q.bindBufferBase(q.TRANSFORM_FEEDBACK_BUFFER,0,F.particle_sys_buffers[F.write]),q.enable(q.RASTERIZER_DISCARD),q.beginTransformFeedback(q.POINTS),q.drawArrays(q.POINTS,0,J),q.endTransformFeedback(),q.disable(q.RASTERIZER_DISCARD),q.bindBufferBase(q.TRANSFORM_FEEDBACK_BUFFER,0,null),q.bindFramebuffer(q.FRAMEBUFFER,null),q.viewport(0,0,q.canvas.width,q.canvas.height),q.clear(q.COLOR_BUFFER_BIT),q.useProgram(F.particle_render_program),q.bindVertexArray(F.particle_sys_vaos[F.read+2]),q.activeTexture(q.TEXTURE0),q.bindTexture(q.TEXTURE_2D,F.particle_texture),q.uniform1i(q.getUniformLocation(F.particle_render_program,"u_Sprite"),0),q.enable(q.BLEND),q.blendFunc(q.SRC_ALPHA,q.ONE);var Q=1;if(F.canvas_height>0)Q=F.canvas_width/F.canvas_height;q.uniform1i(q.getUniformLocation(F.particle_render_program,"u_Sprite"),0),q.uniform1f(q.getUniformLocation(F.particle_render_program,"u_Aspect"),Q),q.drawArraysInstanced(q.TRIANGLES,0,6,J),q.disable(q.BLEND);var Z=F.read;F.read=F.write,F.write=Z,window.requestAnimationFrame(function(U){x(q,F,U)})}function m(q,F,N){let J=-1,K=-1,Q=0,Z=0,U=0,O,$=q.getUniformLocation(N.particle_update_program,"u_MousePos"),A=q.getUniformLocation(N.particle_update_program,"u_MouseVelocity"),C=q.getUniformLocation(N.particle_update_program,"u_IsMouseMoving"),G=q.getUniformLocation(N.particle_update_program,"u_MouseInfluence");F.parentElement.addEventListener("mousemove",(R)=>{jQuery(F).fadeIn(),q.useProgram(N.particle_update_program);let E=F.getBoundingClientRect(),S=E.width||1,V=E.height||1,I=(R.clientX-E.left)/S*2-1,W=(E.bottom-R.clientY)/V*2-1;q.uniform2f($,I,W);let H=Date.now(),B=(H-Q)/1000;if(J!==-1&&B>0.001){let P=I-J,T=W-K;if(Z=P/B,U=T/B,Math.sqrt(Z*Z+U*U)>0.05)q.uniform2f(A,Z,U),q.uniform1f(C,1),clearTimeout(O),O=setTimeout(()=>{q.useProgram(N.particle_update_program),q.uniform2f(A,0,0),q.uniform1f(C,0),jQuery(F).fadeOut()},100)}J=I,K=W,Q=H}),F.parentElement.addEventListener("mouseenter",(R)=>{q.useProgram(N.particle_update_program),q.uniform1f(G,0.5);let E=F.getBoundingClientRect();J=(R.clientX-E.left)/E.width*2-1,K=(E.bottom-R.clientY)/E.height*2-1,Q=Date.now()}),F.parentElement.addEventListener("mouseleave",()=>{q.useProgram(N.particle_update_program),q.uniform1f(G,0),q.uniform2f($,-2,-2),q.uniform2f(A,0,0),q.uniform1f(C,0),clearTimeout(O),J=-1,K=-1})}function n(q){let F=q.getContext("webgl2");if(!F)return null;return F}function Y(){let q=document.getElementById("milliondollarscript-fire");if(!q)return;let F=n(q);if(!F)return;function N(){let Z=q.parentElement;if(Z){let U=Z.getBoundingClientRect();q.width=Math.max(1,Math.floor(U.width)),q.height=Math.max(1,Math.floor(U.height)),Z.style.height=`${q.height}px`,q.style.width="100%",q.style.height="100%"}}N(),window.addEventListener("resize",N);let{width:J,height:K}=q,Q=new Image;Q.src=q.getAttribute("data-particle-src"),Q.onload=()=>{try{let{width:Z,height:U}=q,O;try{O=d(F,30,80,0.4,0.8,-Math.PI,Math.PI,0.03,0.6,[0,-0.1],Q,Z,U)}catch(S){console.error("MAIN_ONLOAD_CATCH: Error during or immediately before init() call:",S)}let{state:$,error:A,scaled_origin:C,scaled_min_speed:G,scaled_max_speed:R,scaled_gravity:E}=O;if(A||!$||!$.particle_update_program||!$.particle_render_program)return;if(A||!$||!$.particle_update_program||!$.particle_render_program)return;$.canvas_width=Z,$.canvas_height=U,F.useProgram($.particle_update_program),F.uniform1f(F.getUniformLocation($.particle_update_program,"u_MinSpeed"),G),F.uniform1f(F.getUniformLocation($.particle_update_program,"u_MaxSpeed"),R),F.uniform1f(F.getUniformLocation($.particle_update_program,"u_MouseInfluence"),0),m(F,q,$),window.requestAnimationFrame((S)=>{x(F,$,S)})}catch(Z){console.error("Error initializing fire effect:",Z)}},Q.onerror=()=>{console.error("Failed to load particle image: "+Q.src)}}if(window.main=Y,document.readyState==="loading")document.addEventListener("DOMContentLoaded",Y);else Y()})();
