jQuery(document).ready(function(c){function r(e,t){e=`
            <div class="notice ${"error"===e?"notice-error":"notice-success"} is-dismissible">
                <p>${t}</p>
                <button type="button" class="notice-dismiss">
                    <span class="screen-reader-text">Dismiss this notice.</span>
                </button>
            </div>
        `;c(".wrap > h1").after(e),c(document).on("click",".notice-dismiss",function(){c(this).closest(".notice").fadeOut(200,function(){c(this).remove()})})}function d(e,t){e.prop("disabled",!1).html(t)}c(document).on("click",".mds-check-updates",function(e){e.preventDefault();let i=c(this),o=i.closest("tr");var e=o.data("extension-id"),t=o.data("version"),a=o.data("plugin-file");i.prop("disabled",!0).html('<span class="spinner is-active"></span> Checking...'),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_check_extension_updates",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,current_version:t,plugin_file:a},dataType:"json",success:function(e){var t,a,n,s;e.success?(t=e.data,a=o,n=a.find(".mds-update-cell"),s=a.find(".mds-check-updates"),t.update_available?(t=`
                <div class="mds-update-available">
                    <p><strong>Version ${t.latest_version} is available!</strong></p>
                    ${t.changelog?`<div class="mds-changelog">${t.changelog}</div>`:""}
                    <p>
                        <button class="button button-primary mds-install-update"
                                data-download-url="${t.download_url}"
                                data-extension-slug="${t.extension_slug}">
                            Update Now
                        </button>
                    </p>
                </div>
            `,n.html(t),d(s,"Check Again")):(n.html('<span class="mds-no-updates">You have the latest version.</span>'),d(s,"Check for Updates")),a.trigger("mds-update-checked")):(r("error",e.data.message||"Failed to check for updates."),d(i,"Check for Updates"))},error:function(e,t,a){console.error("Error checking for updates:",a),r("error","An error occurred while checking for updates."),d(i,"Check for Updates")}})}),c(document).on("click",".mds-install-update",function(e){e.preventDefault();let n=c(this);n.closest("tr");var e=n.data("extension-id"),t=n.data("extension-slug"),a=n.data("download-url");confirm("Are you sure you want to install this update?")&&(n.prop("disabled",!0).html('<span class="spinner is-active"></span> Updating...'),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension_update",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,extension_slug:t,download_url:a},dataType:"json",success:function(e){e.success?(r("success",e.data.message||"Update installed successfully."),e.data.reload&&setTimeout(()=>window.location.reload(),1500)):(r("error",e.data.message||"Failed to install update."),d(n,"Install Update"))},error:function(e,t,a){console.error("Error installing update:",a),r("error","An error occurred while installing the update."),d(n,"Install Update")}}))}),c(document).on("click",".mds-check-all-updates",function(e){e.preventDefault();let t=c(this),a=c("tr[data-extension-id]"),n=0,s=!1;function i(){n>=a.length&&(d(t,"Check All for Updates"),s?r("success","Finished checking for updates. Some extensions have updates available."):r("success","All extensions are up to date."))}t.prop("disabled",!0).html('<span class="spinner is-active"></span> Checking All...'),a.each(function(){let e=c(this);e.data("extension-id"),e.data("version");var t=e.find(".mds-check-updates");t.prop("disabled")?(n++,i()):(t.trigger("click"),e.off("mds-update-checked").on("mds-update-checked",function(){n++,e.find(".mds-update-available").length&&(s=!0),i()}))})}),c(document).on("click",".mds-install-extension",function(e){e.preventDefault();let n=c(this);var e=n.data("extension-id"),t=n.data("extension-slug");confirm("Are you sure you want to install this extension?")&&(n.prop("disabled",!0).html('<span class="spinner is-active"></span> Installing...'),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,extension_slug:t},dataType:"json",success:function(e){e.success?(r("success",e.data.message||"Extension installed successfully."),e.data.reload&&setTimeout(()=>window.location.reload(),1500)):(r("error",e.data.message||"Failed to install extension."),d(n,"Install"))},error:function(e,t,a){console.error("Error installing extension:",a),r("error","An error occurred while installing the extension."),d(n,"Install")}}))}),c(document).on("click",".mds-activate-extension",function(e){e.preventDefault();let n=c(this);var e=n.data("extension-slug"),t=n.data("nonce");confirm(MDS_EXTENSIONS_DATA.i18n?.confirm_activation||"Are you sure you want to activate this extension?")&&(n.prop("disabled",!0).html('<span class="spinner is-active"></span> '+(MDS_EXTENSIONS_DATA.i18n?.activating||"Activating...")),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_activate_extension",nonce:t,extension_slug:e},dataType:"json",success:function(e){e.success?(r("success",e.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_success||"Extension activated successfully."),!1!==e.data.reload?setTimeout(()=>window.location.reload(),1500):n.removeClass("mds-activate-extension button-secondary").addClass("mds-ext-active button-disabled").text(MDS_EXTENSIONS_DATA.i18n?.active||"Active").prop("disabled",!0)):(r("error",e.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_failed||"Failed to activate extension."),d(n,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate"))},error:function(e,t,a){console.error("Error activating extension:",a),r("error",MDS_EXTENSIONS_DATA.i18n?.activation_error||"An error occurred while activating the extension."),d(n,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate")}}))})});