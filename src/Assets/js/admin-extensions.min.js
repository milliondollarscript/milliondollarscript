jQuery(document).ready(function(c){function l(e,t,n=!0){let a="error"===e?"notice-error":"warning"===e?"notice-warning":"notice-success";var t=`
			<div class="notice ${a} is-dismissible mds-enhanced-notice">
				<p><span class="mds-notice-icon">${"error"===e?"❌":"warning"===e?"⚠️":"✅"}</span> ${t}</p>
				<button type="button" class="notice-dismiss">
					<span class="screen-reader-text">Dismiss this notice.</span>
				</button>
			</div>
		`,t=(c(".mds-enhanced-notice").remove(),c(t)),i=c(".wrap").first();i.length?t.prependTo(i):t.prependTo(c("#wpbody-content").first()),t.show(),n&&"success"===e&&setTimeout(()=>{c(".mds-enhanced-notice.notice."+a).remove()},5e3),c(document).off("click",".mds-enhanced-notice .notice-dismiss").on("click",".mds-enhanced-notice .notice-dismiss",function(){c(this).closest(".mds-enhanced-notice").remove()})}function o(e,t){e.data("original-html",e.html()),e.prop("disabled",!0).html('<span class="spinner is-active"></span> '+t).addClass("mds-btn-loading")}function u(e,t=null){t=t||e.data("original-html")||e.html();e.prop("disabled",!1).html(t).removeClass("mds-btn-loading")}try{let s=window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.license_key?String(MDS_EXTENSIONS_DATA.license_key).trim():"",o=(window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.extension_server_url?MDS_EXTENSIONS_DATA.extension_server_url:"http://localhost:15346").replace(/\/+$/,"");var e=c('table.widefat tbody tr[data-is-premium="true"]').filter(function(){return!c(this).attr("data-plugin-file")});function r(e,t){var n=e.find(".mds-install-extension");n.length&&(n.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title",t||"License required"),n="License required",(e=(t=e).find(".mds-purchase-buttons")).length)&&!t.find(".mds-license-required-note").length&&c('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">'+(n||"License required")+"</span>").appendTo(e)}if(e.length)if(s){let i=e.toArray();!function e(t){if(!(t>=i.length)){let n=c(i[t]);var a=n.data("extension-id");if(r(n,"Validating license..."),!a)return e(t+1);a=o+"/api/public/licenses/lookup?key="+encodeURIComponent(s)+"&extensionId="+encodeURIComponent(String(a)),fetch(a,{method:"GET",credentials:"omit"}).then(e=>e.ok?e.json():Promise.reject(new Error("HTTP "+e.status))).then(e=>{var t;!0===(e&&!0===e.valid||e&&e.data&&!0===e.data.valid)?(e=n,(t=e.find(".mds-install-extension")).length&&(t.prop("disabled",!1).removeClass("disabled").removeAttr("aria-disabled").removeAttr("title"),e.find(".mds-license-required-note").remove())):r(n)}).catch(()=>{r(n)}).finally(()=>e(t+1))}}(0)}else e.each(function(){r(c(this))})}catch(e){c('table.widefat tbody tr[data-is-premium="true"]').filter(function(){return!c(this).attr("data-plugin-file")}).each(function(){var e=c(this),t=e.find(".mds-install-extension"),t=(t.length&&t.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title","License required"),e.find(".mds-purchase-buttons"));t.length&&!e.find(".mds-license-required-note").length&&t.append('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">License required</span>')})}c(document).on("click",".mds-check-updates",function(e){e.preventDefault();let r=c(this),d=r.closest("tr");var e=d.data("extension-id"),t=d.data("version"),n=d.data("plugin-file");o(r,"Checking..."),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_check_extension_updates",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,current_version:t,plugin_file:n},dataType:"json",success:function(e){var t,n,a,i,s,o,c;e.success?(t=e.data,n=d,a=n.find(".mds-update-cell"),i=n.find(".mds-check-updates"),s=t.latest_version||t.new_version||t.version||"",o=t.download_url||t.package_url||"",c=n.data("extension-id")||"",t.update_available?(s=`
				<div class="mds-update-available">
					<p><strong>Version ${s} is available!</strong></p>
					${t.changelog?`<div class="mds-changelog">${t.changelog}</div>`:""}
					<p>
						<button class="button button-primary mds-install-update"
								data-download-url="${o}"
								data-extension-id="${c}">
							Update Now
						</button>
					</p>
				</div>
			`,a.html(s),u(i,"Check Again")):(a.html('<span class="mds-no-updates">You have the latest version.</span>'),u(i,"Check for Updates")),n.trigger("mds-update-checked")):(l("error",e.data.message||"Failed to check for updates."),u(r))},error:function(){l("error","An error occurred while checking for updates."),u(r)}})}),c(document).on("click",".mds-install-update",function(e){e.preventDefault();let t=c(this);var e=t.closest("tr"),e=t.data("extension-id")||e.data("extension-id"),n=t.data("extension-slug")||"",a=t.data("download-url");a&&e?confirm("Install this update now?")&&(o(t,"Updating..."),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension_update",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,extension_slug:n,download_url:a},dataType:"json",success:function(e){e.success?(l("success",e.data.message||"Update installed successfully."),e.data.reload&&setTimeout(()=>window.location.reload(),2e3)):(l("error",e.data.message||"Failed to install update."),u(t))},error:function(){l("error","An error occurred while installing the update."),u(t)}})):l("error","Missing update package information.")}),c(document).on("click",".mds-install-extension",function(e){e.preventDefault();let t=c(this);var e=t.closest("tr"),n=t.data("extension-id"),a=t.data("extension-slug"),e=e.data("is-premium"),e=!0===e||"true"===e,i=!(!MDS_EXTENSIONS_DATA.license_key||!String(MDS_EXTENSIONS_DATA.license_key).trim());e&&!i?l("warning",`This extension requires a valid license. Enter your license key at Million Dollar Script → Options → System → License Key. <a href="${MDS_EXTENSIONS_DATA.settings_url||"#"}">Open System tab</a>`,!1):(o(t,"Installing..."),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:n,extension_slug:a},dataType:"json",success:function(e){e.success?(l("success",e.data.message||"Extension installed successfully."),e.data.reload&&setTimeout(()=>window.location.reload(),2e3)):(l("error",e.data.message||"Failed to install extension."),u(t))},error:function(){l("error","An error occurred while installing the extension."),u(t)}}))}),c(document).on("click",".mds-activate-extension",function(e){e.preventDefault();let n=c(this);var e=n.data("extension-slug"),t=n.data("nonce");confirm(MDS_EXTENSIONS_DATA.i18n?.confirm_activation||"Are you sure you want to activate this extension?")&&(o(n,MDS_EXTENSIONS_DATA.i18n?.activating||"Activating..."),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_activate_extension",nonce:t,extension_slug:e},dataType:"json",success:function(e){var t;e.success?(l("success",e.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_success||"Extension activated successfully."),!1!==e.data.reload?setTimeout(()=>window.location.reload(),1500):(t=c('<span class="button button-secondary mds-ext-active" disabled="disabled">Active</span>'),n.replaceWith(t))):(l("error",e.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_failed||"Failed to activate extension."),u(n,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate"))},error:function(){l("error",MDS_EXTENSIONS_DATA.i18n?.activation_error||"An error occurred while activating the extension."),u(n,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate")}}))}),c(document).on("click",".mds-check-all-updates",function(e){e.preventDefault();let t=c(this),n=c("tr[data-extension-id]"),a=0,i=!1;function s(){a>=n.length&&(u(t),i?l("success","Finished checking for updates. Some extensions have updates available."):l("success","All extensions are up to date."))}o(t,"Checking All..."),n.each(function(){let e=c(this);var t=e.find(".mds-check-updates");t.prop("disabled")?(a++,s()):(t.trigger("click"),e.off("mds-update-checked").on("mds-update-checked",function(){a++,e.find(".mds-update-available").length&&(i=!0),s()}))})}),c(document).on("click",".mds-purchase-extension",function(e){e.preventDefault();let t=c(this);var e=t.data("extension-id"),n=t.data("nonce");o(t,"Redirecting..."),c.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_purchase_extension",nonce:n,extension_id:e},dataType:"json",success:function(e){e.success&&e.data&&e.data.checkout_url?window.location.href=e.data.checkout_url:(l("error",e.data&&e.data.message||"Failed to initiate purchase."),u(t,"Purchase"))},error:function(){l("error","An error occurred while initiating the purchase."),u(t,"Purchase")}})}),c(document).on("click",".mds-activate-license",function(e){e.preventDefault();e=c(this).closest(".mds-license-form");let t=c(this);var n=e.data("extension-slug"),a=e.find('input[name="license_key"]').val(),e=e.find('input[name="nonce"]').val();o(t,"Activating..."),c.post(MDS_EXTENSIONS_DATA.ajax_url,{action:"mds_activate_license",extension_slug:n,license_key:a,nonce:e}).done(function(e){e&&e.success?location.reload():(l("error",e&&e.data&&e.data.message?e.data.message:"Activation failed.",!1),u(t,"Activate"))}).fail(function(){l("error","An error occurred during activation.",!1),u(t,"Activate")})}),c(document).on("click",".mds-deactivate-license",function(e){e.preventDefault();e=c(this).closest(".mds-license-form");let t=c(this);var n=e.data("extension-slug"),e=e.find('input[name="nonce"]').val();o(t,"Deactivating..."),c.post(MDS_EXTENSIONS_DATA.ajax_url,{action:"mds_deactivate_license",extension_slug:n,nonce:e}).done(function(e){e&&e.success?location.reload():(l("error",e&&e.data&&e.data.message?e.data.message:"Deactivation failed.",!1),u(t,"Deactivate"))}).fail(function(){l("error","An error occurred during deactivation.",!1),u(t,"Deactivate")})})});