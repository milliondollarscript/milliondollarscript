jQuery(document).ready((function(e){"use strict";function t(t,n,i=!0){const a="error"===t?"notice-error":"warning"===t?"notice-warning":"notice-success",s=`\n\t\t\t<div class="notice ${a} is-dismissible mds-enhanced-notice">\n\t\t\t\t<p><span class="mds-notice-icon">${"error"===t?"❌":"warning"===t?"⚠️":"✅"}</span> ${n}</p>\n\t\t\t\t<button type="button" class="notice-dismiss">\n\t\t\t\t\t<span class="screen-reader-text">Dismiss this notice.</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;e(".mds-enhanced-notice").remove();const o=e(s),c=e(".wrap").first();c.length?o.prependTo(c):o.prependTo(e("#wpbody-content").first()),o.show(),i&&"success"===t&&setTimeout((()=>{e(".mds-enhanced-notice.notice."+a).remove()}),5e3),e(document).off("click",".mds-enhanced-notice .notice-dismiss").on("click",".mds-enhanced-notice .notice-dismiss",(function(){e(this).closest(".mds-enhanced-notice").remove()}))}function n(e,t){e.data("original-html",e.html()),e.prop("disabled",!0).html(`<span class="spinner is-active"></span> ${t}`).addClass("mds-btn-loading")}function i(e,t=null){const n=t||e.data("original-html")||e.html();e.prop("disabled",!1).html(n).removeClass("mds-btn-loading")}!function(){try{const t=window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.license_key?String(MDS_EXTENSIONS_DATA.license_key).trim():"",n=(window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.extension_server_url?MDS_EXTENSIONS_DATA.extension_server_url:"http://localhost:15346").replace(/\/+$/,""),i=e('table.widefat tbody tr[data-is-premium="true"]').filter((function(){return!e(this).attr("data-plugin-file")}));function a(t,n){const i=t.find(".mds-purchase-buttons");i.length&&!t.find(".mds-license-required-note").length&&e('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">'+(n||"License required")+"</span>").appendTo(i)}function s(e,t){const n=e.find(".mds-install-extension");n.length&&(n.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title",t||"License required"),a(e,"License required"))}function o(e){const t=e.find(".mds-install-extension");t.length&&(t.prop("disabled",!1).removeClass("disabled").removeAttr("aria-disabled").removeAttr("title"),e.find(".mds-license-required-note").remove())}if(!i.length)return;if(!t)return void i.each((function(){s(e(this))}));const c=i.toArray();function r(i){if(i>=c.length)return;const a=e(c[i]),d=a.data("extension-id");if(s(a,"Validating license..."),!d)return r(i+1);const l=n+"/api/public/licenses/lookup?key="+encodeURIComponent(t)+"&extensionId="+encodeURIComponent(String(d));fetch(l,{method:"GET",credentials:"omit"}).then((e=>e.ok?e.json():Promise.reject(new Error("HTTP "+e.status)))).then((e=>{!0===(e&&!0===e.valid||e&&e.data&&!0===e.data.valid)?o(a):s(a)})).catch((()=>{s(a)})).finally((()=>r(i+1)))}r(0)}catch(d){e('table.widefat tbody tr[data-is-premium="true"]').filter((function(){return!e(this).attr("data-plugin-file")})).each((function(){const t=e(this),n=t.find(".mds-install-extension");n.length&&n.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title","License required");const i=t.find(".mds-purchase-buttons");i.length&&!t.find(".mds-license-required-note").length&&i.append('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">License required</span>')}))}}(),e(document).on("click",".mds-check-updates",(function(a){a.preventDefault();const s=e(this),o=s.closest("tr"),c=o.data("extension-id"),r=o.data("version"),d=o.data("plugin-file");n(s,"Checking..."),e.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_check_extension_updates",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:c,current_version:r,plugin_file:d},dataType:"json",success:function(e){e.success?function(e,t){const n=t.find(".mds-update-cell"),a=t.find(".mds-check-updates"),s=e.latest_version||e.new_version||e.version||"",o=e.download_url||e.package_url||"",c=t.data("extension-id")||"";if(e.update_available){const t=`\n\t\t\t\t<div class="mds-update-available">\n\t\t\t\t\t<p><strong>Version ${s} is available!</strong></p>\n\t\t\t\t\t${e.changelog?`<div class="mds-changelog">${e.changelog}</div>`:""}\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<button class="button button-primary mds-install-update"\n\t\t\t\t\t\t\t\tdata-download-url="${o}"\n\t\t\t\t\t\t\t\tdata-extension-id="${c}">\n\t\t\t\t\t\t\tUpdate Now\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t`;n.html(t),i(a,"Check Again")}else n.html('<span class="mds-no-updates">You have the latest version.</span>'),i(a,"Check for Updates");t.trigger("mds-update-checked")}(e.data,o):(t("error",e.data.message||"Failed to check for updates."),i(s))},error:function(){t("error","An error occurred while checking for updates."),i(s)}})})),e(document).on("click",".mds-install-update",(function(a){a.preventDefault();const s=e(this),o=s.closest("tr"),c=s.data("extension-id")||o.data("extension-id"),r=s.data("extension-slug")||"",d=s.data("download-url");d&&c?confirm("Install this update now?")&&(n(s,"Updating..."),e.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension_update",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:c,extension_slug:r,download_url:d},dataType:"json",success:function(e){e.success?(t("success",e.data.message||"Update installed successfully."),e.data.reload&&setTimeout((()=>window.location.reload()),2e3)):(t("error",e.data.message||"Failed to install update."),i(s))},error:function(){t("error","An error occurred while installing the update."),i(s)}})):t("error","Missing update package information.")})),e(document).on("click",".mds-install-extension",(function(a){a.preventDefault();const s=e(this),o=s.closest("tr"),c=s.data("extension-id"),r=s.data("extension-slug"),d=o.data("is-premium"),l=!0===d||"true"===d,u=!(!MDS_EXTENSIONS_DATA.license_key||!String(MDS_EXTENSIONS_DATA.license_key).trim());if(!l||u)n(s,"Installing..."),e.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:c,extension_slug:r},dataType:"json",success:function(e){e.success?(t("success",e.data.message||"Extension installed successfully."),e.data.reload&&setTimeout((()=>window.location.reload()),2e3)):(t("error",e.data.message||"Failed to install extension."),i(s))},error:function(){t("error","An error occurred while installing the extension."),i(s)}});else{t("warning",`This extension requires a valid license. Enter your license key at Million Dollar Script → Options → System → License Key. <a href="${MDS_EXTENSIONS_DATA.settings_url||"#"}">Open System tab</a>`,!1)}})),e(document).on("click",".mds-activate-extension",(function(a){a.preventDefault();const s=e(this),o=s.data("extension-slug"),c=s.data("nonce");confirm(MDS_EXTENSIONS_DATA.i18n?.confirm_activation||"Are you sure you want to activate this extension?")&&(n(s,MDS_EXTENSIONS_DATA.i18n?.activating||"Activating..."),e.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_activate_extension",nonce:c,extension_slug:o},dataType:"json",success:function(n){if(n.success)if(t("success",n.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_success||"Extension activated successfully."),!1!==n.data.reload)setTimeout((()=>window.location.reload()),1500);else{const t=e('<span class="button button-secondary mds-ext-active" disabled="disabled">Active</span>');s.replaceWith(t)}else t("error",n.data.message||MDS_EXTENSIONS_DATA.i18n?.activation_failed||"Failed to activate extension."),i(s,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate")},error:function(){t("error",MDS_EXTENSIONS_DATA.i18n?.activation_error||"An error occurred while activating the extension."),i(s,MDS_EXTENSIONS_DATA.i18n?.activate||"Activate")}}))})),e(document).on("click",".mds-check-all-updates",(function(a){a.preventDefault();const s=e(this),o=e("tr[data-extension-id]");let c=0,r=!1;function d(){c>=o.length&&(i(s),t("success",r?"Finished checking for updates. Some extensions have updates available.":"All extensions are up to date."))}n(s,"Checking All..."),o.each((function(){const t=e(this),n=t.find(".mds-check-updates");if(n.prop("disabled"))return c++,void d();n.trigger("click"),t.off("mds-update-checked").on("mds-update-checked",(function(){c++,t.find(".mds-update-available").length&&(r=!0),d()}))}))})),e(document).on("click",".mds-purchase-extension",(function(a){a.preventDefault();const s=e(this),o=s.data("extension-id"),c=s.data("nonce");n(s,"Redirecting..."),e.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_purchase_extension",nonce:c,extension_id:o},dataType:"json",success:function(e){e.success&&e.data&&e.data.checkout_url?window.location.href=e.data.checkout_url:(t("error",e.data&&e.data.message||"Failed to initiate purchase."),i(s,"Purchase"))},error:function(){t("error","An error occurred while initiating the purchase."),i(s,"Purchase")}})})),e(document).on("click",".mds-activate-license",(function(a){a.preventDefault();const s=e(this).closest(".mds-license-form"),o=e(this),c=s.data("extension-slug"),r=s.find('input[name="license_key"]').val(),d=s.find('input[name="nonce"]').val();n(o,"Activating..."),e.post(MDS_EXTENSIONS_DATA.ajax_url,{action:"mds_activate_license",extension_slug:c,license_key:r,nonce:d}).done((function(e){if(e&&e.success)location.reload();else{t("error",e&&e.data&&e.data.message?e.data.message:"Activation failed.",!1),i(o,"Activate")}})).fail((function(){t("error","An error occurred during activation.",!1),i(o,"Activate")}))})),e(document).on("click",".mds-deactivate-license",(function(a){a.preventDefault();const s=e(this).closest(".mds-license-form"),o=e(this),c=s.data("extension-slug"),r=s.find('input[name="nonce"]').val();n(o,"Deactivating..."),e.post(MDS_EXTENSIONS_DATA.ajax_url,{action:"mds_deactivate_license",extension_slug:c,nonce:r}).done((function(e){if(e&&e.success)location.reload();else{t("error",e&&e.data&&e.data.message?e.data.message:"Deactivation failed.",!1),i(o,"Deactivate")}})).fail((function(){t("error","An error occurred during deactivation.",!1),i(o,"Deactivate")}))}))}));