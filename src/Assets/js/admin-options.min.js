jQuery(document).ready(function($){let{select,dispatch}=window.cf.vendor["@wordpress/data"],metaboxes=select("carbon-fields/metaboxes"),{updateFieldValue}=dispatch("carbon-fields/metaboxes"),fields=metaboxes.getFields();if(window.tinymce){let originalExecCommand=window.tinymce.Editor.prototype.execCommand;window.tinymce.Editor.prototype.execCommand=function(cmd,ui,value,args){try{if(!this.getElement()||!this.getElement().offsetParent)return!1;return originalExecCommand.call(this,cmd,ui,value,args)}catch(error){return console.warn("TinyMCE execCommand error prevented:",error),!1}}}let originalThemeValue=$('input[name="_mds_theme_mode"]:checked').val();$('input[name="_mds_theme_mode"]').on("change",function(){let newTheme=$(this).val(),currentTheme=originalThemeValue;if(newTheme!==currentTheme)showThemeSwitchConfirmation(currentTheme,newTheme,$(this))});function showThemeSwitchConfirmation(currentTheme,newTheme,radioElement){if($('input[name="_mds_theme_mode"][value="'+currentTheme+'"]').prop("checked",!0),confirm(`Switch Theme Mode?

You are switching from `+currentTheme+" to "+newTheme+` mode.
Your current settings will be backed up.

Continue?`))radioElement.prop("checked",!0),originalThemeValue=newTheme,showThemeProcessingMessage(newTheme),setTimeout(function(){$("#submit").trigger("click")},100)}function showThemeProcessingMessage(theme){let message=$('<div class="notice notice-info mds-theme-processing"><p><strong>Processing theme change...</strong> Applying '+theme+" mode colors and regenerating styles.</p></div>");$(".wrap h1").after(message),setTimeout(function(){$(".mds-theme-processing").fadeOut()},3000)}if(!$("#mds-theme-admin-styles").length)$("head").append(`
			<style id="mds-theme-admin-styles">
				.mds-theme-processing {
					animation: pulse 1.5s infinite;
				}
				@keyframes pulse {
					0%, 100% { opacity: 1; }
					50% { opacity: 0.7; }
				}
				
				/* Admin Button States with CSS Variables */
				.mds-admin-button-processing {
					background-color: var(--mds-accessible-warning, #f59e0b) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-success {
					background-color: var(--mds-accessible-success, #10b981) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-error {
					background-color: var(--mds-accessible-error, #ef4444) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-reset {
					background-color: '' !important;
					color: '' !important;
				}
				
				/* Row Highlighting */
				.mds-highlight-row {
					background-color: var(--mds-accessible-warning, #fef3c7) !important;
					color: var(--mds-text-primary, #000) !important;
				}
			</style>
		`);let buttons=["update_language","create_pages","delete_pages"];for(let i=0;i<buttons.length;i++)$("#mds_"+buttons[i]).on("click",function(e){e.preventDefault(),e.stopPropagation();let button=$(this);button.prop("disabled",!0),button.removeClass("mds-admin-button-success mds-admin-button-error").addClass("mds-admin-button-processing"),$.post(MDS.ajaxurl,{action:"mds_"+buttons[i],nonce:MDS.nonce},function(data){if(button.prop("disabled",!1),button.removeClass("mds-admin-button-processing"),data)button.addClass("mds-admin-button-success");else button.addClass("mds-admin-button-error");if(setTimeout(function(){button.removeClass("mds-admin-button-success mds-admin-button-error mds-admin-button-processing")},5000),button.attr("id")==="mds_create_pages"||button.attr("id")==="mds_delete_pages"){let pages=JSON.parse(MDS.pages);for(let page in pages){let option=pages[page].option,field=Object.values(fields).find((f)=>f.base_name===MDS.MDS_PREFIX+option);updateFieldValue(field.id,data[option])}}})})});
