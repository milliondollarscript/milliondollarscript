jQuery(document).ready(function(r){var{select:e,dispatch:t}=window.cf.vendor["@wordpress/data"],e=e("carbon-fields/metaboxes");let c=t("carbon-fields/metaboxes").updateFieldValue,d=e.getFields();if(window.tinymce){let l=window.tinymce.Editor.prototype.execCommand;window.tinymce.Editor.prototype.execCommand=function(e,t,o,n){try{return this.getElement()&&this.getElement().offsetParent?l.call(this,e,t,o,n):!1}catch(e){return console.warn("TinyMCE execCommand error prevented:",e),!1}}}function n(){setTimeout(function(){console.log("üîß Setting up Carbon Fields color picker reset functionality...");let s=0;r(".cf-color__reset").each(function(){var e=r(this);let n=e.closest(".cf-color"),l=n.find('input[type="hidden"]'),i=l.attr("id");var a=l.attr("name");if(i&&a){let t=null,o=(a.includes("carbon_fields_compact_input[_")&&(t=a.replace("carbon_fields_compact_input[_","").replace(/\].*$/,"")),Object.values(d).find(e=>e.id===i));(o=!o&&t?Object.values(d).find(e=>e.base_name===t):o)&&o.default_value?(console.log("‚úÖ Setting up reset for field:",o.base_name,"default:",o.default_value),e.prop("disabled",!1),e.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("üîÑ Resetting field:",o.base_name,"to default:",o.default_value),c(o.id,o.default_value),l.val(o.default_value).trigger("change");e=n.find(".cf-color__preview"),e.length&&e.css("background-color",o.default_value),e=n.find('input[type="text"]');e.length&&e.val(o.default_value),console.log("‚úÖ Reset complete for:",o.base_name)}),s++):console.log("‚ö†Ô∏è Skipping reset button - field not found or no default value:",{fieldId:i,cleanFieldName:t,hasField:!!o,hasDefault:!!o&&!!o.default_value})}else console.log("‚ö†Ô∏è Skipping reset button - no field ID or name found")}),console.log(`üéâ Reset functionality set up for ${s} color fields`)},2e3)}n(),new MutationObserver(function(e){let o=!1;e.forEach(function(e){if("childList"===e.type&&0<e.addedNodes.length)for(var t of e.addedNodes)if(1===t.nodeType&&(t.classList&&t.classList.contains("cf-color")||t.querySelector&&t.querySelector(".cf-color"))){o=!0;break}}),o&&setTimeout(n,100)}).observe(document.body,{childList:!0,subtree:!0});let i=r('input[name="milliondollarscript_theme_mode"]:checked').val();function a(){return Object.values(d).filter(e=>"color"===e.type&&e.base_name&&e.base_name.startsWith("milliondollarscript_"))}r('input[name="milliondollarscript_theme_mode"]').on("change",function(){var t,o,e=r(this).val(),n=i;{function l(){o.prop("checked",!0);var e=i=t;e=r('<div class="notice notice-info mds-theme-processing"><p><strong>Processing theme change...</strong> Applying '+t+" mode colors and regenerating styles.</p></div>"),r(".wrap h1").after(e),setTimeout(function(){r(".mds-theme-processing").fadeOut()},3e3),setTimeout(function(){r("#submit").trigger("click")},100)}e!==n&&(n=n,t=e,o=r(this),r('input[name="milliondollarscript_theme_mode"][value="'+n+'"]').prop("checked",!0),n="You are switching from "+n+" to "+t+" mode.\nYour current settings will be backed up.\n\nContinue?","undefined"!=typeof MDSModalUtility?MDSModalUtility.showConfirmation("Switch Theme Mode?",n,l):confirm("Switch Theme Mode?\n\n"+n)&&l())}}),r("#mds-theme-admin-styles").length||r("head").append(`
			<style id="mds-theme-admin-styles">
				.mds-theme-processing {
					animation: pulse 1.5s infinite;
				}
				@keyframes pulse {
					0%, 100% { opacity: 1; }
					50% { opacity: 0.7; }
				}
				
				/* Admin Button States with CSS Variables */
				.mds-admin-button-processing {
					background-color: var(--mds-accessible-warning, #f59e0b) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-success {
					background-color: var(--mds-accessible-success, #10b981) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-error {
					background-color: var(--mds-accessible-error, #ef4444) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-reset {
					background-color: '' !important;
					color: '' !important;
				}
				
				/* Row Highlighting */
				.mds-highlight-row {
					background-color: var(--mds-accessible-warning, #fef3c7) !important;
					color: var(--mds-text-primary, #000) !important;
				}
			</style>
		`),r("#mds_export_colors").on("click",function(e){e.preventDefault();e=r(this);e.prop("disabled",!0).text("Exporting..."),console.log("üîç Debugging theme mode detection...");let n=null;['input[name="milliondollarscript_theme_mode"]:checked','input[name="carbon_fields_compact_input[_milliondollarscript_theme_mode]"]:checked','input[name*="theme_mode"]:checked'].forEach(e=>{var t=r(e),o=t.val();console.log(`Selector "${e}": found ${t.length} elements, value: `+o),o&&!n&&(n=o)}),n||(t=Object.values(d).find(e=>"milliondollarscript_theme_mode"===e.base_name))&&(n=t.value,console.log("Got theme mode from Carbon Fields store:",n)),n||(t=r('.cf-color input[name*="dark"]'),l=r('.cf-color input[name*="background_color"]'),t.closest(".cf-color").is(":visible")?(n="dark",console.log("Detected dark mode from visible dark fields")):l.closest(".cf-color").is(":visible")&&(n="light",console.log("Detected light mode from visible light fields"))),console.log("Final theme mode:",n);var t=a();let o={version:"1.0",exported_at:(new Date).toISOString(),theme_mode:n||"unknown",colors:{}};t.forEach(e=>{o.colors[e.base_name]=e.value||e.default_value||""});var l=JSON.stringify(o,null,2),t=new Blob([l],{type:"application/json"}),l=URL.createObjectURL(t),t=document.createElement("a");t.href=l,t.download=`mds-colors-${o.theme_mode}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(l),e.prop("disabled",!1).html('<span class="dashicons dashicons-download" style="vertical-align: middle;"></span> Export Colors')}),r("#mds_import_file").on("change",function(){var e=this.files[0];r("#mds_import_colors").prop("disabled",!e)}),r("#mds_import_colors").on("click",function(e){e.preventDefault();e=r("#mds_import_file")[0].files[0];if(e){let o=r(this);o.prop("disabled",!0).text("Importing...");var t=new FileReader;t.onload=function(e){try{var t=JSON.parse(e.target.result);if(!t.colors)throw new Error("Invalid file format");Object.entries(t.colors).forEach(([t,e])=>{var o=Object.values(d).find(e=>e.base_name===t);o&&e&&c(o.id,e)}),t.theme_mode&&r(`input[name="milliondollarscript_theme_mode"][value="${t.theme_mode}"]`).prop("checked",!0),alert("Colors imported successfully! Click Save Changes to apply.")}catch(e){alert("Error importing file: "+e.message)}o.prop("disabled",!1).html('<span class="dashicons dashicons-upload" style="vertical-align: middle;"></span> Import Colors'),r("#mds_import_file").val("")},t.readAsText(e)}}),r("#mds_reset_colors").on("click",function(e){e.preventDefault(),console.log("üîÑ Reset to Defaults button clicked");e=r(this);if(console.log("Button found:",0<e.length),confirm("Are you sure you want to reset all colors to their default values? This cannot be undone.")){e.prop("disabled",!0).text("Resetting...");var t=a();console.log("üé® Found color fields for reset:",t.length),console.log("Color fields:",t.map(e=>({base_name:e.base_name,default_value:e.default_value})));let o=0,n=0;t.forEach(e=>{var t;e.default_value&&""!==e.default_value?(console.log("‚úÖ Resetting field:",e.base_name,"from:",e.value,"to:",e.default_value),c(e.id,e.default_value),(t=r(`input[type="hidden"][id="${e.id}"]`)).length&&(t.val(e.default_value).trigger("change"),(t=t.closest(".cf-color").find(".cf-color__preview")).length)&&t.css("background-color",e.default_value),o++):(console.log("‚ö†Ô∏è Skipping field with no default value:",e.base_name,"default was:",e.default_value),n++)}),console.log(`üéâ Reset complete: ${o} fields reset, ${n} skipped`),alert(`Reset ${o} color fields to defaults! Click Save Changes to apply.`),e.prop("disabled",!1).html('<span class="dashicons dashicons-update" style="vertical-align: middle;"></span> Reset to Defaults')}});let l=["update_language","create_pages","delete_pages"];for(let o=0;o<l.length;o++)r("#mds_"+l[o]).on("click",function(e){e.preventDefault(),e.stopPropagation();let t=r(this);t.prop("disabled",!0),t.removeClass("mds-admin-button-success mds-admin-button-error").addClass("mds-admin-button-processing"),r.post(MDS.ajaxurl,{action:"mds_"+l[o],nonce:MDS.nonce},function(e){if(t.prop("disabled",!1),t.removeClass("mds-admin-button-processing"),e?t.addClass("mds-admin-button-success"):t.addClass("mds-admin-button-error"),setTimeout(function(){t.removeClass("mds-admin-button-success mds-admin-button-error mds-admin-button-processing")},5e3),"mds_create_pages"===t.attr("id")||"mds_delete_pages"===t.attr("id")){var o,n=JSON.parse(MDS.pages);for(o in n){let t=n[o].option;var l=Object.values(d).find(e=>e.base_name===MDS.MDS_PREFIX+t);c(l.id,e[t])}}})})}),jQuery(document).ready(function(o){function n(){var t=(()=>{let e=o('input[name*="_milliondollarscript_license_key"]');var t;return e=e.length||(t=o("label, .cf-field__label").filter(function(){return"license key"===(o(this).text()||"").trim().toLowerCase()}).first(),(e=t.length?t.closest(".cf-field").find('input[type="text"]').first():e).length)?e:o('input[type="text"]').filter(function(){return(this.name||"").toLowerCase().includes("license_key")}).first()})();if(t&&t.length){let e=t.closest(".cf-field").length?t.closest(".cf-field"):t;e.addClass("mds-highlight-field"),t.focus();try{e[0].scrollIntoView({behavior:"smooth",block:"center"})}catch(e){}setTimeout(()=>e.removeClass("mds-highlight-field"),4e3)}}function e(){o("#mds-options-assist-styles").length||o("head").append(`
        <style id="mds-options-assist-styles">
          .mds-highlight-field {
            outline: 3px solid #f59e0b !important;
            box-shadow: 0 0 0 3px rgba(245,158,11,.3) !important;
            transition: outline-color .3s ease;
          }
          .mds-highlight-field input[type="text"] {
            background: #fff7ed !important;
          }
        </style>
      `);let e=0,t=setInterval(()=>{e++,((()=>{var e;for(e of[".cf-container__tabs button, .cf-container__tabs a",".cf-tabs__nav button, .cf-tabs__nav a",".carbon-theme-options button, .carbon-theme-options a",".wrap .cf-container button, .wrap .cf-container a"]){var t=o(e).filter(function(){return"system"===(o(this).text()||"").trim().toLowerCase()});if(t.length)return t.first().trigger("click"),!0}return!1})()||15<=e)&&(clearInterval(t),setTimeout(n,200))},200)}window.location.hash&&"#system"===window.location.hash.toLowerCase()&&e(),o(window).on("hashchange",function(){window.location.hash&&"#system"===window.location.hash.toLowerCase()&&e()})});