jQuery(document).ready((function(t){const{select:e,dispatch:o}=window.cf.vendor["@wordpress/data"],n=e("carbon-fields/metaboxes"),{updateFieldValue:s}=o("carbon-fields/metaboxes"),l=n.getFields();if(window.tinymce){const t=window.tinymce.Editor.prototype.execCommand;window.tinymce.Editor.prototype.execCommand=function(e,o,n,s){try{return!(!this.getElement()||!this.getElement().offsetParent)&&t.call(this,e,o,n,s)}catch(t){return console.warn("TinyMCE execCommand error prevented:",t),!1}}}function i(){setTimeout((function(){console.log("üîß Setting up Carbon Fields color picker reset functionality...");let e=0;t(".cf-color__reset").each((function(){const o=t(this),n=o.closest(".cf-color"),i=n.find('input[type="hidden"]'),a=i.attr("id"),c=i.attr("name");if(!a||!c)return void console.log("‚ö†Ô∏è Skipping reset button - no field ID or name found");let r=null;c.includes("carbon_fields_compact_input[_")&&(r=c.replace("carbon_fields_compact_input[_","").replace(/\].*$/,""));let d=Object.values(l).find((t=>t.id===a));!d&&r&&(d=Object.values(l).find((t=>t.base_name===r))),d&&d.default_value?(console.log("‚úÖ Setting up reset for field:",d.base_name,"default:",d.default_value),o.prop("disabled",!1),o.off("click").on("click",(function(t){t.preventDefault(),t.stopPropagation(),console.log("üîÑ Resetting field:",d.base_name,"to default:",d.default_value),s(d.id,d.default_value),i.val(d.default_value).trigger("change");const e=n.find(".cf-color__preview");e.length&&e.css("background-color",d.default_value);const o=n.find('input[type="text"]');o.length&&o.val(d.default_value),console.log("‚úÖ Reset complete for:",d.base_name)})),e++):console.log("‚ö†Ô∏è Skipping reset button - field not found or no default value:",{fieldId:a,cleanFieldName:r,hasField:!!d,hasDefault:!!d&&!!d.default_value})})),console.log(`üéâ Reset functionality set up for ${e} color fields`)}),2e3)}i();new MutationObserver((function(t){let e=!1;t.forEach((function(t){if("childList"===t.type&&t.addedNodes.length>0)for(let o of t.addedNodes)if(1===o.nodeType&&(o.classList&&o.classList.contains("cf-color")||o.querySelector&&o.querySelector(".cf-color"))){e=!0;break}})),e&&setTimeout(i,100)})).observe(document.body,{childList:!0,subtree:!0});let a=t('input[name="milliondollarscript_theme_mode"]:checked').val();function c(){return Object.values(l).filter((t=>"color"===t.type&&t.base_name&&t.base_name.startsWith("milliondollarscript_")))}function r(e,o,n){e=e||1,n=n||0;var s=t("#mds_migrate_slugs_btn"),l=t("#mds_migrate_slugs_status");t.post(window.MDS&&MDS.ajaxurl||ajaxurl,{action:"mds_migrate_slugs",page:e,batch_size:100,nonce:window.MDS&&MDS.nonce||""},(function(t){if(t&&t.success){var i=t.data||{};n+=i.updated||0,o=i.total_pages||o||1,i.done?(l.text("Done ("+n+" updated)"),s.prop("disabled",!1).text("Run migration")):(l.text("Running... page "+e+"/"+o+" ("+n+" updated)"),setTimeout((function(){r(e+1,o,n)}),1200))}else l.text("Error"),s.prop("disabled",!1).text("Run migration")})).fail((function(){l.text("Error"),t("#mds_migrate_slugs_btn").prop("disabled",!1).text("Run migration")}))}t('input[name="milliondollarscript_theme_mode"]').on("change",(function(){const e=t(this).val();e!==a&&function(e,o,n){t('input[name="milliondollarscript_theme_mode"][value="'+e+'"]').prop("checked",!0);const s="You are switching from "+e+" to "+o+" mode.\nYour current settings will be backed up.\n\nContinue?",l=function(){n.prop("checked",!0),a=o,function(e){const o=t('<div class="notice notice-info mds-theme-processing"><p><strong>Processing theme change...</strong> Applying '+e+" mode colors and regenerating styles.</p></div>");t(".wrap h1").after(o),setTimeout((function(){t(".mds-theme-processing").fadeOut()}),3e3)}(o),setTimeout((function(){t("#submit").trigger("click")}),100)};"undefined"!=typeof MDSModalUtility?MDSModalUtility.showConfirmation("Switch Theme Mode?",s,l):confirm("Switch Theme Mode?\n\n"+s)&&l()}(a,e,t(this))})),t("#mds-theme-admin-styles").length||t("head").append("\n\t\t\t<style id=\"mds-theme-admin-styles\">\n\t\t\t\t.mds-theme-processing {\n\t\t\t\t\tanimation: pulse 1.5s infinite;\n\t\t\t\t}\n\t\t\t\t@keyframes pulse {\n\t\t\t\t\t0%, 100% { opacity: 1; }\n\t\t\t\t\t50% { opacity: 0.7; }\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Admin Button States with CSS Variables */\n\t\t\t\t.mds-admin-button-processing {\n\t\t\t\t\tbackground-color: var(--mds-accessible-warning, #f59e0b) !important;\n\t\t\t\t\tcolor: #ffffff !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.mds-admin-button-success {\n\t\t\t\t\tbackground-color: var(--mds-accessible-success, #10b981) !important;\n\t\t\t\t\tcolor: #ffffff !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.mds-admin-button-error {\n\t\t\t\t\tbackground-color: var(--mds-accessible-error, #ef4444) !important;\n\t\t\t\t\tcolor: #ffffff !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.mds-admin-button-reset {\n\t\t\t\t\tbackground-color: '' !important;\n\t\t\t\t\tcolor: '' !important;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t/* Row Highlighting */\n\t\t\t\t.mds-highlight-row {\n\t\t\t\t\tbackground-color: var(--mds-accessible-warning, #fef3c7) !important;\n\t\t\t\t\tcolor: var(--mds-text-primary, #000) !important;\n\t\t\t\t}\n\t\t\t</style>\n\t\t"),t("#mds_export_colors").on("click",(function(e){e.preventDefault();const o=t(this);o.prop("disabled",!0).text("Exporting..."),console.log("üîç Debugging theme mode detection...");let n=null;if(['input[name="milliondollarscript_theme_mode"]:checked','input[name="carbon_fields_compact_input[_milliondollarscript_theme_mode]"]:checked','input[name*="theme_mode"]:checked'].forEach((e=>{const o=t(e),s=o.val();console.log(`Selector "${e}": found ${o.length} elements, value: ${s}`),s&&!n&&(n=s)})),!n){const t=Object.values(l).find((t=>"milliondollarscript_theme_mode"===t.base_name));t&&(n=t.value,console.log("Got theme mode from Carbon Fields store:",n))}if(!n){const e=t('.cf-color input[name*="dark"]'),o=t('.cf-color input[name*="background_color"]');e.closest(".cf-color").is(":visible")?(n="dark",console.log("Detected dark mode from visible dark fields")):o.closest(".cf-color").is(":visible")&&(n="light",console.log("Detected light mode from visible light fields"))}console.log("Final theme mode:",n);const s=c(),i={version:"1.0",exported_at:(new Date).toISOString(),theme_mode:n||"unknown",colors:{}};s.forEach((t=>{i.colors[t.base_name]=t.value||t.default_value||""}));const a=JSON.stringify(i,null,2),r=new Blob([a],{type:"application/json"}),d=URL.createObjectURL(r),u=document.createElement("a");u.href=d,u.download=`mds-colors-${i.theme_mode}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(d),o.prop("disabled",!1).html('<span class="dashicons dashicons-download" style="vertical-align: middle;"></span> Export Colors')})),t("#mds_import_file").on("change",(function(){const e=this.files[0];t("#mds_import_colors").prop("disabled",!e)})),t("#mds_import_colors").on("click",(function(e){e.preventDefault();const o=t("#mds_import_file")[0].files[0];if(!o)return;const n=t(this);n.prop("disabled",!0).text("Importing...");const i=new FileReader;i.onload=function(e){try{const o=JSON.parse(e.target.result);if(!o.colors)throw new Error("Invalid file format");Object.entries(o.colors).forEach((([t,e])=>{const o=Object.values(l).find((e=>e.base_name===t));o&&e&&s(o.id,e)})),o.theme_mode&&t(`input[name="milliondollarscript_theme_mode"][value="${o.theme_mode}"]`).prop("checked",!0),alert("Colors imported successfully! Click Save Changes to apply.")}catch(t){alert("Error importing file: "+t.message)}n.prop("disabled",!1).html('<span class="dashicons dashicons-upload" style="vertical-align: middle;"></span> Import Colors'),t("#mds_import_file").val("")},i.readAsText(o)})),t(document).on("click","#mds_migrate_slugs_btn",(function(){var e=t(this),o=t("#mds_migrate_slugs_status");e.prop("disabled",!0).text("Running..."),o.text("Starting..."),r(1,0,0)})),t("#mds_reset_colors").on("click",(function(e){e.preventDefault(),console.log("üîÑ Reset to Defaults button clicked");const o=t(this);if(console.log("Button found:",o.length>0),!confirm("Are you sure you want to reset all colors to their default values? This cannot be undone."))return;o.prop("disabled",!0).text("Resetting...");const n=c();console.log("üé® Found color fields for reset:",n.length),console.log("Color fields:",n.map((t=>({base_name:t.base_name,default_value:t.default_value}))));let l=0,i=0;n.forEach((e=>{if(e.default_value&&""!==e.default_value){console.log("‚úÖ Resetting field:",e.base_name,"from:",e.value,"to:",e.default_value),s(e.id,e.default_value);const o=t(`input[type="hidden"][id="${e.id}"]`);if(o.length){o.val(e.default_value).trigger("change");const t=o.closest(".cf-color").find(".cf-color__preview");t.length&&t.css("background-color",e.default_value)}l++}else console.log("‚ö†Ô∏è Skipping field with no default value:",e.base_name,"default was:",e.default_value),i++})),console.log(`üéâ Reset complete: ${l} fields reset, ${i} skipped`),alert(`Reset ${l} color fields to defaults! Click Save Changes to apply.`),o.prop("disabled",!1).html('<span class="dashicons dashicons-update" style="vertical-align: middle;"></span> Reset to Defaults')}));const d=["update_language","create_pages","delete_pages"];for(let e=0;e<d.length;e++)t("#mds_"+d[e]).on("click",(function(o){o.preventDefault(),o.stopPropagation();const n=t(this);n.prop("disabled",!0),n.removeClass("mds-admin-button-success mds-admin-button-error").addClass("mds-admin-button-processing"),t.post(MDS.ajaxurl,{action:"mds_"+d[e],nonce:MDS.nonce},(function(t){if(n.prop("disabled",!1),n.removeClass("mds-admin-button-processing"),t?n.addClass("mds-admin-button-success"):n.addClass("mds-admin-button-error"),setTimeout((function(){n.removeClass("mds-admin-button-success mds-admin-button-error mds-admin-button-processing")}),5e3),"mds_create_pages"===n.attr("id")||"mds_delete_pages"===n.attr("id")){const e=JSON.parse(MDS.pages);for(let o in e){const n=e[o].option;let i=Object.values(l).find((t=>t.base_name===MDS.MDS_PREFIX+n));s(i.id,t[n])}}}))}))}));