jQuery(document).ready(function(r){var{select:e,dispatch:o}=window.cf.vendor["@wordpress/data"],e=e("carbon-fields/metaboxes");let d=o("carbon-fields/metaboxes").updateFieldValue,c=e.getFields();if(window.tinymce){let n=window.tinymce.Editor.prototype.execCommand;window.tinymce.Editor.prototype.execCommand=function(e,o,t,l){try{return this.getElement()&&this.getElement().offsetParent?n.call(this,e,o,t,l):!1}catch(e){return console.warn("TinyMCE execCommand error prevented:",e),!1}}}function l(){setTimeout(function(){console.log("üîß Setting up Carbon Fields color picker reset functionality...");let s=0;r(".cf-color__reset").each(function(){var e=r(this);let l=e.closest(".cf-color"),n=l.find('input[type="hidden"]'),a=n.attr("id");var i=n.attr("name");if(a&&i){let o=null,t=(i.includes("carbon_fields_compact_input[_")&&(o=i.replace("carbon_fields_compact_input[_","").replace(/\].*$/,"")),Object.values(c).find(e=>e.id===a));(t=!t&&o?Object.values(c).find(e=>e.base_name===o):t)&&t.default_value?(console.log("‚úÖ Setting up reset for field:",t.base_name,"default:",t.default_value),e.prop("disabled",!1),e.off("click").on("click",function(e){e.preventDefault(),e.stopPropagation(),console.log("üîÑ Resetting field:",t.base_name,"to default:",t.default_value),d(t.id,t.default_value),n.val(t.default_value).trigger("change");e=l.find(".cf-color__preview"),e.length&&e.css("background-color",t.default_value),e=l.find('input[type="text"]');e.length&&e.val(t.default_value),console.log("‚úÖ Reset complete for:",t.base_name)}),s++):console.log("‚ö†Ô∏è Skipping reset button - field not found or no default value:",{fieldId:a,cleanFieldName:o,hasField:!!t,hasDefault:!!t&&!!t.default_value})}else console.log("‚ö†Ô∏è Skipping reset button - no field ID or name found")}),console.log(`üéâ Reset functionality set up for ${s} color fields`)},2e3)}l(),new MutationObserver(function(e){let t=!1;e.forEach(function(e){if("childList"===e.type&&0<e.addedNodes.length)for(var o of e.addedNodes)if(1===o.nodeType&&(o.classList&&o.classList.contains("cf-color")||o.querySelector&&o.querySelector(".cf-color"))){t=!0;break}}),t&&setTimeout(l,100)}).observe(document.body,{childList:!0,subtree:!0});let a=r('input[name="milliondollarscript_theme_mode"]:checked').val();function i(){return Object.values(c).filter(e=>"color"===e.type&&e.base_name&&e.base_name.startsWith("milliondollarscript_"))}r('input[name="milliondollarscript_theme_mode"]').on("change",function(){var o,t,e=r(this).val(),l=a;{function n(){t.prop("checked",!0);var e=a=o;e=r('<div class="notice notice-info mds-theme-processing"><p><strong>Processing theme change...</strong> Applying '+o+" mode colors and regenerating styles.</p></div>"),r(".wrap h1").after(e),setTimeout(function(){r(".mds-theme-processing").fadeOut()},3e3),setTimeout(function(){r("#submit").trigger("click")},100)}e!==l&&(l=l,o=e,t=r(this),r('input[name="milliondollarscript_theme_mode"][value="'+l+'"]').prop("checked",!0),l="You are switching from "+l+" to "+o+" mode.\nYour current settings will be backed up.\n\nContinue?","undefined"!=typeof MDSModalUtility?MDSModalUtility.showConfirmation("Switch Theme Mode?",l,n):confirm("Switch Theme Mode?\n\n"+l)&&n())}}),r("#mds-theme-admin-styles").length||r("head").append(`
			<style id="mds-theme-admin-styles">
				.mds-theme-processing {
					animation: pulse 1.5s infinite;
				}
				@keyframes pulse {
					0%, 100% { opacity: 1; }
					50% { opacity: 0.7; }
				}
				
				/* Admin Button States with CSS Variables */
				.mds-admin-button-processing {
					background-color: var(--mds-accessible-warning, #f59e0b) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-success {
					background-color: var(--mds-accessible-success, #10b981) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-error {
					background-color: var(--mds-accessible-error, #ef4444) !important;
					color: #ffffff !important;
				}
				
				.mds-admin-button-reset {
					background-color: '' !important;
					color: '' !important;
				}
				
				/* Row Highlighting */
				.mds-highlight-row {
					background-color: var(--mds-accessible-warning, #fef3c7) !important;
					color: var(--mds-text-primary, #000) !important;
				}
			</style>
		`),r("#mds_export_colors").on("click",function(e){e.preventDefault();e=r(this);e.prop("disabled",!0).text("Exporting..."),console.log("üîç Debugging theme mode detection...");let l=null;['input[name="milliondollarscript_theme_mode"]:checked','input[name="carbon_fields_compact_input[_milliondollarscript_theme_mode]"]:checked','input[name*="theme_mode"]:checked'].forEach(e=>{var o=r(e),t=o.val();console.log(`Selector "${e}": found ${o.length} elements, value: `+t),t&&!l&&(l=t)}),l||(o=Object.values(c).find(e=>"milliondollarscript_theme_mode"===e.base_name))&&(l=o.value,console.log("Got theme mode from Carbon Fields store:",l)),l||(o=r('.cf-color input[name*="dark"]'),n=r('.cf-color input[name*="background_color"]'),o.closest(".cf-color").is(":visible")?(l="dark",console.log("Detected dark mode from visible dark fields")):n.closest(".cf-color").is(":visible")&&(l="light",console.log("Detected light mode from visible light fields"))),console.log("Final theme mode:",l);var o=i();let t={version:"1.0",exported_at:(new Date).toISOString(),theme_mode:l||"unknown",colors:{}};o.forEach(e=>{t.colors[e.base_name]=e.value||e.default_value||""});var n=JSON.stringify(t,null,2),o=new Blob([n],{type:"application/json"}),n=URL.createObjectURL(o),o=document.createElement("a");o.href=n,o.download=`mds-colors-${t.theme_mode}-${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n),e.prop("disabled",!1).html('<span class="dashicons dashicons-download" style="vertical-align: middle;"></span> Export Colors')}),r("#mds_import_file").on("change",function(){var e=this.files[0];r("#mds_import_colors").prop("disabled",!e)}),r("#mds_import_colors").on("click",function(e){e.preventDefault();e=r("#mds_import_file")[0].files[0];if(e){let t=r(this);t.prop("disabled",!0).text("Importing...");var o=new FileReader;o.onload=function(e){try{var o=JSON.parse(e.target.result);if(!o.colors)throw new Error("Invalid file format");Object.entries(o.colors).forEach(([o,e])=>{var t=Object.values(c).find(e=>e.base_name===o);t&&e&&d(t.id,e)}),o.theme_mode&&r(`input[name="milliondollarscript_theme_mode"][value="${o.theme_mode}"]`).prop("checked",!0),alert("Colors imported successfully! Click Save Changes to apply.")}catch(e){alert("Error importing file: "+e.message)}t.prop("disabled",!1).html('<span class="dashicons dashicons-upload" style="vertical-align: middle;"></span> Import Colors'),r("#mds_import_file").val("")},o.readAsText(e)}}),r("#mds_reset_colors").on("click",function(e){e.preventDefault(),console.log("üîÑ Reset to Defaults button clicked");e=r(this);if(console.log("Button found:",0<e.length),confirm("Are you sure you want to reset all colors to their default values? This cannot be undone.")){e.prop("disabled",!0).text("Resetting...");var o=i();console.log("üé® Found color fields for reset:",o.length),console.log("Color fields:",o.map(e=>({base_name:e.base_name,default_value:e.default_value})));let t=0,l=0;o.forEach(e=>{var o;e.default_value&&""!==e.default_value?(console.log("‚úÖ Resetting field:",e.base_name,"from:",e.value,"to:",e.default_value),d(e.id,e.default_value),(o=r(`input[type="hidden"][id="${e.id}"]`)).length&&(o.val(e.default_value).trigger("change"),(o=o.closest(".cf-color").find(".cf-color__preview")).length)&&o.css("background-color",e.default_value),t++):(console.log("‚ö†Ô∏è Skipping field with no default value:",e.base_name,"default was:",e.default_value),l++)}),console.log(`üéâ Reset complete: ${t} fields reset, ${l} skipped`),alert(`Reset ${t} color fields to defaults! Click Save Changes to apply.`),e.prop("disabled",!1).html('<span class="dashicons dashicons-update" style="vertical-align: middle;"></span> Reset to Defaults')}});let n=["update_language","create_pages","delete_pages"];for(let t=0;t<n.length;t++)r("#mds_"+n[t]).on("click",function(e){e.preventDefault(),e.stopPropagation();let o=r(this);o.prop("disabled",!0),o.removeClass("mds-admin-button-success mds-admin-button-error").addClass("mds-admin-button-processing"),r.post(MDS.ajaxurl,{action:"mds_"+n[t],nonce:MDS.nonce},function(e){if(o.prop("disabled",!1),o.removeClass("mds-admin-button-processing"),e?o.addClass("mds-admin-button-success"):o.addClass("mds-admin-button-error"),setTimeout(function(){o.removeClass("mds-admin-button-success mds-admin-button-error mds-admin-button-processing")},5e3),"mds_create_pages"===o.attr("id")||"mds_delete_pages"===o.attr("id")){var t,l=JSON.parse(MDS.pages);for(t in l){let o=l[t].option;var n=Object.values(c).find(e=>e.base_name===MDS.MDS_PREFIX+o);d(n.id,e[o])}}})})});