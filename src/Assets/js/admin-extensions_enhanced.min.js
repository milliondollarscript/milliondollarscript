jQuery(document).ready(function(r){function d(e,t,n=!0){let s="error"===e?"notice-error":"warning"===e?"notice-warning":"notice-success";var t=`
	           <div class="notice ${s} is-dismissible mds-enhanced-notice">
	               <p><span class="mds-notice-icon">${"error"===e?"‚ùå":"warning"===e?"‚ö†Ô∏è":"‚úÖ"}</span> ${t}</p>
	               <button type="button" class="notice-dismiss">
	                   <span class="screen-reader-text">Dismiss this notice.</span>
	               </button>
	           </div>
	       `,t=(r(".mds-enhanced-notice").remove(),r(t)),a=r(".wrap").first();a.length?t.prependTo(a):t.prependTo(r("#wpbody-content").first()),t.show(),n&&"success"===e&&setTimeout(()=>{r(".mds-enhanced-notice.notice."+s).remove()},5e3),r(document).off("click",".mds-enhanced-notice .notice-dismiss").on("click",".mds-enhanced-notice .notice-dismiss",function(){r(this).closest(".mds-enhanced-notice").remove()})}function l(e,t){e.data("original-text",e.html()),e.prop("disabled",!0).html('<span class="mds-spinner"></span> '+t).addClass("mds-btn-loading")}function c(e,t=null){t=t||e.data("original-text");e.prop("disabled",!1).html(t).removeClass("mds-btn-loading")}try{let i=window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.license_key?String(MDS_EXTENSIONS_DATA.license_key).trim():"",o=(window.MDS_EXTENSIONS_DATA&&MDS_EXTENSIONS_DATA.extension_server_url?MDS_EXTENSIONS_DATA.extension_server_url:"http://localhost:15346").replace(/\/+$/,"");var e=r('table.widefat tbody tr[data-is-premium="true"]').filter(function(){return!r(this).attr("data-plugin-file")});function u(e,t){var n=e.find(".mds-install-extension");n.length&&(n.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title",t||"License required"),n="License required",(e=(t=e).find(".mds-purchase-buttons")).length)&&!t.find(".mds-license-required-note").length&&r('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">'+(n||"License required")+"</span>").appendTo(e)}if(e.length)if(i){let a=e.toArray();!function e(t){if(!(t>=a.length)){let n=r(a[t]);var s=n.data("extension-id");if(u(n,"Validating license..."),!s)return e(t+1);s=o+"/api/public/licenses/lookup?key="+encodeURIComponent(i)+"&extensionId="+encodeURIComponent(String(s)),fetch(s,{method:"GET",credentials:"omit"}).then(e=>e.ok?e.json():Promise.reject(new Error("HTTP "+e.status))).then(e=>{var t;!0===(e&&!0===e.valid||e&&e.data&&!0===e.data.valid)?(e=n,(t=e.find(".mds-install-extension")).length&&(t.prop("disabled",!1).removeClass("disabled").removeAttr("aria-disabled").removeAttr("title"),e.find(".mds-license-required-note").remove())):u(n)}).catch(()=>{u(n)}).finally(()=>e(t+1))}}(0)}else e.each(function(){u(r(this))})}catch(e){r('table.widefat tbody tr[data-is-premium="true"]').filter(function(){return!r(this).attr("data-plugin-file")}).each(function(){var e=r(this),t=e.find(".mds-install-extension"),t=(t.length&&t.prop("disabled",!0).addClass("disabled").attr("aria-disabled","true").attr("title","License required"),e.find(".mds-purchase-buttons"));t.length&&!e.find(".mds-license-required-note").length&&t.append('<span class="mds-license-required-note" title="License required" style="margin-left:8px;color:#666;">License required</span>')})}r(document).on("click",".mds-check-updates",function(e){e.preventDefault();let i=r(this),o=i.closest("tr");var e=o.data("extension-id"),t=o.data("version"),n=o.data("plugin-file");l(i,"Checking..."),r.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_check_extension_updates",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,current_version:t,plugin_file:n},dataType:"json",success:function(e){var t,n,s,a;e.success?(t=e.data,n=o,s=n.find(".mds-update-cell"),a=n.find(".mds-check-updates"),t.update_available?(t=`
				<div class="mds-update-available">
					<p><strong>üöÄ Version ${t.latest_version} available!</strong></p>
					${t.changelog?`<div class="mds-changelog"><strong>What's new:</strong><br>${t.changelog}</div>`:""}
					<button class="button button-primary mds-install-update"
							data-download-url="${t.download_url}"
							data-extension-slug="${t.extension_slug}"
							data-extension-id="${t.extension_id||""}">
						<span class="mds-btn-icon">‚¨ÜÔ∏è</span> Update Now
					</button>
				</div>
			`,s.html(t),c(a,"Check Again")):(s.html('<span class="mds-no-updates">‚úÖ You have the latest version.</span>'),c(a)),n.trigger("mds-update-checked")):(d("error",e.data.message||"Failed to check for updates."),c(i))},error:function(e,t,n){console.error("Error checking for updates:",n),d("error","An error occurred while checking for updates."),c(i)}})}),r(document).on("click",".mds-install-update",function(e){e.preventDefault();let s=r(this);var e=s.data("extension-id"),t=s.data("extension-slug"),n=s.data("download-url");confirm("üöÄ Ready to update? This will enhance your extension with the latest features and improvements!")&&(l(s,"Updating..."),r.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension_update",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:e,extension_slug:t,download_url:n},dataType:"json",success:function(e){e.success?(d("success","üéâ "+(e.data.message||"Update installed successfully!")),e.data.reload&&setTimeout(()=>window.location.reload(),2e3)):(d("error",e.data.message||"Failed to install update."),c(s))},error:function(e,t,n){console.error("Error installing update:",n),d("error","An error occurred while installing the update."),c(s)}}))}),r(document).on("click",".mds-install-extension",function(e){e.preventDefault();let s=r(this);var e=s.closest("tr"),t=s.data("extension-id"),n=s.data("extension-slug"),e=e.data("is-premium"),e=!0===e||"true"===e,a=!(!MDS_EXTENSIONS_DATA.license_key||!String(MDS_EXTENSIONS_DATA.license_key).trim());e&&!a?d("warning",`This extension requires a valid license. Enter your license key at Million Dollar Script ‚Üí Options ‚Üí System ‚Üí License Key. <a href="${MDS_EXTENSIONS_DATA.settings_url||"#"}">Open System tab</a>`,!1):(l(s,"Installing..."),r.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_install_extension",nonce:MDS_EXTENSIONS_DATA.nonce,extension_id:t,extension_slug:n},dataType:"json",success:function(e){e.success?(d("success","üéâ Awesome! Extension installed and ready to boost your results!"),s.removeClass("mds-btn-primary").addClass("mds-btn-active").html('<span class="mds-btn-icon">‚úì</span> Installed'),e.data.reload&&setTimeout(()=>window.location.reload(),2e3)):(d("error",e.data.message||"Failed to install extension."),c(s))},error:function(e,t,n){console.error("Error installing extension:",n),d("error","An error occurred while installing the extension."),c(s)}}))}),r(document).on("click",".mds-activate-extension",function(e){e.preventDefault();let s=r(this);var e=s.data("extension-slug"),t=s.data("nonce");confirm("‚ö° Activate this extension and start using its powerful features?")&&(l(s,"Activating..."),r.ajax({url:MDS_EXTENSIONS_DATA.ajax_url,type:"POST",data:{action:"mds_activate_extension",nonce:t,extension_slug:e},dataType:"json",success:function(e){var t;e.success?(d("success","üéâ Extension is now active and ready to use!",!1),t=r('<span class="button button-secondary mds-ext-active" disabled="disabled">Active</span>'),s.replaceWith(t)):(d("error",e.data.message||"Failed to activate extension."),c(s))},error:function(e,t,n){console.error("Error activating extension:",n),d("error","An error occurred while activating the extension."),c(s)}}))}),r(document).on("click",".mds-check-all-updates",function(e){e.preventDefault();let t=r(this),n=r("tr[data-extension-id]"),s=0,a=!1;function i(){s>=n.length&&(c(t),a?d("success","üîÑ Update check complete! Some extensions have updates available."):d("success","‚úÖ All extensions are up to date!"))}l(t,"Checking All..."),n.each(function(){let e=r(this);var t=e.find(".mds-check-updates");t.prop("disabled")?(s++,i()):(t.trigger("click"),e.off("mds-update-checked").on("mds-update-checked",function(){s++,e.find(".mds-update-available").length&&(a=!0),i()}))})}),console.log("üöÄ MDS Extensions enhanced interface loaded successfully!")});