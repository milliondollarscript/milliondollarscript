jQuery(document).ready(function(a){var o=a("#mds-log-viewer"),e=a("#mds-log-spinner"),t=a("#mds-toggle-logging"),n=a("#mds-toggle-live-update"),s=a("#mds-clear-log"),r=null,c=0;function l(){e.addClass("is-active")}function i(){e.removeClass("is-active")}function d(e,s){s='<div class="notice notice-'+s+' is-dismissible"><p>'+e+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>';a("#mds-logs-page h1").after(s),a(document).on("click","#mds-logs-page .notice-dismiss",function(){a(this).closest(".notice").remove()})}function m(e){var s="";return e&&0!==e.length?(s+='<ul class="mds-log-entries">',e.forEach(function(e){s=(s=(s=(s+='<li class="mds-log-entry mds-log-level-'+(e.level?e.level.toLowerCase():"raw")+'">')+'<span class="mds-log-timestamp">['+(e.timestamp||"No timestamp")+"]</span> ")+'<span class="mds-log-level">['+(e.level||"RAW")+"]</span> ")+'<span class="mds-log-message">'+(e.message||"")+"</span>",e.count&&1<e.count&&(s+=' <span class="mds-log-count">(x'+e.count+")</span>"),s+="</li>"}),s+="</ul>"):""}function g(t=!1){var e={action:"mds_fetch_log_entries",nonce:mdsLogsData.nonce};t&&(e.last_size=c),l(),a.post(mdsLogsData.ajax_url,e,function(e){var s;i(),e.success?(c=e.data.size,t?e.data.entries&&0<e.data.entries.length&&(s=m(e.data.entries),o.append(s),n.is(":checked"))&&o.scrollTop(o[0].scrollHeight):e.data.entries&&0<e.data.entries.length?(s=m(e.data.entries),o.html(s)):o.html("<p>"+(e.data.message||mdsLogsData.text.log_empty)+"</p>")):(d(e.data.message||mdsLogsData.text.error_occurred,"error"),o.html("<p>"+mdsLogsData.text.error_loading+"</p>"))}).fail(function(e,s,t){i(),d(mdsLogsData.text.error_occurred,"error"),o.html("<p>"+mdsLogsData.text.error_loading+"</p>")})}t.on("change",function(){var s=a(this).is(":checked");l(),a.post(mdsLogsData.ajax_url,{action:"mds_toggle_logging",nonce:mdsLogsData.nonce,enabled:s?"yes":"no"},function(e){i(),e.success||(d(e.data.message||mdsLogsData.text.error_occurred,"error"),t.prop("checked",!s))}).fail(function(){i(),d(mdsLogsData.text.error_occurred,"error"),t.prop("checked",!s)})}),s.on("click",function(){confirm(mdsLogsData.text.confirm_clear)&&(l(),a.post(mdsLogsData.ajax_url,{action:"mds_clear_log",nonce:mdsLogsData.nonce},function(e){i(),e.success?(o.html("<p>"+mdsLogsData.text.log_cleared_viewer+"</p>"),c=0):d(e.data.message||mdsLogsData.text.error_occurred,"error")}).fail(function(){i(),d(mdsLogsData.text.error_occurred,"error")}))}),n.on("change",function(){a(this).is(":checked")?(g(!0),r=setInterval(function(){g(!0)},5e3)):r&&(clearInterval(r),r=null)}),g()});