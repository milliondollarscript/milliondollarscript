jQuery(document).ready(function(G){var J=G("#mds-log-viewer"),W=G("#mds-log-spinner"),P=G("#mds-toggle-logging"),X=G("#mds-toggle-live-update"),B=G("#mds-clear-log"),O=null,Q=0;function R(){W.addClass("is-active")}function K(){W.removeClass("is-active")}function M(F,A){var q='<div class="notice notice-'+A+' is-dismissible"><p>'+F+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>';G("#mds-logs-page h1").after(q),G(document).on("click","#mds-logs-page .notice-dismiss",function(){G(this).closest(".notice").remove()})}function Y(F){var A="";if(!F||F.length===0)return"";return A+='<ul class="mds-log-entries">',F.forEach(function(q){if(A+='<li class="mds-log-entry mds-log-level-'+(q.level?q.level.toLowerCase():"raw")+'">',A+='<span class="mds-log-timestamp">['+(q.timestamp||"No timestamp")+"]</span> ",A+='<span class="mds-log-level">['+(q.level||"RAW")+"]</span> ",A+='<span class="mds-log-message">'+(q.message||"")+"</span>",q.count&&q.count>1)A+=' <span class="mds-log-count">(x'+q.count+")</span>";A+="</li>"}),A+="</ul>",A}function T(F=!1){var A={action:"mds_fetch_log_entries",nonce:mdsLogsData.nonce};if(F)A.last_size=Q;R(),G.post(mdsLogsData.ajax_url,A,function(q){if(K(),q.success)if(Q=q.data.size,F){if(q.data.entries&&q.data.entries.length>0){var Z=Y(q.data.entries);if(J.append(Z),X.is(":checked"))J.scrollTop(J[0].scrollHeight)}}else if(q.data.entries&&q.data.entries.length>0){var _=Y(q.data.entries);J.html(_)}else J.html("<p>"+(q.data.message||mdsLogsData.text.log_empty)+"</p>");else M(q.data.message||mdsLogsData.text.error_occurred,"error"),J.html("<p>"+mdsLogsData.text.error_loading+"</p>")}).fail(function(q,Z,_){K(),M(mdsLogsData.text.error_occurred,"error"),J.html("<p>"+mdsLogsData.text.error_loading+"</p>")})}P.on("change",function(){var F=G(this).is(":checked");R(),G.post(mdsLogsData.ajax_url,{action:"mds_toggle_logging",nonce:mdsLogsData.nonce,enabled:F?"yes":"no"},function(A){if(K(),A.success);else M(A.data.message||mdsLogsData.text.error_occurred,"error"),P.prop("checked",!F)}).fail(function(){K(),M(mdsLogsData.text.error_occurred,"error"),P.prop("checked",!F)})}),B.on("click",function(){if(confirm(mdsLogsData.text.confirm_clear))R(),G.post(mdsLogsData.ajax_url,{action:"mds_clear_log",nonce:mdsLogsData.nonce},function(F){if(K(),F.success)J.html("<p>"+mdsLogsData.text.log_cleared_viewer+"</p>"),Q=0;else M(F.data.message||mdsLogsData.text.error_occurred,"error")}).fail(function(){K(),M(mdsLogsData.text.error_occurred,"error")})}),X.on("change",function(){if(G(this).is(":checked"))T(!0),O=setInterval(function(){T(!0)},5000);else if(O)clearInterval(O),O=null}),T()});
