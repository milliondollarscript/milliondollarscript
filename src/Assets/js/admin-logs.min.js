jQuery(document).ready((function(e){var s=e("#mds-log-viewer"),t=e("#mds-log-spinner"),a=e("#mds-toggle-logging"),o=e("#mds-toggle-live-update"),n=e("#mds-clear-log"),r=null,c=0;function i(){t.addClass("is-active")}function l(){t.removeClass("is-active")}function d(s,t){var a='<div class="notice notice-'+t+' is-dismissible"><p>'+s+'</p><button type="button" class="notice-dismiss"><span class="screen-reader-text">Dismiss this notice.</span></button></div>';e("#mds-logs-page h1").after(a),e(document).on("click","#mds-logs-page .notice-dismiss",(function(){e(this).closest(".notice").remove()}))}function m(e){var s="";return e&&0!==e.length?(s+='<ul class="mds-log-entries">',e.forEach((function(e){s+='<li class="mds-log-entry mds-log-level-'+(e.level?e.level.toLowerCase():"raw")+'">',s+='<span class="mds-log-timestamp">['+(e.timestamp||"No timestamp")+"]</span> ",s+='<span class="mds-log-level">['+(e.level||"RAW")+"]</span> ",s+='<span class="mds-log-message">'+(e.message||"")+"</span>",e.count&&e.count>1&&(s+=' <span class="mds-log-count">(x'+e.count+")</span>"),s+="</li>"})),s+="</ul>"):""}function g(t=!1){var a={action:"mds_fetch_log_entries",nonce:mdsLogsData.nonce};t&&(a.last_size=c),i(),e.post(mdsLogsData.ajax_url,a,(function(e){if(l(),e.success)if(c=e.data.size,t){if(e.data.entries&&e.data.entries.length>0){var a=m(e.data.entries);s.append(a),o.is(":checked")&&s.scrollTop(s[0].scrollHeight)}}else if(e.data.entries&&e.data.entries.length>0){var n=m(e.data.entries);s.html(n)}else s.html("<p>"+(e.data.message||mdsLogsData.text.log_empty)+"</p>");else d(e.data.message||mdsLogsData.text.error_occurred,"error"),s.html("<p>"+mdsLogsData.text.error_loading+"</p>")})).fail((function(e,t,a){l(),d(mdsLogsData.text.error_occurred,"error"),s.html("<p>"+mdsLogsData.text.error_loading+"</p>")}))}a.on("change",(function(){var s=e(this).is(":checked");i(),e.post(mdsLogsData.ajax_url,{action:"mds_toggle_logging",nonce:mdsLogsData.nonce,enabled:s?"yes":"no"},(function(e){l(),e.success||(d(e.data.message||mdsLogsData.text.error_occurred,"error"),a.prop("checked",!s))})).fail((function(){l(),d(mdsLogsData.text.error_occurred,"error"),a.prop("checked",!s)}))})),n.on("click",(function(){const t=function(){i(),e.post(mdsLogsData.ajax_url,{action:"mds_clear_log",nonce:mdsLogsData.nonce},(function(e){l(),e.success?(s.html("<p>"+mdsLogsData.text.log_cleared_viewer+"</p>"),c=0):d(e.data.message||mdsLogsData.text.error_occurred,"error")})).fail((function(){l(),d(mdsLogsData.text.error_occurred,"error")}))};"undefined"!=typeof MDSModalUtility?MDSModalUtility.confirm(mdsLogsData.text.confirm_clear,t):confirm(mdsLogsData.text.confirm_clear)&&t()})),o.on("change",(function(){e(this).is(":checked")?(g(!0),r=setInterval((function(){g(!0)}),5e3)):r&&(clearInterval(r),r=null)})),g()}));