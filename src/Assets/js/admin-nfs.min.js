jQuery(document).ready(function(q){let M=[],N=[],J=q(document),I=q(".grid"),W=I.css("background-image").replace(/^url\(["']?/,"").replace(/["']?\)$/,""),U=q('<img alt="" src=""/>').attr("src",W),E=q(document.createDocumentFragment());function X(){if(I=q(document).find(".grid"),I.data("covered")===!1)return;E=q("<div>",{id:"nfs-covered-image",class:"nfs-covered"}),I.append(E)}function Y(){let j=G.getSelection();if(j.length===0)return;if(!E)E=q(".nfs-covered-image");let C=I.data("width"),D=I.data("height");E.width(j[j.length-1].offsetLeft-j[0].offsetLeft+C+"px"),E.height(j[j.length-1].offsetTop-j[0].offsetTop+D+"px"),E.css("position","absolute"),E.css("left",j[0].offsetLeft+"px"),E.css("top",j[0].offsetTop+"px")}function Z(j,C,D,F){if(C!==void 0&&C.length>0)q(document).find("#mds-admin-css-inline-css").html(C);q(document).find(".admin-content-inner").replaceWith(j).promise().done(function(){q(document).find(".loading").hide(function(){if(q(this).remove(),D)q('<span class="message">'+D+"</span>").insertBefore(".grid").fadeOut(1e4,function(){q(this).remove()});F.resolve("success")})})}function P(j){J.scrollTop(0),q('<span class="message">'+MDS.lang.error+" "+j+"</span>").insertBefore(".grid").fadeOut(1e4,function(){q(this).remove()})}function O(j){let C=q.Deferred();try{if(j.success===!0)Z(j.data.html,j.data.css,MDS.lang.success,C);else P(j.data[0].message),C.reject("error")}catch(D){console.log(D),P(MDS.lang.error),C.reject("error")}return C.promise()}U.off("load"),U.on("load",function(){q(this).remove(),q(".loading").remove()}).each(function(){if(this.complete)q(this).trigger("load")});function y(j){let C=q(j),D;if(C.hasClass("nfs")){D=C.attr("data-block"),M.push(D);let F=N.indexOf(D);if(F!==-1)N.splice(F,1)}else if(C.hasClass("free")){D=C.attr("data-block"),N.push(D);let F=M.indexOf(D);if(F!==-1)M.splice(F,1)}}function z(j){let C=q(j);if(C.hasClass("nfs"))C.removeClass("nfs"),C.addClass("free");else C.removeClass("free"),C.addClass("nfs")}function H(){return new SelectionArea({selectables:["span.block"],startareas:[".grid"],boundaries:[".grid"]})}let G=H();q(window).off("unload"),q(window).on("unload",function(){G.destroy()}),G.off("beforestart"),G.off("move"),G.off("stop"),G.on("beforestart",(j)=>{for(let C of j.store.stored)q(C).removeClass("selected");if(G.clearSelection(!0),E.length>0)E.remove(),E=null;X()}).on("move",(j)=>{for(let C of j.store.changed.added)q(C).addClass("selected");for(let C of j.store.changed.removed)q(C).removeClass("selected");if(!E)E=q(".nfs-covered-image");if(j.store.selected.length>0)E.width(j.store.selected[j.store.selected.length-1].offsetLeft-j.store.selected[0].offsetLeft+10+"px"),E.height(j.store.selected[j.store.selected.length-1].offsetTop-j.store.selected[0].offsetTop+10+"px")}).on("stop",(j)=>{let C=j.store.selected;for(let D of C)z(D),y(D);Y()});let K=q(".save"),L=q(".reset"),Q=!1;J.off("click",".save"),J.on("click",".save",function(j){if(j.preventDefault(),j.stopPropagation(),I.append('<img class="loading" src="'+MDS.MDS_BASE_URL+'src/Assets/images/ajax-loader.gif" alt="" />'),K.prop("disabled",!0),L.prop("disabled",!0),!Q)Q=!0,q.post(MDS.ajaxurl,{action:"mds_nfs_save",mds_nfs_nonce:MDS.mds_nfs_nonce,BID:q("#mds-nfs-grid").val(),addnfs:JSON.stringify(M),remnfs:JSON.stringify(N),dataType:"json"}).always(function(C){O(C).then(function(D){if(D!=="success")console.log(D)}),Q=!1,q(".loading").hide(function(){q(this).remove()}),K.prop("disabled",!1),L.prop("disabled",!1)});return!1});function A(j,C){q('<div id="confirm-dialog">'+C+"</div>").appendTo(".outer_box"),q("#confirm-dialog").dialog({title:j,modal:!0,width:"auto",resizable:!1,position:{my:"center top",at:"center top+1%",of:q(".outer_box")},buttons:{Yes:function(){I.append('<img class="loading" src="'+MDS.MDS_BASE_URL+'src/Assets/images/ajax-loader.gif" alt="" />'),q.post(MDS.ajaxurl,{action:"mds_nfs_reset",mds_nfs_nonce:MDS.mds_nfs_nonce,BID:q("#mds-nfs-grid").val(),dataType:"json"}).done(function(D){G.clearSelection(),O(D).then(function(F){if(F!=="success")console.log(F)})}).fail(function(D){O(D).then(function(F){if(F!=="success")console.log(F)})}),q(this).dialog("close")},No:function(){q(this).dialog("close"),K.prop("disabled",!1),L.prop("disabled",!1)}},close:function(){q(this).remove(),K.prop("disabled",!1),L.prop("disabled",!1)}})}J.off("click",".reset"),J.on("click",".reset",function(j){return j.preventDefault(),j.stopPropagation(),K.prop("disabled",!0),L.prop("disabled",!0),A(MDS.lang.reset,MDS.lang.reset_message),!1});function B(j,C,D){return C.find("input").attr("disabled",!0),!0}function S(j,C,D,F){J.scrollTop(0),G.clearSelection(),O(j).then(function(V){if(V==="success")console.log(V)})}J.on("change","#mds-nfs-grid",function(){let j=q(this).closest("form");q(j).ajaxSubmit({target:".outer_box",type:"POST",url:MDS.adminpost,delegation:!0,beforeSubmit:B,success:S,data:{action:"mds_nfs_grid",mds_nfs_nonce:MDS.mds_nfs_nonce},error:function(C,D,F){P(F)}})},null,"json")});
