function add_ajax_loader(e){var t=jQuery("<div class='ajax-loader'></div>");jQuery(e).append(t),t.css("top",jQuery(e).position().top).css("left",jQuery(e).width()/2-t.width()/2)}function remove_ajax_loader(){jQuery(".ajax-loader").remove()}var initialized=!1;function defer(e,t){window[e]?t():setTimeout(function(){defer(e,t)},50)}function mds_grid(e,t,i,n){var a;0<jQuery("#"+e).length||(add_ajax_loader("."+e),(a=jQuery("<div class='grid-inner' id='"+e+"'></div>")).css("width",i).css("height",n),jQuery("."+e).append(a),i={action:"mds_ajax_grid",type:"show_grid",mds_nonce:MDS.mds_nonce,BID:t},jQuery(a).load(MDS.ajaxurl,i,function(){mds_init("#theimage",!0,"NO"!==MDS.ENABLE_MOUSEOVER,!1,!0)}))}function mds_stats(e,t,i,n){var a;0<jQuery("#"+e).length||((a=jQuery("<div class='stats-inner' id='"+e+"'></div>")).css("width",i).css("height",n),jQuery("."+e).append(a),i={action:"mds_ajax",type:"show_stats",mds_nonce:MDS.mds_nonce,BID:t},jQuery(a).load(MDS.ajaxurl,i,function(){mds_init("#"+e,!1,!1,!1,!1)}))}function mds_list(e,t,i,n){var a;0<jQuery("#"+e).length||((a=jQuery("<div class='list-inner' id='"+e+"'></div>")).css("width",i).css("height",n),jQuery("."+e).append(a),i={action:"mds_ajax",type:"show_list",mds_nonce:MDS.mds_nonce,BID:t},jQuery(a).load(MDS.ajaxurl,i,function(){mds_init("#"+e,!1,!0,"list",!1)}))}function mds_users(e,t,i,n){var a;0<jQuery("#"+e).length||((a=jQuery("<div class='users-inner' id='"+e+"'></div>")).css("width",i).css("height",n),jQuery("."+e).append(a),i={action:"mds_ajax",type:"show_users",mds_nonce:MDS.mds_nonce,BID:t},jQuery(a).load(MDS.ajaxurl,i,function(){mds_init("#"+e,!1,!0,!1,!1)}))}function mds_load_ajax(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),0!==window.mds_shortcode_containers.length)for(let e=0;e<window.mds_shortcode_containers.length;e++){var t=jQuery(window.mds_shortcode_containers[e]).attr("data-mds-params");void 0!==t&&(t=JSON.parse(t))&&(void 0===window.mds_shortcodes&&(window.mds_shortcodes=[]),void 0===window.mds_shortcodes[t.container_id])&&(window.mds_shortcodes[t.container_id]=!0,new window.mds_ajax(t.type,t.container_id,t.align,t.width,t.height,t.id))}}function updateTippyPosition(){window.tippy_instance&&window.tippy_instance.popperInstance&&window.tippy_instance.popperInstance.update().then(()=>{})}function add_tippy(){let t="<div class='ajax-loader'></div>",i=/iPhone|iPad|iPod/.test(navigator.platform),e=50;"mouseenter"===MDS.TOOLTIP_TRIGGER&&(e=400);var n=".mds-container area,.list-link";jQuery("area").off("click.mds-tippy"),jQuery(document).off("click.mds-tippy","area").on("click.mds-tippy","area",function(e){var t,i;if(!this._tippy||!this._tippy._content)return e.preventDefault(),e.stopPropagation(),(t=(e=jQuery(this)).data("data"))&&t.banner_id&&t.block_id||(i=(i=e.attr("href")||"").match(/bid=(\d+).*?aid=(\d+).*?block_id=(\d+)/i)||i.match(/aid=(\d+).*?bid=(\d+).*?block_id=(\d+)/i))&&(t={banner_id:parseInt(i[1]||i[2],10),aid:parseInt(i[2]||i[1],10),block_id:parseInt(i[3],10)},e.data("data",t)),this._tippy||"function"!=typeof tippy||(tippy(this,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay:"mouseenter"===MDS.TOOLTIP_TRIGGER?400:50,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999}),this._tippy.show()),!1}),tippy(n,{theme:"light",content:t,duration:50,delay:e,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999,popperOptions:{strategy:"absolute",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{fallbackPlacements:["bottom","right"]}},{name:"preventOverflow",options:{altAxis:!0,tether:!1,boundary:document}}]},onCreate(e){e._isFetching=!1,e._content=null,e._error=null,e._initialized=!0},onShow(n){var e,t;n._isFetching||n._content||n._error||(i&&jQuery(n.reference).trigger("click"),n._isFetching=!0,(t=(e=jQuery(n.reference)).data("data"))&&t.banner_id&&t.block_id?(t={action:"mds_ajax",type:"ga",mds_nonce:MDS.mds_nonce,aid:t.aid||0,bid:t.banner_id,block_id:t.block_id},jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:t,dataType:"html",crossDomain:!0}).done(function(e){n.setContent(e),n._content=!0}).fail(function(e,t,i){n._error=i,n.setContent("Request failed. "+i)}).always(function(){n._isFetching=!1,mds_load_ajax()})):(t=e.closest("map").attr("id"),console.error("MDS Tooltip: Missing data attributes for tooltip on "+t),n.setContent("Error: Missing data for this block"),n._error="missing_data",n._isFetching=!1))},onHidden(e){e.setContent(t),e._content=null,e._error=null}}),window.is_touch=!1,document.addEventListener("touchstart",function(){window.is_touch=!0}),document.addEventListener("scroll",function(){window.is_touch||tippy.hideAll()}),window.addEventListener("resize",function(){updateTippyPosition()})}function mdsTippyOnTrigger(e,t){"click"===t.type&&MDS.TOOLTIP_TRIGGER&&MDS.TOOLTIP_TRIGGER.includes("click")&&t.preventDefault()}let rescaling=!1;function rescale(e){rescaling||(rescaling=!0,e.imageScale({scale:"best-fit",align:"top",rescaleOnResize:!0,hideParentOverflow:!1,didScale:function(e,t){rescaling=!1,updateTippyPosition()}}))}function mds_loaded_event(e,t,i,n,a){!0!==window.mds_loaded&&(window.mds_loaded=!0,jQuery(document).trigger({type:"mds-loaded",el:e,scalemap:t,tippy:i,mdstype:n,isgrid:a}))}function mds_load_tippy(e,t,i,n,a){let o=!1;return e&&null==window.tippy_instance&&"NO"!==MDS.ENABLE_MOUSEOVER&&(console.log("[MDS DEBUG] Loading Tippy for element:",t),o=!0,defer("Popper",()=>{defer("tippy",()=>{console.log("[MDS DEBUG] Tippy deferred, adding now."),add_tippy()})})),o}function mds_handle_mouseenter(){window.click_data=jQuery(this).data("data")}function mds_handle_click(){var e;window.click_data=jQuery(this).data("data"),"NO"===MDS.ENABLE_MOUSEOVER&&(e={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id},jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:e,dataType:"html",crossDomain:!0}).done(function(){window.open(window.click_data.url,MDS.link_target)}))}function mds_handle_url_click(){let e=jQuery(this);var t={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:t,dataType:"html",crossDomain:!0}).done(function(){window.open(e.attr("href"),MDS.link_target)})}function mds_init(t,e,i,n,a){console.log("[MDS DEBUG] mds_init called with:",{el:t,scalemap:e,tippy:i,type:n,isgrid:a});var o=jQuery(t);if(o.data("mds-initialized"))console.log("[MDS DEBUG] Element already initialized:",t);else if(o.data("mds-initialized",!0),t&&0!==o.length){o.is(":visible")||console.warn("[MDS WARN] Element is not visible, delaying initialization:",t);try{console.log("[MDS DEBUG] Initializing ImageMap for element:",t),"function"!=typeof ImageMap?console.error("[MDS ERROR] ImageMap function is not defined!"):(ImageMap(t,e),console.log("[MDS DEBUG] ImageMap initialized for element:",t),mds_loaded_event(o,e,i,n,a),mds_load_tippy(i,o,e,n,a))}catch(e){console.error("[MDS ERROR] Error during mds_init:",e,"for element:",t)}}else console.error("[MDS ERROR] mds_init called with invalid element:",t)}function mds_load_ajax(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),0!==window.mds_shortcode_containers.length)for(let e=0;e<window.mds_shortcode_containers.length;e++){var t=jQuery(window.mds_shortcode_containers[e]).attr("data-mds-params");void 0!==t&&(t=JSON.parse(t))&&(void 0===window.mds_shortcodes&&(window.mds_shortcodes=[]),void 0===window.mds_shortcodes[t.container_id])&&(window.mds_shortcodes[t.container_id]=!0,new window.mds_ajax(t.type,t.container_id,t.align,t.width,t.height,t.id))}}function get_selected_package(){return"undefined"!=typeof jQuery&&0<jQuery("#pack-grid").length?jQuery("#pack-grid").val():0}function mds_update_package(e){var t=get_selected_package(),e=e.find('input[name="package"]');0!==t&&0<e.length&&e.val(t)}function mdsToggleMenu(){document.getElementById("mds-users-menu").classList.toggle("mds-show-menu")}function confirmLink(t,e){if(""===e)window.location.href=t.href;else if(confirm(e+"\n")){let e=t.href;if(null==(e=null!=e&&""!==e&&!e.endsWith("#")?e:jQuery(t).data("link"))||""===e)return!0;e.includes("?")?e+="&is_js_confirmed=1":e+="?is_js_confirmed=1",window.location.href=e}return!1}jQuery(document).on("mds-loaded",function(e){setTimeout(function(){window.dispatchEvent(new Event("resize"))},150)}),window.mds_ajax=function(n,a,e,t,i,o){var d=jQuery("#"+a);switch(d.width(t).height(i).css("max-width","100%"),e){case"left":d.css("float","left");break;case"center":d.css("display","block").css("margin","0 auto");break;case"right":d.css("float","right")}0<d.length&&(add_ajax_loader(d),t=new URL(window.location),"1"===(i=new URLSearchParams(t.search)).get("json")&&(i.delete("json"),t.search=i.toString(),window.history.replaceState({},"",t.toString())),window.mds_ajax_request=jQuery.ajax({url:MDS.ajaxurl,data:{BID:o,action:"mds_ajax",type:n,mds_nonce:MDS.mds_nonce,get_params:JSON.stringify(Object.fromEntries(new URLSearchParams(window.location.search)))},type:"POST",dataType:"html",success:function(t){if(remove_ajax_loader(),"payment"!==n&&jQuery(d).html(t),"grid"===n)mds_init("#theimage",!0,"NO"!==MDS.ENABLE_MOUSEOVER,!1,!0),jQuery("#theimage").trigger("load");else if("list"===n)mds_init("#"+a,!1,!0,"list",!1),jQuery("#"+a).trigger("load");else if("payment"===n||"confirm-order"===n)try{var e=JSON.parse(t);!0===e.success?e.data&&(e.data.redirect?(jQuery(d).html(e.data.message),window.location=e.data.redirect):jQuery(d).html(e.data)):!1===e.success?e.data&&(e.data.message?jQuery(d).html(e.data.message):jQuery(d).html(e.data)):console.log("Unknown data: ",e)}catch(e){jQuery(d).html(t)}else try{var i=JSON.parse(t);!0===i.success?i.data&&(i.data.redirect?(jQuery(d).html(i.data.message),window.location=i.data.redirect):jQuery(d).html(i.data)):!1===i.success?i.data&&(i.data.message?jQuery(d).html(i.data.message):jQuery(d).html(i.data)):console.log("Unknown data: ",i)}catch(e){jQuery(d).html(t)}wp.hooks.doAction("mds_ajax_complete")},error:function(e,t,i){remove_ajax_loader()}}))},jQuery(window).on("load",function(){0<jQuery("#publish-grid").length&&mds_init("#publish-grid",!0,!1,!1,!0),mds_load_ajax()}),jQuery(document).on("load",function(){0<jQuery("#publish-grid").length&&(console.log("[MDS DEBUG] document.ready init publish-grid"),mds_init("#publish-grid",!0,!1,!1,!0))}),jQuery(document).on("load",function(){var e;0<jQuery("body.login").length&&0<(e=jQuery("#user_login")).length&&e.attr("placeholder","Username or Email Address")}),jQuery(document).on("ajaxComplete",function(e,t,i){mds_load_ajax(),jQuery(".mds_upload_image").on("click",function(e){e.preventDefault(),e.stopPropagation();e=jQuery(this),e.prop("disabled",!0),e.attr("value",MDS.UPLOADING),e=e.parent("form");return mds_update_package(e),e.submit(),!1}),jQuery(".mds_pointer_graphic").on("load",function(e){jQuery(".mds_upload_image").prop("disabled",!1),jQuery(this).attr("value","Upload")}),jQuery(".mds_save_ad_button").on("click",function(){var e=jQuery(this);e.prop("disabled",!0),e.attr("value",MDS.SAVING),e.closest("form").submit()}),jQuery("#mds-complete-button").on("click",function(e){e.preventDefault(),e.stopPropagation();e=jQuery(this);return e.prop("disabled",!0),e.attr("value",MDS.COMPLETING),window.location=MDS.manageurl+"?mds-action=complete&order_id="+e.data("order-id")+"&BID="+e.data("grid"),!1}),jQuery("#mds-confirm-button").on("click",function(e){e.preventDefault(),e.stopPropagation();e=jQuery(this);return e.prop("disabled",!0),e.attr("value",MDS.CONFIRMING),window.location=MDS.paymenturl+"?mds-action=confirm&order_id="+e.data("order-id")+"&BID="+e.data("grid"),!1}),jQuery(".mds-write.big_button").on("click",function(e){e.preventDefault(),e.stopPropagation();e=jQuery(this).closest("form");return mds_update_package(e),e.submit(),jQuery(this).prop("disabled",!0).attr("value",MDS.WAIT),!1}),jQuery(".mds-button").on("click",function(){jQuery(".mds-button").prop("disabled",!0).attr("value",MDS.WAIT)}),jQuery(".mds-edit-button").on("click",function(e){e.preventDefault(),e.stopPropagation(),jQuery(".mds-edit-button").prop("disabled",!0).attr("value",MDS.WAIT);var e=jQuery(this),t=-1!==MDS.manageurl.indexOf("?")?"&":"?";return window.location=MDS.manageurl+t+"mds-action=manage&aid="+e.data("pixel-id")+"&json=1",!1}),jQuery(".mds-upload-submit").on("click",function(){return jQuery(this).attr("value",MDS.UPLOADING).prop("disabled",!0),jQuery(this).closest("form").append(jQuery("<input>").attr({type:"hidden",name:this.name,value:this.value})),jQuery(this).closest("form").submit(),!0}),jQuery(".mds-pixels-list").accordion({header:".mds-manage-row",collapsible:!0,active:0})});