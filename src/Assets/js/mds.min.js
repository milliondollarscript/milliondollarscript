/*
 * Million Dollar Script Two
 *
 * @author      Ryan Rhode
 * @copyright   (C) 2025, Ryan Rhode
 * @license     https://opensource.org/licenses/GPL-3.0 GNU General Public License, version 3
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *
 *    Million Dollar Script
 *    Pixels to Profit: Ignite Your Revolution
 *    https://milliondollarscript.com/
 *
 */
function add_ajax_loader(e){let t=jQuery("<div class='ajax-loader'></div>");jQuery(e).append(t),t.css("top",jQuery(e).position().top).css("left",jQuery(e).width()/2-t.width()/2)}function remove_ajax_loader(){jQuery(".ajax-loader").remove()}void 0===window.MDS&&(window.MDS={}),void 0===window.MDS.hooks&&(window.MDS.hooks={});var initialized=!1;function defer(e,t){window[e]?t():setTimeout((function(){defer(e,t)}),50)}function mds_grid(e,t,i,n){if(jQuery("#"+e).length>0)return;add_ajax_loader("."+e);let o=jQuery("<div class='grid-inner' id='"+e+"'></div>");o.css("width",i).css("height",n),jQuery("."+e).append(o);const a={action:"mds_ajax_grid",type:"show_grid",mds_nonce:MDS.mds_nonce,BID:t};jQuery(o).load(MDS.ajaxurl,a,(function(){mds_init("#theimage",!0,"NO"!==MDS.ENABLE_MOUSEOVER,!1,!0)}))}function mds_stats(e,t,i,n){if(jQuery("#"+e).length>0)return;let o=jQuery("<div class='stats-inner' id='"+e+"'></div>");o.css("width",i).css("height",n),jQuery("."+e).append(o);const a={action:"mds_ajax",type:"show_stats",mds_nonce:MDS.mds_nonce,BID:t};jQuery(o).load(MDS.ajaxurl,a,(function(){mds_init("#"+e,!1,!1,!1,!1)}))}function mds_list(e,t,i,n){if(jQuery("#"+e).length>0)return;let o=jQuery("<div class='list-inner' id='"+e+"'></div>");o.css("width",i).css("height",n),jQuery("."+e).append(o);const a={action:"mds_ajax",type:"show_list",mds_nonce:MDS.mds_nonce,BID:t};jQuery(o).load(MDS.ajaxurl,a,(function(){mds_init("#"+e,!1,!0,"list",!1)}))}function mds_users(e,t,i,n){if(jQuery("#"+e).length>0)return;let o=jQuery("<div class='users-inner' id='"+e+"'></div>");o.css("width",i).css("height",n),jQuery("."+e).append(o);const a={action:"mds_ajax",type:"show_users",mds_nonce:MDS.mds_nonce,BID:t};jQuery(o).load(MDS.ajaxurl,a,(function(){mds_init("#"+e,!1,!0,!1,!1)}))}function mds_load_ajax(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),0!==window.mds_shortcode_containers.length)for(let e=0;e<window.mds_shortcode_containers.length;e++){const t=jQuery(window.mds_shortcode_containers[e]).attr("data-mds-params");if(void 0!==t){const e=JSON.parse(t);e&&(void 0===window.mds_shortcodes&&(window.mds_shortcodes=[]),void 0===window.mds_shortcodes[e.container_id]&&(window.mds_shortcodes[e.container_id]=!0,new window.mds_ajax(e.type,e.container_id,e.align,e.width,e.height,e.id)))}}}function updateTippyPosition(){window.tippy_instance&&window.tippy_instance.popperInstance&&window.tippy_instance.popperInstance.update().then((()=>{}))}function add_tippy(){const e="<div class='ajax-loader'></div>",t=/iPhone|iPad|iPod/.test(navigator.platform);let i=50;"mouseenter"===MDS.TOOLTIP_TRIGGER&&(i=400);let n=".mds-container area,.list-link";jQuery("area").off("click.mds-tippy"),jQuery(document).off("click.mds-tippy","area").on("click.mds-tippy","area",(function(e){if(!this._tippy||!this._tippy._content){e.preventDefault(),e.stopPropagation();const t=jQuery(this);let i=t.data("data");if(!i||!i.banner_id||!i.block_id){const e=t.attr("href")||"",n=e.match(/bid=(\d+).*?aid=(\d+).*?block_id=(\d+)/i)||e.match(/aid=(\d+).*?bid=(\d+).*?block_id=(\d+)/i);n&&(i={banner_id:parseInt(n[1]||n[2],10),aid:parseInt(n[2]||n[1],10),block_id:parseInt(n[3],10)},t.data("data",i))}return this._tippy||"function"!=typeof tippy||(tippy(this,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay:"mouseenter"===MDS.TOOLTIP_TRIGGER?400:50,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999}),this._tippy.show()),!1}})),n&&(tippy(n,{theme:"light",content:e,duration:50,delay:i,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999,popperOptions:{strategy:"absolute",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{fallbackPlacements:["bottom","right"]}},{name:"preventOverflow",options:{altAxis:!0,tether:!1,boundary:document}}]},onCreate(e){e._isFetching=!1,e._content=null,e._error=null,e._initialized=!0},onShow(e){if(e._isFetching||e._content||e._error)return;t&&jQuery(e.reference).trigger("click"),e._isFetching=!0;const i=jQuery(e.reference),n=i.data("data");if(!n||!n.banner_id||!n.block_id){const t=i.closest("map").attr("id");return console.error("MDS Tooltip: Missing data attributes for tooltip on "+t),e.setContent("Error: Missing data for this block"),e._error="missing_data",void(e._isFetching=!1)}const o={action:"mds_ajax",type:"ga",mds_nonce:MDS.mds_nonce,aid:n.aid||0,bid:n.banner_id,block_id:n.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:o,dataType:"html",crossDomain:!0}).done((function(t){e.setContent(t),e._content=!0,window.MDS&&window.MDS.hooks&&window.MDS.hooks.afterTooltipContentLoaded&&window.MDS.hooks.afterTooltipContentLoaded({instance:e,data:n,responseData:t})})).fail((function(t,i,n){e._error=n,e.setContent(`Request failed. ${n}`)})).always((function(){e._isFetching=!1,mds_load_ajax()}))},onHidden(t){t.setContent(e),t._content=null,t._error=null}}),window.is_touch=!1,document.addEventListener("touchstart",(function(){window.is_touch=!0})),document.addEventListener("scroll",(function(){window.is_touch||tippy.hideAll()})),window.addEventListener("resize",(function(){updateTippyPosition()})))}function mdsTippyOnTrigger(e,t){"click"===t.type&&MDS.TOOLTIP_TRIGGER&&MDS.TOOLTIP_TRIGGER.includes("click")&&t.preventDefault()}let rescaling=!1;function rescale(e){rescaling||(rescaling=!0,e.imageScale({scale:"best-fit",align:"top",rescaleOnResize:!0,hideParentOverflow:!1,didScale:function(e,t){rescaling=!1,updateTippyPosition()}}))}function mds_loaded_event(e,t,i,n,o){!0!==window.mds_loaded&&(window.mds_loaded=!0,jQuery(document).trigger({type:"mds-loaded",el:e,scalemap:t,tippy:i,mdstype:n,isgrid:o}))}function mds_load_tippy(e,t,i,n,o){let a=!1;return e&&null==window.tippy_instance&&"NO"!==MDS.ENABLE_MOUSEOVER&&(console.log("[MDS DEBUG] Loading Tippy for element:",t),a=!0,defer("Popper",(()=>{defer("tippy",(()=>{console.log("[MDS DEBUG] Tippy deferred, adding now."),add_tippy()}))}))),a}function mds_handle_mouseenter(){window.click_data=jQuery(this).data("data")}function mds_handle_click(){if(window.click_data=jQuery(this).data("data"),"NO"===MDS.ENABLE_MOUSEOVER){const e={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:e,dataType:"html",crossDomain:!0}).done((function(){window.open(window.click_data.url,MDS.link_target)}))}}function mds_handle_url_click(){const e=jQuery(this),t={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:t,dataType:"html",crossDomain:!0}).done((function(){window.open(e.attr("href"),MDS.link_target)}))}function mds_init(e,t,i,n,o){console.log("[MDS DEBUG] mds_init called with:",{el:e,scalemap:t,tippy:i,type:n,isgrid:o});const a=jQuery(e);if(a.data("mds-initialized"))console.log("[MDS DEBUG] Element already initialized:",e);else if(a.data("mds-initialized",!0),e&&0!==a.length){a.is(":visible")||console.warn("[MDS WARN] Element is not visible, delaying initialization:",e);try{if(console.log("[MDS DEBUG] Initializing ImageMap for element:",e),"function"!=typeof ImageMap)return void console.error("[MDS ERROR] ImageMap function is not defined!");ImageMap(e,t),console.log("[MDS DEBUG] ImageMap initialized for element:",e),mds_loaded_event(a,t,i,n,o);mds_load_tippy(i,a,t,n,o)}catch(t){console.error("[MDS ERROR] Error during mds_init:",t,"for element:",e)}}else console.error("[MDS ERROR] mds_init called with invalid element:",e)}function mds_load_ajax(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),0!==window.mds_shortcode_containers.length)for(let e=0;e<window.mds_shortcode_containers.length;e++){const t=jQuery(window.mds_shortcode_containers[e]).attr("data-mds-params");if(void 0!==t){const e=JSON.parse(t);e&&(void 0===window.mds_shortcodes&&(window.mds_shortcodes=[]),void 0===window.mds_shortcodes[e.container_id]&&(window.mds_shortcodes[e.container_id]=!0,new window.mds_ajax(e.type,e.container_id,e.align,e.width,e.height,e.id)))}}}function get_selected_package(){return"undefined"!=typeof jQuery&&jQuery("#pack-grid").length>0?jQuery("#pack-grid").val():0}function mds_update_package(e){let t=get_selected_package(),i=e.find('input[name="package"]');0!==t&&i.length>0&&i.val(t)}function mdsToggleMenu(){document.getElementById("mds-users-menu").classList.toggle("mds-show-menu")}function confirmLink(e,t){if(""===t)return window.location.href=e.href,!1;const i=function(){let t=e.href;if((null==t||""===t||t.endsWith("#"))&&(t=jQuery(e).data("link")),null==t||""===t)return!0;t.includes("?")?t+="&is_js_confirmed=1":t+="?is_js_confirmed=1",window.location.href=t};if("undefined"!=typeof MDSModalUtility)MDSModalUtility.confirm(t,i);else{confirm(t+"\n")&&i()}return!1}jQuery(document).on("mds-loaded",(function(e){setTimeout((function(){window.dispatchEvent(new Event("resize"))}),150)})),window.mds_ajax=function(e,t,i,n,o,a){var d=jQuery("#"+t);switch(d.width(n).height(o).css("max-width","100%"),i){case"left":d.css("float","left");break;case"center":d.css("display","block").css("margin","0 auto");break;case"right":d.css("float","right")}if(d.length>0){add_ajax_loader(d);const i=new URL(window.location),n=new URLSearchParams(i.search);"1"===n.get("json")&&(n.delete("json"),i.search=n.toString(),window.history.replaceState({},"",i.toString())),window.mds_ajax_request=jQuery.ajax({url:MDS.ajaxurl,data:{BID:a,action:"mds_ajax",type:e,mds_nonce:MDS.mds_nonce,get_params:JSON.stringify(Object.fromEntries(new URLSearchParams(window.location.search)))},type:"POST",dataType:"html",success:function(i){if(remove_ajax_loader(),"payment"!==e&&jQuery(d).html(i),"grid"===e){mds_init("#theimage",!0,"NO"!==MDS.ENABLE_MOUSEOVER,!1,!0),jQuery("#theimage").trigger("load")}else if("list"===e){mds_init("#"+t,!1,!0,"list",!1),jQuery("#"+t).trigger("load")}else if("payment"===e||"confirm-order"===e)try{let e=JSON.parse(i);!0===e.success?e.data&&(e.data.redirect?(jQuery(d).html(e.data.message),window.location=e.data.redirect):jQuery(d).html(e.data)):!1===e.success?e.data&&(e.data.message?jQuery(d).html(e.data.message):jQuery(d).html(e.data)):console.log("Unknown data: ",e)}catch(e){jQuery(d).html(i)}else try{let e=JSON.parse(i);!0===e.success?e.data&&(e.data.redirect?(jQuery(d).html(e.data.message),window.location=e.data.redirect):jQuery(d).html(e.data)):!1===e.success?e.data&&(e.data.message?jQuery(d).html(e.data.message):jQuery(d).html(e.data)):console.log("Unknown data: ",e)}catch(e){jQuery(d).html(i)}wp.hooks.doAction("mds_ajax_complete")},error:function(e,t,i){remove_ajax_loader()}})}},jQuery(window).on("load",(function(){jQuery("#publish-grid").length>0&&mds_init("#publish-grid",!0,!1,!1,!0),mds_load_ajax()})),jQuery(document).on("load",(function(){jQuery("#publish-grid").length>0&&(console.log("[MDS DEBUG] document.ready init publish-grid"),mds_init("#publish-grid",!0,!1,!1,!0))})),jQuery(document).on("load",(function(){if(jQuery("body.login").length>0){let e=jQuery("#user_login");e.length>0&&e.attr("placeholder","Username or Email Address")}})),jQuery(document).on("ajaxComplete",(function(e,t,i){mds_load_ajax(),jQuery(".mds_upload_image").on("click",(function(e){e.preventDefault(),e.stopPropagation();let t=jQuery(this);t.prop("disabled",!0),t.attr("value",MDS.UPLOADING);let i=t.parent("form");return mds_update_package(i),i.submit(),!1})),jQuery(".mds_pointer_graphic").on("load",(function(e){jQuery(".mds_upload_image").prop("disabled",!1),jQuery(this).attr("value","Upload")})),jQuery(".mds_save_ad_button").on("click",(function(){let e=jQuery(this);e.prop("disabled",!0),e.attr("value",MDS.SAVING),e.closest("form").submit()})),jQuery("#mds-complete-button").on("click",(function(e){e.preventDefault(),e.stopPropagation();let t=jQuery(this);return t.prop("disabled",!0),t.attr("value",MDS.COMPLETING),window.location=MDS.manageurl+"?mds-action=complete&order_id="+t.data("order-id")+"&BID="+t.data("grid"),!1})),jQuery("#mds-confirm-button").on("click",(function(e){e.preventDefault(),e.stopPropagation();let t=jQuery(this);return t.prop("disabled",!0),t.attr("value",MDS.CONFIRMING),window.location=MDS.paymenturl+"?mds-action=confirm&order_id="+t.data("order-id")+"&BID="+t.data("grid"),!1})),jQuery(".mds-write.big_button").on("click",(function(e){e.preventDefault(),e.stopPropagation();let t=jQuery(this).closest("form");return mds_update_package(t),t.submit(),jQuery(this).prop("disabled",!0).attr("value",MDS.WAIT),!1})),jQuery(".mds-button").on("click",(function(){jQuery(".mds-button").prop("disabled",!0).attr("value",MDS.WAIT)})),jQuery(".mds-edit-button").on("click",(function(e){e.preventDefault(),e.stopPropagation(),jQuery(".mds-edit-button").prop("disabled",!0).attr("value",MDS.WAIT);const t=jQuery(this),i=-1!==MDS.manageurl.indexOf("?")?"&":"?";return window.location=MDS.manageurl+i+"mds-action=manage&aid="+t.data("pixel-id")+"&json=1",!1})),jQuery(".mds-upload-submit").on("click",(function(){return jQuery(this).attr("value",MDS.UPLOADING).prop("disabled",!0),jQuery(this).closest("form").append(jQuery("<input>").attr({type:"hidden",name:this.name,value:this.value})),jQuery(this).closest("form").submit(),!0})),jQuery(".mds-pixels-list").accordion({header:".mds-manage-row",collapsible:!0,active:0})}));