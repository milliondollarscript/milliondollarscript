function add_ajax_loader(container){let $ajax_loader=jQuery("<div class='ajax-loader'></div>");jQuery(container).append($ajax_loader);$ajax_loader.css("top",jQuery(container).position().top).css("left",jQuery(container).width()/2-$ajax_loader.width()/2)}function remove_ajax_loader(){jQuery(".ajax-loader").remove()}var initialized=false;function defer(toWaitFor,method){if(window[toWaitFor]){method()}else{setTimeout(function(){defer(toWaitFor,method)},50)}}function mds_grid(container,bid,width,height){if(jQuery("#"+container).length>0){return}add_ajax_loader("."+container);let grid=jQuery("<div class='grid-inner' id='"+container+"'></div>");grid.css("width",width).css("height",height);jQuery("."+container).append(grid);const data={action:"mds_ajax_grid",type:"show_grid",mds_nonce:MDS.mds_nonce,BID:bid};jQuery(grid).load(MDS.ajaxurl,data,function(){mds_init("#theimage",true,MDS.ENABLE_MOUSEOVER!=="NO",false,true)})}function mds_stats(container,bid,width,height){if(jQuery("#"+container).length>0){return}let stats=jQuery("<div class='stats-inner' id='"+container+"'></div>");stats.css("width",width).css("height",height);jQuery("."+container).append(stats);const data={action:"mds_ajax",type:"show_stats",mds_nonce:MDS.mds_nonce,BID:bid};jQuery(stats).load(MDS.ajaxurl,data,function(){mds_init("#"+container,false,false,false,false)})}function mds_list(container,bid,width,height){if(jQuery("#"+container).length>0){return}let list=jQuery("<div class='list-inner' id='"+container+"'></div>");list.css("width",width).css("height",height);jQuery("."+container).append(list);const data={action:"mds_ajax",type:"show_list",mds_nonce:MDS.mds_nonce,BID:bid};jQuery(list).load(MDS.ajaxurl,data,function(){mds_init("#"+container,false,true,false,false)})}function mds_users(container,bid,width,height){if(jQuery("#"+container).length>0){return}let users=jQuery("<div class='users-inner' id='"+container+"'></div>");users.css("width",width).css("height",height);jQuery("."+container).append(users);const data={action:"mds_ajax",type:"show_users",mds_nonce:MDS.mds_nonce,BID:bid};jQuery(users).load(MDS.ajaxurl,data,function(){mds_init("#"+container,false,true,false,false)})}function add_tippy(){const defaultContent="<div class='ajax-loader'></div>";const isIOS=/iPhone|iPad|iPod/.test(navigator.platform);let delay=50;if(MDS.TOOLTIP_TRIGGER==="mouseenter"){delay=400}window.tippy_instance=tippy(".mds-container area,.list-link",{theme:"light",content:defaultContent,duration:50,delay:delay,trigger:MDS.TOOLTIP_TRIGGER,allowHTML:true,followCursor:"initial",hideOnClick:true,interactive:true,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:true,appendTo:"parent",popperOptions:{strategy:"fixed",modifiers:[{name:"flip",options:{fallbackPlacements:["bottom","right"]}},{name:"preventOverflow",options:{altAxis:true,tether:false,padding:40}}]},onCreate(instance){instance._isFetching=false;instance._content=null;instance._error=null;window.tippy_instance=instance},onShow(instance){if(instance._isFetching||instance._content||instance._error){return}if(isIOS){jQuery(instance.reference).trigger("click")}instance._isFetching=true;const data=jQuery(instance.reference).data("data");const ajax_data={action:"mds_ajax",type:"ga",mds_nonce:MDS.mds_nonce,aid:data.aid,bid:data.banner_id,block_id:data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:ajax_data,dataType:"html",crossDomain:true}).done(function(data){instance.setContent(data);instance._content=true}).fail(function(jqXHR,textStatus,errorThrown){instance._error=errorThrown;instance.setContent(`Request failed. ${errorThrown}`)}).always(function(){instance._isFetching=false})},onHidden(instance){instance.setContent(defaultContent);instance._content=null;instance._error=null}});window.is_touch=false;jQuery(document).on("touchstart",function(){window.is_touch=true});jQuery(document).on("scroll",function(){if(!window.is_touch&&window.tippy_instance!=null&&typeof window.tippy_instance.hide==="function"){window.tippy_instance.hide()}})}let rescaling=false;function rescale($el){if(rescaling){return}rescaling=true;$el.imageScale({scale:"best-fit",align:"top",rescaleOnResize:true,didScale:function(firstTime,options){rescaling=false}})}function mds_loaded_event(el,scalemap,tippy,mdstype,isgrid){if(window.mds_loaded===true){return}window.mds_loaded=true;jQuery(document).trigger({type:"mds-loaded",el:el,scalemap:scalemap,tippy:tippy,mdstype:mdstype,isgrid:isgrid})}jQuery(document).on("mds-loaded",function(el,scalemap,tippy,mdstype,isgrid){setTimeout(function(){window.dispatchEvent(new Event("resize"))},100)});function mds_load_tippy(tippy,$el,scalemap,type,isgrid){let tooltips=false;if(tippy&&window.tippy_instance==undefined&&MDS.ENABLE_MOUSEOVER!=="NO"){tooltips=true;defer("Popper",()=>{defer("tippy",()=>{add_tippy();mds_loaded_event($el,scalemap,tippy,type,isgrid)})})}return tooltips}function mds_handle_mouseenter(){window.click_data=jQuery(this).data("data")}function mds_handle_click(){window.click_data=jQuery(this).data("data");if(MDS.ENABLE_MOUSEOVER==="NO"){const ajax_data={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:ajax_data,dataType:"html",crossDomain:true}).done(function(){window.open(window.click_data.url,MDS.link_target)})}}function mds_handle_url_click(){const $link=jQuery(this);const ajax_data={action:"mds_ajax",type:"click",mds_nonce:MDS.mds_nonce,aid:window.click_data.aid,bid:window.click_data.banner_id,block_id:window.click_data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:ajax_data,dataType:"html",crossDomain:true}).done(function(){window.open($link.attr("href"),MDS.link_target)})}function mds_init(el,scalemap,tippy,type,isgrid){let $el=jQuery(el);window.mds_loaded=false;if(isgrid&&scalemap){let origWidth;let origHeight;if($el.length>0){origWidth=$el.width();origHeight=$el.height();$el.data("scalemap",scalemap).data("origWidth",origWidth).data("origHeight",origHeight)}let $elParent=$el;$el.imageScale({scale:"best-fit",align:"top",rescaleOnResize:true,didScale:function(firstTime,options){if(MDS.wp!==""){if($elParent.parent().parent().parent().parent().height()<origHeight){$elParent.parent().parent().parent().parent().width(origWidth);$elParent.parent().parent().parent().parent().height(origHeight)}}if($elParent.parent().height()<origHeight){$elParent.width(origWidth);$elParent.height(origHeight);$elParent.parent().width(origWidth);$elParent.parent().height(origHeight);rescale($el)}if(MDS.wp!==""){$elParent.parent().parent().parent().parent().width($el.width());$elParent.parent().parent().parent().parent().height($el.height())}$elParent.parent().width($el.width());$elParent.parent().height($el.height());rescaling=false}});rescale($el);ImageMap("img[usemap]");jQuery(window).on("resize",function(){rescale($el)})}$el.on("load",function(){if(isgrid){if(MDS.wp!==""){$el.parent().parent().parent().parent().css("border-bottom","1px solid #D4D6D4").css("border-right","1px solid #D4D6D4")}else{$el.parent().css("border-bottom","1px solid #D4D6D4").css("border-right","1px solid #D4D6D4")}if(scalemap){rescale($el)}let tooltips=mds_load_tippy(tippy,$el,scalemap,type,isgrid);if(MDS.TOOLTIP_TRIGGER==="mouseenter"){jQuery("area").off("mouseenter").on("mouseenter",function(e){e.preventDefault();e.stopPropagation();mds_handle_mouseenter.call(this)})}jQuery("area").off("click").on("click",function(e){e.preventDefault();e.stopPropagation();mds_handle_click.call(this)});jQuery(document).off("click",".mds-popup-url").on("click",".mds-popup-url",function(e){e.preventDefault();e.stopPropagation();mds_handle_url_click.call(this)});jQuery(document).off("click","#theimage").on("click","#theimage",function(e){e.preventDefault();e.stopPropagation();if(MDS.REDIRECT_SWITCH==="YES"){window.open(MDS.REDIRECT_URL,MDS.link_target);return false}});if(!tooltips){mds_loaded_event($el,scalemap,tippy,type,isgrid)}}else{mds_loaded_event($el,scalemap,tippy,type,isgrid)}remove_ajax_loader()});if(type==="list"){let tooltips=mds_load_tippy(tippy,$el,scalemap,type,isgrid);jQuery(".list-link").off("click").on("click",function(e){e.preventDefault();e.stopPropagation();mds_handle_click.call(this)});jQuery(document).off("click",".mds-popup-url").on("click",".mds-popup-url",function(e){e.preventDefault();e.stopPropagation();mds_handle_url_click.call(this)});if(!tooltips){mds_loaded_event($el,scalemap,tippy,type,isgrid)}}initialized=true}jQuery(document).ready(function(){window.mds_ajax=function(mds_type,mds_container_id,mds_align,mds_width,mds_height,grid_id){var container=jQuery("#"+mds_container_id);container.width(mds_width).height(mds_height).css("max-width","100%");switch(mds_align){case"left":container.css("float","left");break;case"center":container.css("display","block").css("margin","0 auto");break;case"right":container.css("float","right");break;default:break}if(container.length>0){add_ajax_loader(container);const url=new URL(window.location);const params=new URLSearchParams(url.search);const jsonParam=params.get("json");if(jsonParam==="1"){params.delete("json");url.search=params.toString();window.history.replaceState({},"",url.toString())}window.mds_ajax_request=jQuery.ajax({url:MDS.ajaxurl,data:{BID:grid_id,action:"mds_ajax",type:mds_type,mds_nonce:MDS.mds_nonce,get_params:JSON.stringify(Object.fromEntries(new URLSearchParams(window.location.search)))},type:"POST",dataType:"html",success:function(data){remove_ajax_loader();if(mds_type!=="payment"){jQuery(container).html(data)}if(mds_type==="grid"){mds_init("#theimage",true,MDS.ENABLE_MOUSEOVER!=="NO",false,true)}else if(mds_type==="list"){mds_init("#"+mds_container_id,false,true,"list",false)}else if(mds_type==="payment"||mds_type==="confirm-order"){try{let parsed=jQuery.parseJSON(data);if(parsed.success===true){if(parsed.data){if(parsed.data.redirect){jQuery(container).html(parsed.data.message);window.location=parsed.data.redirect}else{jQuery(container).html(parsed.data)}}}else if(parsed.success===false){if(parsed.data){if(parsed.data.message){jQuery(container).html(parsed.data.message)}else{jQuery(container).html(parsed.data)}}}else{console.log("Unknown data: ",parsed)}}catch(e){jQuery(container).html(data)}}else{try{let parsed=jQuery.parseJSON(data);if(parsed.success===true){if(parsed.data){if(parsed.data.redirect){jQuery(container).html(parsed.data.message);window.location=parsed.data.redirect}else{jQuery(container).html(parsed.data)}}}else if(parsed.success===false){if(parsed.data){if(parsed.data.message){jQuery(container).html(parsed.data.message)}else{jQuery(container).html(parsed.data)}}}else{console.log("Unknown data: ",parsed)}}catch(e){jQuery(container).html(data)}}},error:function(jqXHR,textStatus,errorThrown){remove_ajax_loader()}})}};let $login_page=jQuery("body.login");if($login_page.length>0){jQuery(document).on("click","a",function(event){let target=jQuery(this).attr("target");if("_blank"===target){return true}event.preventDefault();event.stopPropagation();let url=jQuery(this).attr("href");if(url!=="#"||url.indexOf("wp_login.php")===-1){parent.location=url;return false}window.location=url;return false})}});jQuery(document).on("ajaxComplete",function(event,xhr,settings){jQuery(".mds_upload_image").on("click",function(e){e.preventDefault();e.stopPropagation();let $el=jQuery(this);$el.prop("disabled",true);$el.attr("value",MDS.UPLOADING);$el.parent("form").submit();return false});jQuery(".mds_pointer_graphic").on("load",function(e){jQuery(".mds_upload_image").prop("disabled",false);jQuery(this).attr("value","Upload")});jQuery(".mds_save_ad_button").on("click",function(){let $el=jQuery(this);$el.prop("disabled",true);$el.attr("value",MDS.SAVING);$el.closest("form").submit()});jQuery("#mds-complete-button").on("click",function(e){e.preventDefault();e.stopPropagation();let $el=jQuery(this);$el.prop("disabled",true);$el.attr("value",MDS.COMPLETING);window.location=MDS.publishurl+"?mds-action=complete&order_id="+$el.data("order-id")+"&BID="+$el.data("grid");return false});jQuery("#mds-confirm-button").on("click",function(e){e.preventDefault();e.stopPropagation();let $el=jQuery(this);$el.prop("disabled",true);$el.attr("value",MDS.CONFIRMING);window.location=MDS.paymenturl+"?mds-action=confirm&order_id="+$el.data("order-id")+"&BID="+$el.data("grid");return false});jQuery(".mds-write.big_button").on("click",function(e){e.preventDefault();e.stopPropagation();jQuery(this).closest("form").submit();jQuery(this).prop("disabled",true).attr("value",MDS.WAIT);return false});jQuery(".mds-button").on("click",function(){jQuery(".mds-button").prop("disabled",true).attr("value",MDS.WAIT)});jQuery(".mds-upload-submit").on("click",function(){jQuery(this).attr("value",MDS.UPLOADING);jQuery(this).closest("form").append(jQuery("<input>").attr({type:"hidden",name:this.name,value:this.value}));jQuery(this).closest("form").submit()})});function mdsToggleMenu(){const menu=document.getElementById("mds-users-menu");menu.classList.toggle("mds-show-menu")}