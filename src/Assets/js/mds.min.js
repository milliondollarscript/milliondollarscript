function add_ajax_loader(container){let $ajax_loader=jQuery("<div class='ajax-loader'></div>");jQuery(container).append($ajax_loader),$ajax_loader.css("top",jQuery(container).position().top).css("left",jQuery(container).width()/2-$ajax_loader.width()/2)}function remove_ajax_loader(){jQuery(".ajax-loader").remove()}function defer(toWaitFor,method){if(window[toWaitFor])method();else setTimeout(function(){defer(toWaitFor,method)},50)}function updateTippyPosition(){if(window.tippy_instance&&window.tippy_instance.popperInstance)window.tippy_instance.popperInstance.update().then(()=>{})}function add_tippy(){let isIOS=/iPhone|iPad|iPod/.test(navigator.platform),delay=50;if(MDS.TOOLTIP_TRIGGER==="mouseenter")delay=400;let tooltipSelector=".mds-container area,.list-link";if(jQuery("area").off("click.mds-tippy"),jQuery(document).off("click.mds-tippy","area").on("click.mds-tippy","area",function(e){if(!this._tippy||!this._tippy._content){e.preventDefault(),e.stopPropagation();let $this=jQuery(this),tippyData=$this.data("data");if(!tippyData||!tippyData.banner_id||!tippyData.block_id){let href=$this.attr("href")||"",matches=href.match(/bid=(\d+).*?aid=(\d+).*?block_id=(\d+)/i)||href.match(/aid=(\d+).*?bid=(\d+).*?block_id=(\d+)/i);if(matches)tippyData={banner_id:parseInt(matches[1]||matches[2],10),aid:parseInt(matches[2]||matches[1],10),block_id:parseInt(matches[3],10)},$this.data("data",tippyData)}if(!this._tippy&&typeof tippy==="function")tippy(this,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay:MDS.TOOLTIP_TRIGGER==="mouseenter"?400:50,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999}),this._tippy.show();return!1}}),tooltipSelector)tippy(tooltipSelector,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:mdsTippyOnTrigger,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999,popperOptions:{strategy:"absolute",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{fallbackPlacements:["bottom","right"]}},{name:"preventOverflow",options:{altAxis:!0,tether:!1,boundary:document}}]},onCreate(instance){instance._isFetching=!1,instance._content=null,instance._error=null,instance._initialized=!0},onShow(instance){if(instance._isFetching||instance._content||instance._error)return;if(isIOS)jQuery(instance.reference).trigger("click");instance._isFetching=!0;let $reference=jQuery(instance.reference),data=$reference.data("data");if(!data||!data.banner_id||!data.block_id){let mapName=$reference.closest("map").attr("id");console.error("MDS Tooltip: Missing data attributes for tooltip on "+mapName),instance.setContent("Error: Missing data for this block"),instance._error="missing_data",instance._isFetching=!1;return}let ajax_data={action:"mds_ajax",type:"ga",mds_nonce:MDS.mds_nonce,aid:data.aid||0,bid:data.banner_id,block_id:data.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:ajax_data,dataType:"html",crossDomain:!0}).done(function(responseData){instance.setContent(responseData),instance._content=!0}).fail(function(jqXHR,textStatus,errorThrown){instance._error=errorThrown,instance.setContent(`Request failed. ${errorThrown}`)}).always(function(){instance._isFetching=!1,mds_load_ajax()})},onHidden(instance){instance.setContent("<div class='ajax-loader'></div>"),instance._content=null,instance._error=null}}),window.is_touch=!1,document.addEventListener("touchstart",function(){window.is_touch=!0}),document.addEventListener("scroll",function(){if(!window.is_touch)tippy.hideAll()}),window.addEventListener("resize",function(){updateTippyPosition()})}function mdsTippyOnTrigger(instance,event){if(event.type==="click"&&MDS.TOOLTIP_TRIGGER&&MDS.TOOLTIP_TRIGGER.includes("click"))event.preventDefault()}function mds_loaded_event(el,scalemap,tippy2,type,isgrid){if(window.mds_loaded===!0)return;window.mds_loaded=!0,jQuery(document).trigger({type:"mds-loaded",el,scalemap,tippy:tippy2,mdstype:type,isgrid})}jQuery(document).on("mds-loaded",function(event){setTimeout(function(){window.dispatchEvent(new Event("resize"))},150)});function mds_load_tippy(tippy2,$el,scalemap,type,isgrid){let tooltips_deferred=!1;if(tippy2&&window.tippy_instance==null&&MDS.ENABLE_MOUSEOVER!=="NO")console.log("[MDS DEBUG] Loading Tippy for element:",$el),tooltips_deferred=!0,defer("Popper",()=>{defer("tippy",()=>{console.log("[MDS DEBUG] Tippy deferred, adding now."),add_tippy()})});return tooltips_deferred}function mds_init(el,scalemap,tippy2,type,isgrid){console.log("[MDS DEBUG] mds_init called with:",{el,scalemap,tippy:tippy2,type,isgrid});let $el=jQuery(el);if($el.data("mds-initialized")){console.log("[MDS DEBUG] Element already initialized:",el);return}if($el.data("mds-initialized",!0),!el||$el.length===0){console.error("[MDS ERROR] mds_init called with invalid element:",el);return}if(!$el.is(":visible"))console.warn("[MDS WARN] Element is not visible, delaying initialization:",el);try{if(console.log("[MDS DEBUG] Initializing ImageMap for element:",el),typeof ImageMap!=="function"){console.error("[MDS ERROR] ImageMap function is not defined!");return}ImageMap(el,scalemap),console.log("[MDS DEBUG] ImageMap initialized for element:",el),mds_loaded_event($el,scalemap,tippy2,type,isgrid);let tooltips_deferred=mds_load_tippy(tippy2,$el,scalemap,type,isgrid)}catch(error){console.error("[MDS ERROR] Error during mds_init:",error,"for element:",el)}}window.mds_ajax=function(mds_type,mds_container_id,mds_align,mds_width,mds_height,grid_id){var container=jQuery("#"+mds_container_id);switch(container.width(mds_width).height(mds_height).css("max-width","100%"),mds_align){case"left":container.css("float","left");break;case"center":container.css("display","block").css("margin","0 auto");break;case"right":container.css("float","right");break;default:break}if(container.length>0){add_ajax_loader(container);let url=new URL(window.location),params=new URLSearchParams(url.search);if(params.get("json")==="1")params.delete("json"),url.search=params.toString(),window.history.replaceState({},"",url.toString());window.mds_ajax_request=jQuery.ajax({url:MDS.ajaxurl,data:{BID:grid_id,action:"mds_ajax",type:mds_type,mds_nonce:MDS.mds_nonce,get_params:JSON.stringify(Object.fromEntries(new URLSearchParams(window.location.search)))},type:"POST",dataType:"html",success:function(data){if(remove_ajax_loader(),mds_type!=="payment")jQuery(container).html(data);if(mds_type==="grid")mds_init("#theimage",!0,MDS.ENABLE_MOUSEOVER!=="NO",!1,!0),jQuery("#theimage").trigger("load");else if(mds_type==="list")mds_init("#"+mds_container_id,!1,!0,"list",!1),jQuery("#"+mds_container_id).trigger("load");else if(mds_type==="payment"||mds_type==="confirm-order")try{let parsed=JSON.parse(data);if(parsed.success===!0){if(parsed.data)if(parsed.data.redirect)jQuery(container).html(parsed.data.message),window.location=parsed.data.redirect;else jQuery(container).html(parsed.data)}else if(parsed.success===!1){if(parsed.data)if(parsed.data.message)jQuery(container).html(parsed.data.message);else jQuery(container).html(parsed.data)}else console.log("Unknown data: ",parsed)}catch(e){jQuery(container).html(data)}else try{let parsed=JSON.parse(data);if(parsed.success===!0){if(parsed.data)if(parsed.data.redirect)jQuery(container).html(parsed.data.message),window.location=parsed.data.redirect;else jQuery(container).html(parsed.data)}else if(parsed.success===!1){if(parsed.data)if(parsed.data.message)jQuery(container).html(parsed.data.message);else jQuery(container).html(parsed.data)}else console.log("Unknown data: ",parsed)}catch(e){jQuery(container).html(data)}wp.hooks.doAction("mds_ajax_complete")},error:function(jqXHR,textStatus,errorThrown){remove_ajax_loader()}})}};jQuery(window).on("load",function(){if(jQuery("#publish-grid").length>0)mds_init("#publish-grid",!0,!1,!1,!0);mds_load_ajax()});jQuery(document).on("load",function(){if(jQuery("#publish-grid").length>0)console.log("[MDS DEBUG] document.ready init publish-grid"),mds_init("#publish-grid",!0,!1,!1,!0)});jQuery(document).on("load",function(){if(jQuery("body.login").length>0){let $user_login=jQuery("#user_login");if($user_login.length>0)$user_login.attr("placeholder","Username or Email Address")}});function mds_load_ajax(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),window.mds_shortcode_containers.length===0)return;for(let i=0;i<window.mds_shortcode_containers.length;i++){let mds_data_attr=jQuery(window.mds_shortcode_containers[i]).attr("data-mds-params");if(mds_data_attr!==void 0){let mds_data=JSON.parse(mds_data_attr);if(mds_data){if(window.mds_shortcodes===void 0)window.mds_shortcodes=[];if(window.mds_shortcodes[mds_data.container_id]===void 0)window.mds_shortcodes[mds_data.container_id]=!0,new window.mds_ajax(mds_data.type,mds_data.container_id,mds_data.align,mds_data.width,mds_data.height,mds_data.id)}}}}function get_selected_package(){if(typeof jQuery!=="undefined"&&jQuery("#pack-grid").length>0)return jQuery("#pack-grid").val();return 0}function mds_update_package($form){let $pack=get_selected_package(),$package_input=$form.find('input[name="package"]');if($pack!==0&&$package_input.length>0)$package_input.val($pack)}jQuery(document).on("ajaxComplete",function(event,xhr,settings){mds_load_ajax(),jQuery(".mds_upload_image").on("click",function(e){e.preventDefault(),e.stopPropagation();let $el=jQuery(this);$el.prop("disabled",!0),$el.attr("value",MDS.UPLOADING);let $form=$el.parent("form");return mds_update_package($form),$form.submit(),!1}),jQuery(".mds_pointer_graphic").on("load",function(e){jQuery(".mds_upload_image").prop("disabled",!1),jQuery(this).attr("value","Upload")}),jQuery(".mds_save_ad_button").on("click",function(){let $el=jQuery(this);$el.prop("disabled",!0),$el.attr("value",MDS.SAVING),$el.closest("form").submit()}),jQuery("#mds-complete-button").on("click",function(e){e.preventDefault(),e.stopPropagation();let $el=jQuery(this);return $el.prop("disabled",!0),$el.attr("value",MDS.COMPLETING),window.location=MDS.manageurl+"?mds-action=complete&order_id="+$el.data("order-id")+"&BID="+$el.data("grid"),!1}),jQuery("#mds-confirm-button").on("click",function(e){e.preventDefault(),e.stopPropagation();let $el=jQuery(this);return $el.prop("disabled",!0),$el.attr("value",MDS.CONFIRMING),window.location=MDS.paymenturl+"?mds-action=confirm&order_id="+$el.data("order-id")+"&BID="+$el.data("grid"),!1}),jQuery(".mds-write.big_button").on("click",function(e){e.preventDefault(),e.stopPropagation();let $form=jQuery(this).closest("form");return mds_update_package($form),$form.submit(),jQuery(this).prop("disabled",!0).attr("value",MDS.WAIT),!1}),jQuery(".mds-button").on("click",function(){jQuery(".mds-button").prop("disabled",!0).attr("value",MDS.WAIT)}),jQuery(".mds-edit-button").on("click",function(e){e.preventDefault(),e.stopPropagation(),jQuery(".mds-edit-button").prop("disabled",!0).attr("value",MDS.WAIT);let $el=jQuery(this),sep=MDS.manageurl.indexOf("?")!==-1?"&":"?";return window.location=MDS.manageurl+sep+"mds-action=manage&aid="+$el.data("pixel-id")+"&json=1",!1}),jQuery(".mds-upload-submit").on("click",function(){return jQuery(this).attr("value",MDS.UPLOADING).prop("disabled",!0),jQuery(this).closest("form").append(jQuery("<input>").attr({type:"hidden",name:this.name,value:this.value})),jQuery(this).closest("form").submit(),!0}),jQuery(".mds-pixels-list").accordion({header:".mds-manage-row",collapsible:!0,active:0})});
