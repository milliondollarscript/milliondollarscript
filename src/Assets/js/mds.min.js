function L(z){let E=jQuery("<div class='ajax-loader'></div>");jQuery(z).append(E),E.css("top",jQuery(z).position().top).css("left",jQuery(z).width()/2-E.width()/2)}function Y(){jQuery(".ajax-loader").remove()}function V(z,E){if(window[z])E();else setTimeout(function(){V(z,E)},50)}function P(){if(window.tippy_instance&&window.tippy_instance.popperInstance)window.tippy_instance.popperInstance.update().then(()=>{})}function O(){let E=/iPhone|iPad|iPod/.test(navigator.platform),J=50;if(MDS.TOOLTIP_TRIGGER==="mouseenter")J=400;let A=".mds-container area,.list-link";if(jQuery("area").off("click.mds-tippy"),jQuery(document).off("click.mds-tippy","area").on("click.mds-tippy","area",function(q){if(!this._tippy||!this._tippy._content){q.preventDefault(),q.stopPropagation();let H=jQuery(this),B=H.data("data");if(!B||!B.banner_id||!B.block_id){let R=H.attr("href")||"",K=R.match(/bid=(\d+).*?aid=(\d+).*?block_id=(\d+)/i)||R.match(/aid=(\d+).*?bid=(\d+).*?block_id=(\d+)/i);if(K)B={banner_id:parseInt(K[1]||K[2],10),aid:parseInt(K[2]||K[1],10),block_id:parseInt(K[3],10)},H.data("data",B)}if(!this._tippy&&typeof tippy==="function")tippy(this,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay:MDS.TOOLTIP_TRIGGER==="mouseenter"?400:50,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:Z,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999}),this._tippy.show();return!1}}),A)tippy(A,{theme:"light",content:"<div class='ajax-loader'></div>",duration:50,delay:J,trigger:MDS.TOOLTIP_TRIGGER,onTrigger:Z,allowHTML:!0,followCursor:"initial",hideOnClick:!0,interactive:!0,maxWidth:parseInt(MDS.MAX_POPUP_SIZE,10),placement:"auto",touch:!0,appendTo:"parent",zIndex:99999,popperOptions:{strategy:"absolute",modifiers:[{name:"offset",options:{offset:[0,10]}},{name:"flip",options:{fallbackPlacements:["bottom","right"]}},{name:"preventOverflow",options:{altAxis:!0,tether:!1,boundary:document}}]},onCreate(q){q._isFetching=!1,q._content=null,q._error=null,q._initialized=!0},onShow(q){if(q._isFetching||q._content||q._error)return;if(E)jQuery(q.reference).trigger("click");q._isFetching=!0;let H=jQuery(q.reference),B=H.data("data");if(!B||!B.banner_id||!B.block_id){let K=H.closest("map").attr("id");console.error("MDS Tooltip: Missing data attributes for tooltip on "+K),q.setContent("Error: Missing data for this block"),q._error="missing_data",q._isFetching=!1;return}let R={action:"mds_ajax",type:"ga",mds_nonce:MDS.mds_nonce,aid:B.aid||0,bid:B.banner_id,block_id:B.block_id};jQuery.ajax({method:"POST",url:MDS.ajaxurl,data:R,dataType:"html",crossDomain:!0}).done(function(K){q.setContent(K),q._content=!0}).fail(function(K,N,Q){q._error=Q,q.setContent(`Request failed. ${Q}`)}).always(function(){q._isFetching=!1,X()})},onHidden(q){q.setContent("<div class='ajax-loader'></div>"),q._content=null,q._error=null}}),window.is_touch=!1,document.addEventListener("touchstart",function(){window.is_touch=!0}),document.addEventListener("scroll",function(){if(!window.is_touch)tippy.hideAll()}),window.addEventListener("resize",function(){P()})}function Z(z,E){if(E.type==="click"&&MDS.TOOLTIP_TRIGGER&&MDS.TOOLTIP_TRIGGER.includes("click"))E.preventDefault()}function S(z,E,J,A,q){if(window.mds_loaded===!0)return;window.mds_loaded=!0,jQuery(document).trigger({type:"mds-loaded",el:z,scalemap:E,tippy:J,mdstype:A,isgrid:q})}jQuery(document).on("mds-loaded",function(z){setTimeout(function(){window.dispatchEvent(new Event("resize"))},150)});function C(z,E,J,A,q){let H=!1;if(z&&window.tippy_instance==null&&MDS.ENABLE_MOUSEOVER!=="NO")console.log("[MDS DEBUG] Loading Tippy for element:",E),H=!0,V("Popper",()=>{V("tippy",()=>{console.log("[MDS DEBUG] Tippy deferred, adding now."),O()})});return H}function U(z,E,J,A,q){console.log("[MDS DEBUG] mds_init called with:",{el:z,scalemap:E,tippy:J,type:A,isgrid:q});let H=jQuery(z);if(H.data("mds-initialized")){console.log("[MDS DEBUG] Element already initialized:",z);return}if(H.data("mds-initialized",!0),!z||H.length===0){console.error("[MDS ERROR] mds_init called with invalid element:",z);return}if(!H.is(":visible"))console.warn("[MDS WARN] Element is not visible, delaying initialization:",z);try{if(console.log("[MDS DEBUG] Initializing ImageMap for element:",z),typeof ImageMap!=="function"){console.error("[MDS ERROR] ImageMap function is not defined!");return}ImageMap(z,E),console.log("[MDS DEBUG] ImageMap initialized for element:",z),S(H,E,J,A,q);let B=C(J,H,E,A,q)}catch(B){console.error("[MDS ERROR] Error during mds_init:",B,"for element:",z)}}window.mds_ajax=function(z,E,J,A,q,H){var B=jQuery("#"+E);switch(B.width(A).height(q).css("max-width","100%"),J){case"left":B.css("float","left");break;case"center":B.css("display","block").css("margin","0 auto");break;case"right":B.css("float","right");break;default:break}if(B.length>0){L(B);let R=new URL(window.location),K=new URLSearchParams(R.search);if(K.get("json")==="1")K.delete("json"),R.search=K.toString(),window.history.replaceState({},"",R.toString());window.mds_ajax_request=jQuery.ajax({url:MDS.ajaxurl,data:{BID:H,action:"mds_ajax",type:z,mds_nonce:MDS.mds_nonce,get_params:JSON.stringify(Object.fromEntries(new URLSearchParams(window.location.search)))},type:"POST",dataType:"html",success:function(Q){if(Y(),z!=="payment")jQuery(B).html(Q);if(z==="grid")U("#theimage",!0,MDS.ENABLE_MOUSEOVER!=="NO",!1,!0),jQuery("#theimage").trigger("load");else if(z==="list")U("#"+E,!1,!0,"list",!1),jQuery("#"+E).trigger("load");else if(z==="payment"||z==="confirm-order")try{let G=JSON.parse(Q);if(G.success===!0){if(G.data)if(G.data.redirect)jQuery(B).html(G.data.message),window.location=G.data.redirect;else jQuery(B).html(G.data)}else if(G.success===!1){if(G.data)if(G.data.message)jQuery(B).html(G.data.message);else jQuery(B).html(G.data)}else console.log("Unknown data: ",G)}catch(G){jQuery(B).html(Q)}else try{let G=JSON.parse(Q);if(G.success===!0){if(G.data)if(G.data.redirect)jQuery(B).html(G.data.message),window.location=G.data.redirect;else jQuery(B).html(G.data)}else if(G.success===!1){if(G.data)if(G.data.message)jQuery(B).html(G.data.message);else jQuery(B).html(G.data)}else console.log("Unknown data: ",G)}catch(G){jQuery(B).html(Q)}wp.hooks.doAction("mds_ajax_complete")},error:function(Q,G,M){Y()}})}};jQuery(window).on("load",function(){if(jQuery("#publish-grid").length>0)U("#publish-grid",!0,!1,!1,!0);X()});jQuery(document).on("load",function(){if(jQuery("#publish-grid").length>0)console.log("[MDS DEBUG] document.ready init publish-grid"),U("#publish-grid",!0,!1,!1,!0)});jQuery(document).on("load",function(){if(jQuery("body.login").length>0){let E=jQuery("#user_login");if(E.length>0)E.attr("placeholder","Username or Email Address")}});function X(){if(window.mds_shortcode_containers=jQuery("body").find(".mds-shortcode-container"),window.mds_shortcode_containers.length===0)return;for(let z=0;z<window.mds_shortcode_containers.length;z++){let J=jQuery(window.mds_shortcode_containers[z]).attr("data-mds-params");if(J!==void 0){let A=JSON.parse(J);if(A){if(window.mds_shortcodes===void 0)window.mds_shortcodes=[];if(window.mds_shortcodes[A.container_id]===void 0)window.mds_shortcodes[A.container_id]=!0,new window.mds_ajax(A.type,A.container_id,A.align,A.width,A.height,A.id)}}}}function F(){if(typeof jQuery!=="undefined"&&jQuery("#pack-grid").length>0)return jQuery("#pack-grid").val();return 0}function I(z){let E=F(),J=z.find('input[name="package"]');if(E!==0&&J.length>0)J.val(E)}jQuery(document).on("ajaxComplete",function(z,E,J){X(),jQuery(".mds_upload_image").on("click",function(A){A.preventDefault(),A.stopPropagation();let q=jQuery(this);q.prop("disabled",!0),q.attr("value",MDS.UPLOADING);let H=q.parent("form");return I(H),H.submit(),!1}),jQuery(".mds_pointer_graphic").on("load",function(A){jQuery(".mds_upload_image").prop("disabled",!1),jQuery(this).attr("value","Upload")}),jQuery(".mds_save_ad_button").on("click",function(){let A=jQuery(this);A.prop("disabled",!0),A.attr("value",MDS.SAVING),A.closest("form").submit()}),jQuery("#mds-complete-button").on("click",function(A){A.preventDefault(),A.stopPropagation();let q=jQuery(this);return q.prop("disabled",!0),q.attr("value",MDS.COMPLETING),window.location=MDS.manageurl+"?mds-action=complete&order_id="+q.data("order-id")+"&BID="+q.data("grid"),!1}),jQuery("#mds-confirm-button").on("click",function(A){A.preventDefault(),A.stopPropagation();let q=jQuery(this);return q.prop("disabled",!0),q.attr("value",MDS.CONFIRMING),window.location=MDS.paymenturl+"?mds-action=confirm&order_id="+q.data("order-id")+"&BID="+q.data("grid"),!1}),jQuery(".mds-write.big_button").on("click",function(A){A.preventDefault(),A.stopPropagation();let q=jQuery(this).closest("form");return I(q),q.submit(),jQuery(this).prop("disabled",!0).attr("value",MDS.WAIT),!1}),jQuery(".mds-button").on("click",function(){jQuery(".mds-button").prop("disabled",!0).attr("value",MDS.WAIT)}),jQuery(".mds-edit-button").on("click",function(A){A.preventDefault(),A.stopPropagation(),jQuery(".mds-edit-button").prop("disabled",!0).attr("value",MDS.WAIT);let q=jQuery(this),H=MDS.manageurl.indexOf("?")!==-1?"&":"?";return window.location=MDS.manageurl+H+"mds-action=manage&aid="+q.data("pixel-id")+"&json=1",!1}),jQuery(".mds-upload-submit").on("click",function(){return jQuery(this).attr("value",MDS.UPLOADING).prop("disabled",!0),jQuery(this).closest("form").append(jQuery("<input>").attr({type:"hidden",name:this.name,value:this.value})),jQuery(this).closest("form").submit(),!0}),jQuery(".mds-pixels-list").accordion({header:".mds-manage-row",collapsible:!0,active:0})});
