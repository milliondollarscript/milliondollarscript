/*
 * Million Dollar Script Two
 *
 * @author      Ryan Rhode
 * @copyright   (C) 2025, Ryan Rhode
 * @license     https://opensource.org/licenses/GPL-3.0 GNU General Public License, version 3
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 *
 *    Million Dollar Script
 *    Pixels to Profit: Ignite Your Revolution
 *    https://milliondollarscript.com/
 *
 */
let debug=!1;function mds_show_modal(e){const t=document.getElementById("mds-modal-overlay"),o=document.getElementById("mds-modal-message");if(!t||!o)return alert(String(e));o.textContent=String(e),t.style.display="flex",setTimeout((()=>{const e=document.getElementById("mds-modal-ok");e&&e.focus()}),0)}!function(){if(document.getElementById("mds-modal-style"))return;const e=document.createElement("style");e.id="mds-modal-style",e.textContent="\n    #mds-modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.45); z-index: 100000; display: none; align-items: center; justify-content: center; padding: 16px; }\n    #mds-modal { max-width: 520px; width: 100%; border-radius: 8px; box-shadow: 0 8px 28px rgba(0,0,0,0.35); background: var(--mds-bg-secondary, #333); color: var(--mds-text-primary, #fff); border: 1px solid var(--mds-border-color, rgba(255,255,255,0.1)); }\n    #mds-modal .mds-modal-body { padding: 18px 20px; font-size: 15px; line-height: 1.45; }\n    #mds-modal .mds-modal-actions { padding: 12px 16px 16px; display: flex; justify-content: flex-end; gap: 10px; }\n    #mds-modal .mds-btn { cursor: pointer; padding: 8px 14px; border-radius: 6px; border: none; font-size: 14px; }\n    #mds-modal .mds-btn-ok { background: var(--mds-btn-primary-bg, #0073aa); color: var(--mds-btn-primary-text, #ffffff); }\n    #mds-modal .mds-btn-ok:focus { outline: 2px solid var(--mds-border-color, rgba(255,255,255,0.4)); outline-offset: 2px; }\n    ",document.head.appendChild(e);const t=document.createElement("div");t.id="mds-modal-overlay",t.innerHTML='\n      <div id="mds-modal" role="dialog" aria-modal="true" aria-labelledby="mds-modal-title">\n        <div class="mds-modal-body" id="mds-modal-message"></div>\n        <div class="mds-modal-actions">\n          <button type="button" class="mds-btn mds-btn-ok" id="mds-modal-ok">OK</button>\n        </div>\n      </div>',document.body.appendChild(t),t.addEventListener("click",(e=>{e.target.id})),document.getElementById("mds-modal-ok").addEventListener("click",(()=>{t.style.display="none";const e=document.getElementById("mds-modal-ok");e&&e.blur()}))}();let $myblocks,total_cost,grid,gridOffsetLeft,gridOffsetTop,submit_button1,pointer,pixel_container,pixel_form,first_load=!0,ajax_queue=[],USE_AJAX=MDS_OBJECT.USE_AJAX,block_str=MDS_OBJECT.block_str,selectedBlocks=""!==block_str?block_str.split(",").map(Number):[],selecting=!1,ajaxing=!1,submitting=!1,grid_width=MDS_OBJECT.grid_width,grid_height=MDS_OBJECT.grid_height,BLK_WIDTH=MDS_OBJECT.BLK_WIDTH,BLK_HEIGHT=MDS_OBJECT.BLK_HEIGHT,G_MAX_BLOCKS=MDS_OBJECT.G_MAX_BLOCKS,G_MIN_BLOCKS=MDS_OBJECT.G_MIN_BLOCKS,GRD_WIDTH=BLK_WIDTH*grid_width,GRD_HEIGHT=BLK_HEIGHT*grid_height,orig={grid_width:grid_width,grid_height:grid_height,BLK_WIDTH:BLK_WIDTH,BLK_HEIGHT:BLK_HEIGHT,GRD_WIDTH:GRD_WIDTH,GRD_HEIGHT:GRD_HEIGHT},scaled_width=1,scaled_height=1;function add_ajax_loader(e){let t=jQuery("<div class='ajax-loader'></div>");jQuery(e).append(t),t.css("top",jQuery(e).position().top).css("left",jQuery(e).width()/2-t.width()/2)}function remove_ajax_loader(){jQuery(".ajax-loader").remove()}const messageout=function(e){mds_show_modal(String(e))};function has_touch(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}}function update_order(){selectedBlocks.length>0&&(pixel_form.selected_pixels.value=selectedBlocks.join(","))}function reserve_block(e){if(-1===selectedBlocks.indexOf(e)){selectedBlocks.push(parseInt(e,10));let t=selectedBlocks.indexOf(-1);t>-1&&selectedBlocks.splice(t,1),update_order()}}function unreserve_block(e){let t=selectedBlocks.indexOf(e);t>-1&&(selectedBlocks.splice(t,1),update_order())}function add_block(e,t,o){let i=get_block_position(e),n=i.x*BLK_WIDTH+gridOffsetLeft,r=i.y*BLK_HEIGHT+gridOffsetTop,a=document.createDocumentFragment(),d=jQuery("<span>",{id:"block"+e.toString(),css:{left:n+"px",top:r+"px",lineHeight:BLK_HEIGHT+"px",fontSize:BLK_HEIGHT+"px",width:BLK_WIDTH+"px",height:BLK_HEIGHT+"px"}}).addClass("mds-block"),s=jQuery("<img>",{alt:"",src:MDS_OBJECT.MDS_CORE_URL+"images/selected_block.png",css:{lineHeight:BLK_HEIGHT+"px",fontSize:BLK_HEIGHT+"px",width:BLK_WIDTH+"px",height:BLK_HEIGHT+"px"}});d.append(s),a.appendChild(d[0]),$myblocks.append(a),d.data("blockid",e),reserve_block(e)}function remove_block(e){let t=document.getElementById("block"+e.toString());null!==t&&t.remove(),unreserve_block(e)}function invert_block(e){null!==document.getElementById("block"+e.id.toString())?remove_block(e.id):add_block(e.id,e.x,e.y)}function is_block_selected(e){return Array.isArray(e)||(e=[{id:e}]),e.some((e=>selectedBlocks.includes(e.id)))}function get_clicked_blocks(e,t,o){let i,n,r=[];const a=parseInt(jQuery("#mds-selection-size-value").val(),10);if(a>1){for(let o=0;o<a;o++)for(let d=0;d<a;d++)if(i=e+o*BLK_WIDTH,n=t+d*BLK_HEIGHT,i>=0&&i<GRD_WIDTH&&n>=0&&n<GRD_HEIGHT){const e={id:get_clicked_block(i,n),x:i,y:n};r.push(e)}}else i=e,n=t,r.push({id:o,x:i,y:n});return r}function do_blocks(e,t){Array.isArray(e)||(e=[e]);for(const o of e){const e="object"==typeof o?o.id:o,i="object"==typeof o?o.x:null,n="object"==typeof o?o.y:null;"add"===t?add_block(e,i,n):"remove"===t?remove_block(e):"invert"===t&&invert_block({id:e,x:i,y:n})}has_touch()||$myblocks.on("mousemove",".mds-block",(function(e){let t=getOffset(e.originalEvent.pageX,e.originalEvent.pageY);if(null==t)return!1;show_pointer(t)}))}function select_pixels(e){return!(!pointer&&(pointer=document.getElementById("block_pointer"),!pointer))&&(change_block_state(e.x,e.y),!0)}function load_order(){0!==MDS_OBJECT.blocks.length&&(MDS_OBJECT.blocks.forEach((function(e){add_block(parseInt(e.block_id,10))})),null!==pixel_form&&pixel_form.addEventListener("submit",formSubmit))}function getObjCoords(e){var t=e.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop;return{x:t.left+o,y:t.top+i}}function getOffset(e,t,o){if(null==grid)return null;let i=getObjCoords(grid),n=get_pointer_size(),r={},a=0,d=0;return o&&(a=document.documentElement.scrollLeft,d=document.documentElement.scrollTop),r.x=e-i.x+a,r.y=t-i.y+d,r.x=Math.floor(r.x/scaled_width/orig.BLK_WIDTH)*orig.BLK_WIDTH,r.y=Math.floor(r.y/scaled_height/orig.BLK_HEIGHT)*orig.BLK_HEIGHT,r.x=Math.max(Math.min(r.x,GRD_WIDTH-n.width/scaled_width),0),r.y=Math.max(Math.min(r.y,GRD_HEIGHT-n.height/scaled_height),0),r.x=r.x*scaled_width,r.y=r.y*scaled_height,r}function get_pointer_size(){let e={};const t=jQuery("#mds-selection-size-slider"),o=jQuery("#mds-selection-size-value"),i=jQuery("#mds-total-blocks-value");if("hidden"===t.attr("type")){let n=parseInt(o.val(),10);const r=Math.max(GRD_WIDTH,GRD_HEIGHT);let a=G_MAX_BLOCKS-selectedBlocks.length,d=Math.floor(Math.sqrt(a));0===n&&(n=Math.floor(Math.sqrt(G_MAX_BLOCKS)));let s=Math.min(n,r,d);for(0===a&&(s=1);(s+1)*(s+1)<=a;)s++,a-=s*s;e.width=BLK_WIDTH*s,e.height=BLK_HEIGHT*s,t.val(s),o.val(s),i.val(s*s)}else{const t=parseInt(jQuery("#mds-selection-size-value").val(),10),o=Math.max(GRD_WIDTH,GRD_HEIGHT),i=Math.min(t,o);e.width=BLK_WIDTH*i,e.height=BLK_HEIGHT*i}return e}function update_pointer_size(){let e=get_pointer_size();e.width>0&&e.height>0&&(pointer.style.width=e.width+"px",pointer.style.height=e.height+"px")}function show_pointer(e){return!(!pointer&&(pointer=document.getElementById("block_pointer"),!pointer))&&("visible"!==pointer.style.visibility&&(pointer.style.visibility="visible"),"block"!==pointer.style.display&&(pointer.style.display="block"),pointer.style.top=e.y+"px",pointer.style.left=e.x+"px",pointer.map_x=e.x,pointer.map_y=e.y,update_pointer_size(),!0)}function jsCheckRectangle(e){if(!Array.isArray(e)||e.length<=1)return!0;const t=parseInt(MDS_OBJECT.grid_width,10)||1,o=new Set(e.map((e=>parseInt(e,10)))),i=new Set,n=new Set;for(const e of o){const o=e%t,r=Math.floor(e/t);i.add(o),n.add(r)}const r=Array.from(i).sort(((e,t)=>e-t)),a=Array.from(n).sort(((e,t)=>e-t));for(let e=1;e<r.length;e++)if(r[e]!==r[e-1]+1)return!1;for(let e=1;e<a.length;e++)if(a[e]!==a[e-1]+1)return!1;if(r.length*a.length!==o.size)return!1;for(const e of a)for(const i of r){const n=e*t+i;if(!o.has(n))return!1}return!0}function formSubmit(e){if(e.preventDefault(),e.stopPropagation(),""===$myblocks.html().trim())return messageout(MDS_OBJECT.no_blocks_selected),!1;if(!1===submitting){submitting=!0,submit_button1.disabled=!0;let e=submit_button1.value;submit_button1.value=MDS_OBJECT.WAIT;const t=parseInt(MDS_OBJECT.G_MIN_BLOCKS,10)||0,o=MDS_OBJECT.selection_adjacency_mode||"ADJACENT";if(t>0&&selectedBlocks.length<t)return messageout("You must select at least "+t+" blocks."),submitting=!1,submit_button1.disabled=!1,submit_button1.value=e,!1;if("RECTANGLE"===o&&!jsCheckRectangle(selectedBlocks))return messageout(MDS_OBJECT.rectangle_required||"Selection must form a rectangle or square."),submitting=!1,submit_button1.disabled=!1,submit_button1.value=e,!1;let i=setInterval((function(){if(0===ajax_queue.length&&(clearInterval(i),null!==pixel_form)){let e=document.getElementById("selected_pixels");e&&(e.value=selectedBlocks.join(",")),mds_update_package(jQuery(pixel_form)),pixel_form.submit()}}),1e3)}}function reset_pixels(){ajax_queue=[],add_ajax_loader(".mds-pixel-wrapper"),jQuery.ajax({type:"POST",url:MDS_OBJECT.UPDATE_ORDER,data:{reset:"true",action:"reset",_wpnonce:MDS_OBJECT.NONCE,BID:MDS_OBJECT.BID},success:function(e){!0===e.success&&e.data&&"removed"===e.data.type&&$myblocks.children().each((function(){remove_block(jQuery(this).data("blockid"))}))},error:function(e,t,o){},complete:function(){remove_ajax_loader()}})}function rescale_grid(){if(null==grid)return;let e=parseInt(jQuery(grid).attr("data-original-width"),10)||orig.GRD_WIDTH,t=parseInt(jQuery(grid).attr("data-original-height"),10)||orig.GRD_HEIGHT;grid_width=jQuery(grid).width(),grid_height=jQuery(grid).height(),scaled_width=grid_width/e,scaled_height=grid_height/t,"function"==typeof scaleImageMap&&scaleImageMap(),BLK_WIDTH=orig.BLK_WIDTH*scaled_width,BLK_HEIGHT=orig.BLK_HEIGHT*scaled_height,gridOffsetLeft=grid.offsetLeft,gridOffsetTop=grid.offsetTop,jQuery(pointer).rescaleStyles();let o=selectedBlocks.slice();$myblocks.empty(),o.length>0&&o.forEach((function(e){add_block(e)})),window.scaleImageMap&&"function"==typeof window.scaleImageMap&&window.scaleImageMap()}function center_block(e){let t=get_pointer_size();return e.x-=t.width/2-BLK_WIDTH/2,e.y-=t.height/2-BLK_HEIGHT/2,e}function IsNumeric(e){let t,o=!0;for(let i=0;i<e.length&&!0===o;i++)t=e.charAt(i),-1==="0123456789".indexOf(t)&&(o=!1);return o}function get_block_position(e){const t=Math.floor(orig.GRD_WIDTH/orig.BLK_WIDTH);return{x:e%t,y:Math.floor(e/t)}}function get_clicked_block(e,t){const o=e/scaled_width,i=t/scaled_height,n=Math.floor(o/orig.BLK_WIDTH),r=Math.floor(i/orig.BLK_HEIGHT)*Math.floor(orig.GRD_WIDTH/orig.BLK_WIDTH)+n;return Math.round(r)}function change_block_state(e,t){const o=get_clicked_block(e,t),i=parseInt(jQuery("#mds-selection-size-value").val(),10)||1,n=get_clicked_blocks(e,t,o),r=jQuery("#erase").is(":checked");let a=[],d=[],s="add";if(r?(s="remove",n.forEach((e=>{selectedBlocks.includes(e.id)&&d.push(e.id)}))):"YES"===MDS_OBJECT.INVERT_PIXELS?(s="invert",n.forEach((e=>{selectedBlocks.includes(e.id)?d.push(e.id):a.push(e.id)}))):(s="add",n.forEach((e=>{selectedBlocks.includes(e.id)||a.push(e.id)}))),a.forEach((e=>{add_block(e)})),d.forEach((e=>{remove_block(e)})),0===a.length&&0===d.length)return;const l=new URL(MDS_OBJECT.UPDATE_ORDER,window.location.origin);l.searchParams.set("selection_size",i),l.searchParams.set("user_id",MDS_OBJECT.user_id),l.searchParams.set("block_id",o.toString()),l.searchParams.set("BID",MDS_OBJECT.BID),l.searchParams.set("t",MDS_OBJECT.time),l.searchParams.set("_wpnonce",MDS_OBJECT.NONCE),l.searchParams.set("action",s);let c={action:s,clicked_block:o,OffsetX:e,OffsetY:t,blocks_to_add:a,blocks_to_remove:d,original_add:a,original_remove:d,url:l.toString()};ajax_queue.push(c)}function implode(e){let t="",o="";for(let i in e)e.hasOwnProperty(i)&&(t=t+o+e[i]),o=",";return t}let resizeTimer;function initializeGrid(){if(grid=document.getElementById("pixelimg"),$myblocks=jQuery("#blocks"),total_cost=document.getElementById("total_cost"),submit_button1=document.getElementById("submit_button1"),pointer=document.getElementById("block_pointer"),pixel_container=document.getElementById("pixel_container"),pixel_form=document.getElementById("pixel_form"),!(grid&&$myblocks.length&&pixel_container&&pointer))return;rescale_grid(),load_order();let e,t,o=!0;const i=Math.min(BLK_WIDTH,BLK_HEIGHT)/2;if(jQuery(pixel_container).on("mousedown",(function(i){o=!0,e=i.originalEvent.pageX,t=i.originalEvent.pageY})).on("mousemove",(function(n){if(o){let r=n.originalEvent.pageX,a=n.originalEvent.pageY;(Math.abs(e-r)>i||Math.abs(t-a)>i)&&(o=!1)}let r=center_block({x:n.originalEvent.pageX,y:n.originalEvent.pageY}),a=getOffset(r.x,r.y);if(null==a)return!1;show_pointer(a)})).on("click",(function(e){if(e.preventDefault(),o){let t=center_block({x:e.originalEvent.pageX,y:e.originalEvent.pageY}),o=getOffset(t.x,t.y);if(null==o)return!1;show_pointer(o),select_pixels(o)}return o=!0,!1})),has_touch()){new PointerListener(pixel_container,{supportedGestures:[Tap,Pinch,Pan]});pixel_container.addEventListener("tap",(function(e){let t=getOffset(e.detail.live.center.x,e.detail.live.center.y,!0);if(null==t)return!0;show_pointer(t),select_pixels(t)})),pixel_container.addEventListener("pinch",(function(e){e.preventDefault&&e.preventDefault();const t=e.detail.live.scale;!t||t<=0||applyZoom(t,e.detail.live.center.x,e.detail.live.center.y)})),pixel_container.addEventListener("pan",(function(e){window.mds_zoom<=1||(window.mds_pan_x+=e.detail.live.deltaX,window.mds_pan_y+=e.detail.live.deltaY,applyTransform())}))}function n(e){let t=jQuery("<div class='ajax-loader'></div>"),o=jQuery(e);o.length>0&&(o.append(t),t.css("z-index","10000").css("top",o.position().top).css("left",jQuery(e).width()/2-t.width()/2))}jQuery(grid).on("contextmenu",(e=>{e.preventDefault()})),submit_button1&&jQuery(submit_button1).on("click",formSubmit),jQuery("#reset_button").on("click",reset_pixels),setInterval((function(){if(0===ajax_queue.length||ajaxing)return;ajaxing=!0,n(jQuery(".mds-pixel-wrapper"));let e=ajax_queue.shift();jQuery.ajax({type:"POST",url:e.url,data:{_wpnonce:MDS_OBJECT.NONCE,action:e.action,block_id:e.clicked_block,selection_size:parseInt(jQuery("#mds-selection-size-value").val(),10)||1,BID:MDS_OBJECT.BID,blocks_to_add:e.blocks_to_add.join(","),blocks_to_remove:e.blocks_to_remove.join(",")},success:function(t){!0===t.success?t.data&&t.data.data&&(t.data.data.added&&Array.isArray(t.data.data.added)&&t.data.data.added.length>0&&do_blocks(t.data.data.added,"add"),t.data.data.removed&&Array.isArray(t.data.data.removed)&&t.data.data.removed.length>0&&do_blocks(t.data.data.removed,"remove"),"order_id"===t.data.data.type&&pixel_form&&(pixel_form.order_id.value=parseInt(t.data.data.value,10))):("invert"===e.action?(do_blocks(e.original_add,"remove"),do_blocks(e.original_remove,"add")):do_blocks(e.original_add,"remove"),t.data&&t.data.data&&t.data.data.value?messageout(t.data.data.value):messageout("An unknown error occurred."))},error:function(t,o,i){"invert"===e.action?(do_blocks(e.original_add,"remove"),do_blocks(e.original_remove,"add")):do_blocks(e.original_add,"remove");let n=null;t&&t.responseJSON&&t.responseJSON.data&&(t.responseJSON.data.data&&t.responseJSON.data.data.value?n=t.responseJSON.data.data.value:t.responseJSON.data.value&&(n=t.responseJSON.data.value)),messageout(n||"Request failed: "+o)},complete:function(){ajaxing=!1,remove_ajax_loader()}})}),100),n(jQuery(".mds-pixel-wrapper"));const r=jQuery("#mds-selection-size-slider"),a=jQuery("#mds-selection-size-value"),d=jQuery("#mds-total-blocks-value");if(r.length>0){r.on("input",(function(){const e=parseInt(jQuery(this).val()),t=Math.min(e,Math.min(GRD_WIDTH,GRD_HEIGHT));a.val(t),d.val(Math.pow(t,2)),update_pointer_size()})),a.on("input",(function(){const e=parseInt(jQuery(this).val()),t=Math.min(e,Math.min(GRD_WIDTH,GRD_HEIGHT));r.val(t),d.val(Math.pow(t,2)),update_pointer_size()}));let e,t=parseInt(d.val());d.on("input",(function(){let o=parseInt(jQuery(this).val());let i=o>t?Math.ceil(Math.sqrt(o)):Math.floor(Math.sqrt(o));const n=Math.min(i,Math.min(GRD_WIDTH,GRD_HEIGHT));r.val(n),a.val(n),clearTimeout(e),e=setTimeout((()=>{o=Math.pow(n,2),d.val(o),t=o,update_pointer_size()}),1e3)}))}if(0===jQuery("#reset_zoom_button").length){const e=jQuery("<button>",{id:"reset_zoom_button",class:"mds-reset-zoom",text:"Reset Zoom",css:{position:"absolute",right:"10px",top:"10px","z-index":"1000",padding:"5px 10px",background:"rgba(0,0,0,0.5)",color:"white",border:"none","border-radius":"4px",display:"none",cursor:"pointer"}});jQuery(".mds-pixel-wrapper").append(e),e.on("click",resetZoom)}}jQuery.fn.rescaleStyles=function(){return this.css({width:BLK_WIDTH+"px",height:BLK_HEIGHT+"px","line-height":BLK_HEIGHT+"px","font-size":BLK_HEIGHT+"px"}),this},jQuery.fn.repositionStyles=function(){if(void 0===this.attr("id"))return this;let e=get_block_position(parseInt(jQuery(this).data("blockid"),10));return this.css({top:e.y*BLK_HEIGHT+gridOffsetTop+"px",left:e.x*BLK_WIDTH+gridOffsetLeft+"px",width:BLK_WIDTH+"px",height:BLK_HEIGHT+"px"}),this},window.addEventListener("resize",(function(){clearTimeout(resizeTimer),resizeTimer=setTimeout((function(){rescale_grid()}),100)}));var gridInitialized=!1;const observerTarget=document.body,observerConfig={childList:!0,subtree:!0},mutationObserver=new MutationObserver(((e,t)=>{if(!gridInitialized)for(const o of e)if("childList"===o.type){const e=document.getElementById("pixelimg");if(e){const o=()=>{gridInitialized||(gridInitialized=!0,initializeGrid(),t.disconnect(),jQuery(".ajax-loader").remove())};e.complete?o():e.addEventListener("load",o);break}}}));function applyZoom(e,t,o){const i=window.mds_zoom||1,n=Math.min(3,i*e);n<1?resetZoom():(window.mds_zoom=n,n>1?jQuery("#reset_zoom_button").show():jQuery("#reset_zoom_button").hide(),applyTransform())}function applyTransform(){const e=jQuery(".mds-pixel-wrapper");if(!e.length)return;const t=`scale(${window.mds_zoom}) translate(${window.mds_pan_x/window.mds_zoom}px, ${window.mds_pan_y/window.mds_zoom}px)`;e.css({transform:t,"transform-origin":"center center",transition:"transform 0.1s"}),rescale_grid()}function resetZoom(){window.mds_zoom=1,window.mds_pan_x=0,window.mds_pan_y=0;jQuery(".mds-pixel-wrapper").css({transform:"none",transition:"transform 0.3s"}),jQuery("#reset_zoom_button").hide(),rescale_grid()}function scaleImageMap(){var e=document.getElementById("pixelimg");if(e){var t=parseInt(e.getAttribute("data-original-width"),10)||MDS_OBJECT.grid_data&&MDS_OBJECT.grid_data.orig_width_px||MDS_OBJECT.grid_width*MDS_OBJECT.BLK_WIDTH,o=parseInt(e.getAttribute("data-original-height"),10)||MDS_OBJECT.grid_data&&MDS_OBJECT.grid_data.orig_height_px||MDS_OBJECT.grid_height*MDS_OBJECT.BLK_HEIGHT,i=(e.clientWidth||e.offsetWidth)/t,n=(e.clientHeight||e.offsetHeight)/o,r=document.querySelectorAll(".gridblock");if(r&&r.length>0)for(var a=0;a<r.length;a++){var d=r[a],s=parseInt(d.getAttribute("data-x"),10)||0,l=parseInt(d.getAttribute("data-y"),10)||0;if(s&&l){var c=Math.round(s*i),_=Math.round(l*n);d.style.left=c+"px",d.style.top=_+"px"}}if(void 0!==window.mds_pointer_x&&void 0!==window.mds_pointer_y){c=Math.round(window.mds_pointer_x*i),_=Math.round(window.mds_pointer_y*n);var u=document.getElementById("block_pointer");u&&(u.style.left=c+"px",u.style.top=_+"px")}}}mutationObserver.observe(observerTarget,observerConfig),window.scaleImageMap=scaleImageMap;