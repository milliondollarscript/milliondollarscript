/*! @viselect/vanilla v3.6.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */
(function(E,g){typeof exports=="object"&&typeof module<"u"?module.exports=g():typeof define=="function"&&define.amd?define(g):(E=typeof globalThis<"u"?globalThis:E||self,E.SelectionArea=g())})(this,function(){"use strict";var W=Object.defineProperty;var X=(E,g,v)=>g in E?W(E,g,{enumerable:!0,configurable:!0,writable:!0,value:v}):E[g]=v;var d=(E,g,v)=>X(E,typeof g!="symbol"?g+"":g,v);class E{constructor(){d(this,"_listeners",new Map);d(this,"on",this.addEventListener);d(this,"off",this.removeEventListener);d(this,"emit",this.dispatchEvent)}addEventListener(l,e){const t=this._listeners.get(l)??new Set;return this._listeners.set(l,t),t.add(e),this}removeEventListener(l,e){var t;return(t=this._listeners.get(l))==null||t.delete(e),this}dispatchEvent(l,...e){let t=!0;for(const s of this._listeners.get(l)??[])t=s(...e)!==!1&&t;return t}unbindAllListeners(){this._listeners.clear()}}const g=(c,l="px")=>typeof c=="number"?c+l:c;function v({style:c},l,e){if(typeof l=="object")for(const[t,s]of Object.entries(l))s!==void 0&&(c[t]=g(s));else e!==void 0&&(c[l]=g(e))}const M=c=>(l,e,t,s={})=>{l instanceof HTMLCollection||l instanceof NodeList?l=Array.from(l):Array.isArray(l)||(l=[l]),Array.isArray(e)||(e=[e]);for(const o of l)if(o)for(const i of e)o[c](i,t,{capture:!1,...s});return[l,e,t,s]},A=M("addEventListener"),b=M("removeEventListener"),L=c=>{var s;const{clientX:l,clientY:e,target:t}=((s=c.touches)==null?void 0:s[0])??c;return{x:l,y:e,target:t}};function C(c,l,e="touch"){switch(e){case"center":{const t=l.left+l.width/2,s=l.top+l.height/2;return t>=c.left&&t<=c.right&&s>=c.top&&s<=c.bottom}case"cover":return l.left>=c.left&&l.top>=c.top&&l.right<=c.right&&l.bottom<=c.bottom;case"touch":return c.right>=l.left&&c.left<=l.right&&c.bottom>=l.top&&c.top<=l.bottom}}function w(c,l=document){const e=Array.isArray(c)?c:[c];let t=[];for(let s=0,o=e.length;s<o;s++){const i=e[s];typeof i=="string"?t=t.concat(Array.from(l.querySelectorAll(i))):i instanceof Element&&t.push(i)}return t}const j=()=>matchMedia("(hover: none), (pointer: coarse)").matches,q=()=>"safari"in window,K=c=>{let l,e=-1,t=!1;return{next(...s){l=s,t||(t=!0,e=requestAnimationFrame(()=>{c(...l),t=!1}))},cancel(){cancelAnimationFrame(e),t=!1}}};function H(c,l){for(const e of l){if(typeof e=="number")return c.button===e;if(typeof e=="object"){const t=e.button===c.button,s=e.modifiers.every(o=>{switch(o){case"alt":return c.altKey;case"ctrl":return c.ctrlKey||c.metaKey;case"shift":return c.shiftKey}});return t&&s}}return!1}const{abs:T,max:R,min:B,ceil:k}=Math,D=(c=[])=>({stored:c,selected:[],touched:[],changed:{added:[],removed:[]}});class O extends E{constructor(e){var i,n,r,h,p;super();d(this,"_options");d(this,"_selection",D());d(this,"_area");d(this,"_clippingElement");d(this,"_targetElement");d(this,"_targetBoundary");d(this,"_targetBoundaryScrolled",!0);d(this,"_targetRect");d(this,"_selectables",[]);d(this,"_latestElement");d(this,"_areaLocation",{y1:0,x2:0,y2:0,x1:0});d(this,"_areaRect",new DOMRect);d(this,"_singleClick",!0);d(this,"_frame");d(this,"_scrollAvailable",!0);d(this,"_scrollingActive",!1);d(this,"_scrollSpeed",{x:0,y:0});d(this,"_scrollDelta",{x:0,y:0});d(this,"disable",this._toggleStartEvents.bind(this,!1));d(this,"enable",this._toggleStartEvents);this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:(i=e.behaviour)!=null&&i.startThreshold?typeof e.behaviour.startThreshold=="number"?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...(n=e.behaviour)==null?void 0:n.scrolling,startScrollMargins:{x:0,y:0,...(h=(r=e.behaviour)==null?void 0:r.scrolling)==null?void 0:h.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...(p=e.features)==null?void 0:p.singleTap}}};for(const f of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))typeof this[f]=="function"&&(this[f]=this[f].bind(this));const{document:t,selectionAreaClass:s,selectionContainerClass:o}=this._options;this._area=t.createElement("div"),this._clippingElement=t.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(s),o&&this._clippingElement.classList.add(o),v(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),v(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=K(f=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",f),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:s}=this._options,o=e?A:b;o(t,"mousedown",this._onTapStart),s.touch&&o(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:o,target:i}=L(e),{document:n,startAreas:r,boundaries:h,features:p,behaviour:f}=this._options,a=i.getBoundingClientRect();if(e instanceof MouseEvent&&!H(e,f.triggers))return;const y=w(r,n),S=w(h,n);this._targetElement=S.find(x=>C(x.getBoundingClientRect(),a));const m=e.composedPath(),_=y.find(x=>m.includes(x));if(this._targetBoundary=S.find(x=>m.includes(x)),!this._targetElement||!_||!this._targetBoundary||!t&&this._emitEvent("beforestart",e)===!1)return;this._areaLocation={x1:s,y1:o,x2:0,y2:0};const u=n.scrollingElement??n.body;this._scrollDelta={x:u.scrollLeft,y:u.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),A(n,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),A(n,["mouseup","touchcancel","touchend"],this._onTapStop),A(n,"scroll",this._onScroll),p.deselectOnBlur&&(this._targetBoundaryScrolled=!1,A(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,o=L(e);let i;if(t==="native")i=o.target;else if(t==="touch"){this.resolveSelectables();const{x:r,y:h}=o;i=this._selectables.find(p=>{const{right:f,left:a,top:y,bottom:S}=p.getBoundingClientRect();return r<f&&r>a&&h<S&&h>y})}if(!i)return;for(this.resolveSelectables();!this._selectables.includes(i);)if(i.parentElement)i=i.parentElement;else{this._targetBoundaryScrolled||this.clearSelection();return}const{stored:n}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const r=this._latestElement,[h,p]=r.compareDocumentPosition(i)&4?[i,r]:[r,i],f=[...this._selectables.filter(a=>a.compareDocumentPosition(h)&4&&a.compareDocumentPosition(p)&2),h,p];this.select(f),this._latestElement=r}else n.includes(i)&&(n.length===1||e.ctrlKey||n.every(r=>this._selection.stored.includes(r)))?this.deselect(i):(this.select(i),this._latestElement=i)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:o}}=this._options,{x1:i,y1:n}=this._areaLocation,{x:r,y:h}=L(e);if(typeof o=="number"&&T(r+h-(i+n))>=o||typeof o=="object"&&T(r-i)>=o.x||T(h-n)>=o.y){if(b(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),this._emitEvent("beforedrag",e)===!1){b(s,["mouseup","touchcancel","touchend"],this._onTapStop);return}A(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),v(this._area,"display","block"),w(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(A(this._targetElement,"wheel",this._manualScroll,{passive:!1}),this._selectables=this._selectables.filter(p=>this._targetElement.contains(p))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,o=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(v(e,{top:o.top,left:o.left,width:o.width,height:o.height}),v(s,{marginTop:-o.top,marginLeft:-o.left})):(v(e,{top:0,left:0,width:"100%",height:"100%"}),v(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:s,_options:o,_frame:i}=this,{speedDivider:n}=o.behaviour.scrolling,r=this._targetElement,{x:h,y:p}=L(e);if(s.x2=h,s.y2=p,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const f=()=>{if(!t.x&&!t.y){this._scrollingActive=!1;return}const{scrollTop:a,scrollLeft:y}=r;t.y&&(r.scrollTop+=k(t.y/n),s.y1-=r.scrollTop-a),t.x&&(r.scrollLeft+=k(t.x/n),s.x1-=r.scrollLeft-y),i.next(e),requestAnimationFrame(f)};requestAnimationFrame(f)}else i.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&j()||this._scrollAvailable&&q())&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:o}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-o,this._areaLocation.y1+=e.y-s,e.x=o,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,b(this._targetElement,"scroll",this._onStartAreaScroll)}_manualScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,o=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=o*t,this._onTapMove(e),e.preventDefault()}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:s,_options:o}=this,{scrollTop:i,scrollHeight:n,clientHeight:r,scrollLeft:h,scrollWidth:p,clientWidth:f}=s,a=this._targetRect,{x1:y,y1:S}=t;let{x2:m,y2:_}=t;const{behaviour:{scrolling:{startScrollMargins:u}}}=o;m<a.left+u.x?(e.x=h?-T(a.left-m+u.x):0,m=m<a.left?a.left:m):m>a.right-u.x?(e.x=p-h-f?T(a.left+a.width-m-u.x):0,m=m>a.right?a.right:m):e.x=0,_<a.top+u.y?(e.y=i?-T(a.top-_+u.y):0,_=_<a.top?a.top:_):_>a.bottom-u.y?(e.y=n-i-r?T(a.top+a.height-_-u.y):0,_=_>a.bottom?a.bottom:_):e.y=0;const x=B(y,m),P=B(S,_),F=R(y,m),I=R(S,_);this._areaRect=new DOMRect(x,P,F-x,I-P)}_redrawSelectionArea(){const{x:e,y:t,width:s,height:o}=this._areaRect,{style:i}=this._area;i.left=`${e}px`,i.top=`${t}px`,i.width=`${s}px`,i.height=`${o}px`}_onTapStop(e,t){var n;const{document:s,features:o}=this._options,{_singleClick:i}=this;b(this._targetElement,"scroll",this._onStartAreaScroll),b(s,["mousemove","touchmove"],this._delayedTapMove),b(s,["touchmove","mousemove"],this._onTapMove),b(s,["mouseup","touchcancel","touchend"],this._onTapStop),b(s,"scroll",this._onScroll),this._keepSelection(),e&&i&&o.singleTap.allow?this._onSingleTap(e):!i&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,b(this._targetElement,"wheel",this._manualScroll,{passive:!0}),this._clippingElement.remove(),(n=this._frame)==null||n.cancel(),v(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:o}=this,{stored:i,selected:n,touched:r}=s,{intersect:h,overlap:p}=t.behaviour,f=p==="invert",a=[],y=[],S=[];for(let _=0;_<e.length;_++){const u=e[_];if(C(o,u.getBoundingClientRect(),h)){if(n.includes(u))i.includes(u)&&!r.includes(u)&&r.push(u);else if(f&&i.includes(u)){S.push(u);continue}else y.push(u);a.push(u)}}f&&y.push(...i.filter(_=>!n.includes(_)));const m=p==="keep";for(let _=0;_<n.length;_++){const u=n[_];!a.includes(u)&&!(m&&i.includes(u))&&S.push(u)}s.selected=a,s.changed={added:y,removed:S},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:o,touched:i,stored:n}=t,r=s.filter(h=>!n.includes(h));switch(e.behaviour.overlap){case"drop":{t.stored=[...r,...n.filter(h=>!i.includes(h))];break}case"invert":{t.stored=[...r,...n.filter(h=>!o.removed.includes(h))];break}case"keep":{t.stored=[...n,...s.filter(h=>!n.includes(h))];break}}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=w(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:o,changed:i}=this._selection;i.added=[],i.removed.push(...s,...e?o:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=D(e?[]:o)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:o,stored:i}=this._selection,n=w(e,this._options.document).filter(r=>!o.includes(r)&&!i.includes(r));return i.push(...n),o.push(...n),s.added.push(...n),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),n}deselect(e,t=!1){const{selected:s,stored:o,changed:i}=this._selection,n=w(e,this._options.document).filter(r=>s.includes(r)||o.includes(r));n.length&&(this._selection.stored=o.filter(r=>!n.includes(r)),this._selection.selected=s.filter(r=>!n.includes(r)),this._selection.changed.added=[],this._selection.changed.removed.push(...n.filter(r=>!i.removed.includes(r))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)))}}return d(O,"version","3.6.0"),O});
//# sourceMappingURL=viselect.umd.js.map
