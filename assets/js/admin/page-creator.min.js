(function($){let MDSPageCreator={config:{currentStep:1,totalSteps:4,selectedPageTypes:[],previewData:null},init:function(){this.bindEvents(),this.initializeSteps(),this.loadInitialState()},bindEvents:function(){$(document).on("change",'input[name="implementation_type"]',this.handleImplementationTypeChange.bind(this)),$(document).on("change",'input[name="page_types[]"]',this.handlePageTypeChange.bind(this)),$("#mds-preview-creation").on("click",this.handlePreviewCreation.bind(this)),$("#mds-create-pages").on("click",this.handleCreatePages.bind(this)),$("#mds-page-creator-form").on("submit",this.handleFormSubmit.bind(this)),$(document).on("click",".mds-step-nav",this.handleStepNavigation.bind(this))},initializeSteps:function(){$(".mds-creator-step").each(function(index){if(index===0)$(this).addClass("active");else $(this).addClass("inactive")})},loadInitialState:function(){this.updateSelectedPageTypes(),this.loadPageConfigurations()},handleImplementationTypeChange:function(e){let implementationType=$(e.target).val();if(this.updateImplementationInfo(implementationType),this.config.previewData)this.updatePreview()},handlePageTypeChange:function(e){this.updateSelectedPageTypes(),this.loadPageConfigurations(),this.updateCreateButton()},updateSelectedPageTypes:function(){this.config.selectedPageTypes=[],$('input[name="page_types[]"]:checked').each((index,element)=>{this.config.selectedPageTypes.push($(element).val())})},loadPageConfigurations:function(){if(this.config.selectedPageTypes.length===0){$("#mds-page-configurations").empty();return}let data={action:"mds_get_page_configuration",nonce:mdsPageCreator.nonce,page_types:this.config.selectedPageTypes};$("#mds-page-configurations").html('<div class="mds-loading">Loading configurations...</div>'),$.post(mdsPageCreator.ajaxUrl,data).done((response)=>{if(response.success)$("#mds-page-configurations").html(response.data.html),this.initializeConfigurationFields();else this.showError("Failed to load page configurations")}).fail(()=>{this.showError("Network error loading configurations")})},initializeConfigurationFields:function(){$(".mds-page-config select").each(function(){}),$('.mds-page-config input[type="number"]').on("change",function(){let min=parseFloat($(this).attr("min")),max=parseFloat($(this).attr("max")),value=parseFloat($(this).val());if(!isNaN(min)&&value<min)$(this).val(min);if(!isNaN(max)&&value>max)$(this).val(max)})},handlePreviewCreation:function(e){e.preventDefault();let formData=this.getFormData();if(!this.validateFormData(formData))return;$("#mds-preview-creation").prop("disabled",!0).text(mdsPageCreator.strings.preview);let data={action:"mds_get_creation_preview",nonce:mdsPageCreator.nonce,...formData};$.post(mdsPageCreator.ajaxUrl,data).done((response)=>{if(response.success)this.config.previewData=response.data,this.displayPreview(response.data),$("#mds-create-pages").prop("disabled",!1);else this.showError(response.data||"Preview generation failed")}).fail(()=>{this.showError("Network error generating preview")}).always(()=>{$("#mds-preview-creation").prop("disabled",!1).text("Preview Creation")})},handleCreatePages:function(e){e.preventDefault();let formData=this.getFormData();if(!this.validateFormData(formData))return;let confirmMessage=mdsPageCreator.strings.confirm_create;if(formData.create_mode==="update_existing")confirmMessage=mdsPageCreator.strings.confirm_update;if(!confirm(confirmMessage))return;$("#mds-create-pages").prop("disabled",!0).text(mdsPageCreator.strings.creating);let data={action:"mds_create_pages",nonce:mdsPageCreator.nonce,...formData};$.post(mdsPageCreator.ajaxUrl,data).done((response)=>{if(response.success)this.displayResults(response.data),this.showSuccess(mdsPageCreator.strings.success);else this.showError(response.data||"Page creation failed")}).fail(()=>{this.showError("Network error creating pages")}).always(()=>{$("#mds-create-pages").prop("disabled",!1).text("Create Pages")})},handleFormSubmit:function(e){e.preventDefault(),this.handleCreatePages(e)},getFormData:function(){let formData={};return formData.implementation_type=$('input[name="implementation_type"]:checked').val(),formData.page_types=[],$('input[name="page_types[]"]:checked').each(function(){formData.page_types.push($(this).val())}),formData.create_mode=$('input[name="create_mode"]:checked').val(),formData.configurations={},$(".mds-page-config").each(function(){let pageType=$(this).data("page-type");formData.configurations[pageType]={},$(this).find("input, select, textarea").each(function(){let name=$(this).attr("name");if(name&&name.includes(`[${pageType}]`)){let fieldName=name.match(/\[([^\]]+)\]$/)[1];if($(this).attr("type")==="checkbox")if(name.includes("[]")){if(!formData.configurations[pageType][fieldName])formData.configurations[pageType][fieldName]=[];if($(this).is(":checked"))formData.configurations[pageType][fieldName].push($(this).val())}else formData.configurations[pageType][fieldName]=$(this).is(":checked");else formData.configurations[pageType][fieldName]=$(this).val()}})}),formData},validateFormData:function(formData){if(!formData.implementation_type)return this.showError("Please select an implementation type"),!1;if(!formData.page_types||formData.page_types.length===0)return this.showError("Please select at least one page type"),!1;return!0},displayPreview:function(previewData){let html='<div class="mds-preview-summary">';if(html+=`<p><strong>Pages to create:</strong> ${previewData.pages_to_create.length}</p>`,html+=`<p><strong>Estimated time:</strong> ${previewData.estimated_time} seconds</p>`,html+="</div>",previewData.warnings&&previewData.warnings.length>0)html+='<div class="mds-preview-warnings">',html+="<h4>Warnings:</h4>",html+="<ul>",previewData.warnings.forEach((warning)=>{html+=`<li>${warning}</li>`}),html+="</ul>",html+="</div>";if(previewData.recommendations&&previewData.recommendations.length>0)html+='<div class="mds-preview-recommendations">',html+="<h4>Recommendations:</h4>",html+="<ul>",previewData.recommendations.forEach((recommendation)=>{html+=`<li>${recommendation}</li>`}),html+="</ul>",html+="</div>";html+='<div class="mds-preview-pages">',html+="<h4>Pages to be created:</h4>",html+='<table class="wp-list-table widefat fixed striped">',html+="<thead><tr><th>Page Type</th><th>Title</th><th>Implementation</th><th>Status</th></tr></thead>",html+="<tbody>",previewData.pages_to_create.forEach((page)=>{html+="<tr>",html+=`<td>${page.page_type}</td>`,html+=`<td>${page.title}</td>`,html+=`<td>${page.implementation_type}</td>`,html+=`<td>${page.existing_page?"Will update existing":"Will create new"}</td>`,html+="</tr>"}),html+="</tbody>",html+="</table>",html+="</div>",$("#mds-preview-content").html(html),$("#mds-creation-preview").show()},displayResults:function(results){let html='<div class="mds-results-summary">';if(html+=`<p><strong>Created:</strong> ${results.total_created} pages</p>`,html+=`<p><strong>Updated:</strong> ${results.total_updated} pages</p>`,html+=`<p><strong>Errors:</strong> ${results.total_errors}</p>`,html+="</div>",results.created_pages&&results.created_pages.length>0)html+='<div class="mds-results-created">',html+="<h4>Created Pages:</h4>",html+="<ul>",results.created_pages.forEach((page)=>{html+=`<li><a href="${page.page_url}" target="_blank">${page.page_title}</a> (${page.page_type})</li>`}),html+="</ul>",html+="</div>";if(results.updated_pages&&results.updated_pages.length>0)html+='<div class="mds-results-updated">',html+="<h4>Updated Pages:</h4>",html+="<ul>",results.updated_pages.forEach((page)=>{html+=`<li><a href="${page.page_url}" target="_blank">${page.page_title}</a> (${page.page_type})</li>`}),html+="</ul>",html+="</div>";if(results.errors&&results.errors.length>0)html+='<div class="mds-results-errors">',html+="<h4>Errors:</h4>",html+="<ul>",results.errors.forEach((error)=>{html+=`<li class="error">${error}</li>`}),html+="</ul>",html+="</div>";$("#mds-results-content").html(html),$("#mds-creation-results").show(),$("html, body").animate({scrollTop:$("#mds-creation-results").offset().top},500)},updateImplementationInfo:function(implementationType){$(".mds-implementation-option").removeClass("selected"),$(`input[value="${implementationType}"]`).closest(".mds-implementation-option").addClass("selected")},updateCreateButton:function(){let hasSelection=$('input[name="page_types[]"]:checked').length>0,hasImplementationType=$('input[name="implementation_type"]:checked').length>0;$("#mds-preview-creation").prop("disabled",!(hasSelection&&hasImplementationType))},showError:function(message){let notice=$('<div class="notice notice-error is-dismissible"><p>'+message+"</p></div>");$(".mds-create-pages h1").after(notice),setTimeout(()=>{notice.fadeOut()},5000)},showSuccess:function(message){let notice=$('<div class="notice notice-success is-dismissible"><p>'+message+"</p></div>");$(".mds-create-pages h1").after(notice),setTimeout(()=>{notice.fadeOut()},5000)},handleStepNavigation:function(e){e.preventDefault();let targetStep=$(e.target).data("step");this.goToStep(targetStep)},goToStep:function(stepNumber){if(stepNumber<1||stepNumber>this.config.totalSteps)return;$(".mds-creator-step").removeClass("active").addClass("inactive"),$(`.mds-creator-step[data-step="${stepNumber}"]`).removeClass("inactive").addClass("active"),this.config.currentStep=stepNumber}};$(document).ready(function(){if($(".mds-create-pages").length>0)MDSPageCreator.init()})})(jQuery);
