(d=>{let c={create:function(e,t,s,a=null){var o=d("<div>",{class:"mds-notification-modal",id:"mds-notification-modal"}),i=d("<div>",{class:"mds-modal-overlay"}),r=d("<div>",{class:"mds-modal-content mds-"+e}),t=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text(t),d("<button>",{class:"mds-modal-close",type:"button","aria-label":"Close"}).html("&times;")),e=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:`mds-notification-icon mds-${e}-icon`}),d("<div>",{class:"mds-notification-content"}).append(d("<p>").html(s)));if(a&&0<a.length){let t=d("<div>",{class:"mds-notification-details"}).append(d("<h4>").text("Details"),d("<ul>"));a.forEach(function(e){t.find("ul").append(d("<li>").text(e))}),e.find(".mds-notification-content").append(t)}s=d("<div>",{class:"mds-modal-footer"}).append(d("<button>",{class:"button button-primary mds-modal-close",type:"button"}).text("OK"));return r.append(t,e,s),o.append(i,r),o},show:function(e,t,s,a=null,o=null){this.hide();e=this.create(e,t,s,a);d("body").append(e),e.fadeIn(300),e.find(".mds-modal-content").addClass("mds-modal-show"),e.find(".mds-modal-close").on("click",function(){c.hide(),o&&"function"==typeof o&&o()}),e.find(".mds-modal-overlay").on("click",function(){c.hide()}),d(document).on("keydown.mds-modal",function(e){27===e.keyCode&&c.hide()})},hide:function(){let e=d("#mds-notification-modal, #mds-confirmation-modal");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()})),d(document).off("keydown.mds-modal")},showConfirmation:function(e,t,s,a=null){this.hide();var o=d("<div>",{class:"mds-notification-modal",id:"mds-confirmation-modal"}),i=d("<div>",{class:"mds-modal-overlay"}),r=d("<div>",{class:"mds-modal-content mds-info"}),e=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text(e),d("<button>",{class:"mds-modal-close",type:"button","aria-label":"Close"}).html("&times;")),t=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:"mds-notification-icon mds-info-icon"}),d("<div>",{class:"mds-notification-content"}).append(d("<p>").html(t))),n=d("<div>",{class:"mds-modal-footer"}).append(d("<button>",{class:"button mds-modal-cancel",type:"button"}).text("Cancel"),d("<button>",{class:"button button-primary mds-modal-confirm",type:"button"}).text("OK"));r.append(e,t,n),o.append(i,r),d("body").append(o),o.fadeIn(300),o.find(".mds-modal-content").addClass("mds-modal-show"),o.find(".mds-modal-close, .mds-modal-cancel, .mds-modal-overlay").on("click",function(){c.hide(),a&&"function"==typeof a&&a()}),o.find(".mds-modal-confirm").on("click",function(){c.hide(),s&&"function"==typeof s&&s()}),d(document).on("keydown.mds-modal",function(e){27===e.keyCode&&(c.hide(),a)&&"function"==typeof a&&a()})}},r={config:{ajaxUrl:mdsPageManagement.ajaxUrl,nonce:mdsPageManagement.nonce,strings:mdsPageManagement.strings},progressInterval:null,currentProgress:0,operationState:{isRunning:!1,operationType:null,startTime:null},init:function(){this.bindEvents(),this.initializeFilters(),this.initializeModals(),this.loadInitialData()},bindEvents:function(){d("#mds-scan-all-pages").on("click",this.scanAllPages.bind(this)),d("#mds-repair-all-issues").on("click",this.repairAllPages.bind(this)),d("#mds-export-page-data").on("click",this.exportData.bind(this)),d("#mds-refresh-list").on("click",this.refreshData.bind(this)),"function"==typeof this.bulkUpdateImplementations&&d("#mds-bulk-update-implementations").on("click",this.bulkUpdateImplementations.bind(this)),"function"==typeof this.validateAllPages&&d("#mds-validate-all-pages").on("click",this.validateAllPages.bind(this)),d("#mds-scan-errors").on("click",this.scanForErrors.bind(this)),d("#mds-fix-all-errors").on("click",this.fixAllErrors.bind(this)),d("#mds-reset-page-statuses").on("click",this.resetPageStatuses.bind(this)),d(document).on("click",".mds-status-help-link",this.showPageErrorHelp.bind(this)),d("#mds-filter-form").on("submit",this.applyFilters.bind(this)),d(".mds-clear-filters").on("click",this.clearFilters.bind(this)),d(document).on("click",".mds-view-details",this.viewPageDetails.bind(this)),d(document).on("click",".mds-scan-page",this.scanSinglePage.bind(this)),d(document).on("click",".mds-repair-page",this.repairSinglePage.bind(this)),d(document).on("click",".mds-configure-page",this.configurePage.bind(this)),d("#doaction, #doaction2").on("click",this.handleBulkAction.bind(this)),d(document).on("click",".mds-modal-close",this.closeModal.bind(this)),d(document).on("click",".mds-modal",function(e){e.target===this&&r.closeModal()}),mdsPageManagement.autoRefresh&&setInterval(this.refreshStats.bind(this),3e4)},initializeFilters:function(){d("#mds-page-type-filter, #mds-status-filter, #mds-implementation-filter").on("change",function(){d("#mds-filter-form").submit()});let e;d("#mds-search-input").on("input",function(){clearTimeout(e),e=setTimeout(function(){d("#mds-filter-form").submit()},500)})},initializeModals:function(){},loadInitialData:function(){this.refreshStats()},startOperation:function(e){return this.operationState.isRunning?(this.showNotice("warning",`Another operation (${this.operationState.operationType}) is already running. Please wait for it to complete.`),!1):(this.operationState.isRunning=!0,this.operationState.operationType=e,this.operationState.startTime=Date.now(),!0)},endOperation:function(){this.operationState.isRunning=!1,this.operationState.operationType=null,this.operationState.startTime=null},isOperationRunning:function(){return this.operationState.isRunning},scanAllPages:function(e){e.preventDefault(),this.startOperation("Scan All Pages")&&(e=this.config.strings.confirm_scan_all||"Are you sure you want to scan all pages? This will check all published pages for MDS content and may take some time.",c.showConfirmation("Confirm Scan All Pages",e,()=>{this.startChunkedScan()},()=>{this.endOperation()}))},startChunkedScan:function(){this.showProgress("Initializing scan...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_all_pages_start",nonce:this.config.nonce},success:function(e){e.success?r.processScanBatches(e.data):(r.showNotice("error",e.data||"Failed to initialize scan"),r.hideProgress(),r.endOperation())},error:function(){r.showNotice("error","An error occurred while initializing scan."),r.hideProgress(),r.endOperation()}})},processScanBatches:function(e){let{scan_id:a,total_pages:t,total_batches:s}=e,o=0,i=()=>{var e;o>=s?this.completeScan(a,t):(e=`Scanning pages ${10*o+1}-${Math.min(10*(o+1),t)} of ${t}...`,this.updateProgress(e,this.currentProgress),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_all_pages_batch",scan_id:a,batch_number:o,nonce:this.config.nonce},success:function(e){var t,s;e.success?(t=e.data,o++,s=`Processed ${t.processed_pages} of ${t.total_pages} pages (${t.found_pages} MDS pages found)`,r.updateProgress(s,t.progress_percentage),t.is_complete?r.completeScan(a,t.total_pages,t.found_pages):setTimeout(i,200)):(r.showNotice("error",e.data||"Batch processing failed"),r.hideProgress(),r.endOperation())},error:function(){r.showNotice("error","Error processing batch "+(o+1)),r.hideProgress(),r.endOperation()}}))};i()},completeScan:function(e,t,s){this.updateProgress("Scan completed!",100),setTimeout(()=>{this.hideProgress(),this.endOperation();var e=void 0!==s?`Scan completed! Processed ${t} pages and found ${s} MDS pages.`:`Scan completed! Processed ${t} pages.`;c.show("success","Scan Complete",e,null,function(){r.refreshData()})},2e3)},repairAllPages:function(e){e.preventDefault(),confirm(this.config.strings.confirm_repair_all)&&(this.showProgress("Repairing pages...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_repair_all_pages",nonce:this.config.nonce},success:function(e){e.success?c.show("success","Repair Complete",e.data.message,null,function(){r.refreshData()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while repairing pages.")},complete:function(){r.hideProgress()}}))},exportData:function(e){e.preventDefault();var t=d(e.target).data("format")||"json",e=d(e.target).data("include-content")||!1,s=d("<form>").attr("method","POST").attr("action",this.config.ajaxUrl).css("display","none");s.append(d("<input>").attr("name","action").val("mds_export_page_data")),s.append(d("<input>").attr("name","nonce").val(this.config.nonce)),s.append(d("<input>").attr("name","format").val(t)),s.append(d("<input>").attr("name","include_content").val(e?"1":"")),d("body").append(s),s.submit(),s.remove(),this.showNotice("success","Export started. Download should begin shortly.")},refreshData:function(e){e&&e.preventDefault(),this.showProgress("Refreshing data...",0),window.location.reload()},bulkUpdateImplementations:function(e){e.preventDefault(),this.showNotice("info","Bulk Update Implementations feature is coming soon! This will allow you to convert multiple pages between shortcode and block implementations at once.")},validateAllPages:function(e){e.preventDefault(),this.showNotice("info","Validate All Pages feature is coming soon! This will check all pages for proper MDS content and functionality.")},refreshStats:function(){d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_stats",nonce:this.config.nonce},success:function(e){e.success&&r.updateStats(e.data)}})},updateStats:function(e){d(".mds-stat-card.total .mds-stat-number").text(e.total||0),d(".mds-stat-card.active .mds-stat-number").text(e.active||0),d(".mds-stat-card.needs-attention .mds-stat-number").text(e.needs_attention||0),d(".mds-stat-card.auto-detected .mds-stat-number").text(e.auto_detected||0)},applyFilters:function(e){e.preventDefault();e=d(e.target).serialize();let s=new URL(window.location);new URLSearchParams(e).forEach((e,t)=>{e?s.searchParams.set(t,e):s.searchParams.delete(t)}),window.location.href=s.toString()},clearFilters:function(e){e.preventDefault(),d("#mds-filter-form")[0].reset();e=new URL(window.location);e.search="",window.location.href=e.toString()},viewPageDetails:function(e){e.preventDefault();e=d(e.target).closest("[data-page-id]").data("page-id");this.showProgress("Loading page details...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_details",page_id:e,nonce:this.config.nonce},success:function(e){e.success?r.showPageDetailsModal(e.data):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while loading page details.")},complete:function(){r.hideProgress()}})},scanSinglePage:function(e){e.preventDefault();var t=d(e.target).closest("[data-page-id]").data("page-id");let s=d(e.target).closest("button");s.prop("disabled",!0).html('<span class="mds-spinner"></span> Scanning...'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_single_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?c.show("success","Page Scan Complete",e.data.message,null,function(){window.location.reload()}):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while scanning the page.")},complete:function(){s.prop("disabled",!1).html('<span class="dashicons dashicons-search"></span>')}})},repairSinglePage:function(e){e.preventDefault();var t=d(e.target).closest("[data-page-id]").data("page-id");let s=d(e.target).closest("button");confirm(this.config.strings.confirm_repair_page)&&(s.prop("disabled",!0).html('<span class="mds-spinner"></span> Repairing...'),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_repair_single_page",page_id:t,nonce:this.config.nonce},success:function(e){e.success?(c.show("success","Page Repair Complete",e.data.message),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while repairing the page.")},complete:function(){s.prop("disabled",!1).html('<span class="dashicons dashicons-admin-tools"></span>')}}))},configurePage:function(e){e.preventDefault();e=d(e.target).closest("[data-page-id]").data("page-id");this.showProgress("Loading configuration...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_get_page_config",page_id:e,nonce:this.config.nonce},success:function(e){e.success?r.showConfigurationModal(e.data):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while loading configuration.")},complete:function(){r.hideProgress()}})},handleBulkAction:function(e){e.preventDefault();var e=d(e.target).siblings("select").val(),t=d('input[name="page_ids[]"]:checked').map(function(){return this.value}).get();e&&0!==t.length?confirm(`Are you sure you want to ${e} ${t.length} page(s)?`)&&(this.showProgress(`Processing ${e}...`,0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_bulk_action",bulk_action:e,page_ids:t,nonce:this.config.nonce},success:function(e){e.success?(c.show("success","Bulk Action Complete",e.data.message),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while processing the bulk action.")},complete:function(){r.hideProgress()}})):this.showNotice("warning","Please select pages and an action.")},showPageDetailsModal:function(e){d("#mds-page-details-content").html(e.html),d("#mds-page-details-modal").dialog({modal:!0,width:800,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,close:function(){d("#mds-page-details-content").empty()}}),d(".mds-fix-error-btn").off("click").on("click",function(){var e=d(this).data("page-id"),s=d(this).data("error");if(confirm("Are you sure you want to fix this error?")){let t=d(this);t.prop("disabled",!0).text("Fixing..."),d.ajax({url:r.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_page_error",page_id:e,error:JSON.stringify(s),nonce:r.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),t.closest(".mds-error-item").fadeOut(),setTimeout(function(){window.location.reload()},1e3)):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){t.prop("disabled",!1).text("Fix This Error")}})}})},showConfigurationModal:function(e){var t=`
                <form id="mds-page-config-form" data-original-implementation="${e.content_type}">
                    <input type="hidden" name="page_id" value="${e.page_id}">
                    <table class="form-table">
                        <tr>
                            <th><label for="page_type">Page Type</label></th>
                            <td>
                                <select name="page_type" id="page_type">
                                    ${this.getPageTypeOptions(e.page_type)}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="implementation_type">Implementation</label></th>
                            <td>
                                <select name="implementation_type" id="implementation_type">
                                    ${this.getImplementationOptions(e.content_type)}
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th><label for="auto_scan">Auto Scan</label></th>
                            <td>
                                <input type="checkbox" name="auto_scan" id="auto_scan" ${e.auto_scan?"checked":""}>
                                <label for="auto_scan">Automatically scan this page for changes</label>
                            </td>
                        </tr>
                    </table>
                </form>
            `;d("#mds-page-config-modal").html(t),d("#mds-page-config-modal").dialog({modal:!0,title:"Configure Page: "+e.title,width:600,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,buttons:{Cancel:function(){d(this).dialog("close")},"Save Configuration":function(){r.savePageConfig()}},close:function(){d("#mds-page-config-modal").empty()}})},getPageTypeOptions:function(e){var t,s;let a="";for([t,s]of Object.entries({grid:"Pixel Grid",order:"Order Page","write-ad":"Write Advertisement","confirm-order":"Order Confirmation",payment:"Payment Processing",manage:"Manage Ads","thank-you":"Thank You",list:"Advertiser List",upload:"File Upload","no-orders":"No Orders"}))a+=`<option value="${t}" ${t===e?"selected":""}>${s}</option>`;return a},getImplementationOptions:function(e){var t,s;let a="";for([t,s]of Object.entries({shortcode:"Shortcode",block:"Block"}))a+=`<option value="${t}" ${t===e?"selected":""}>${s}</option>`;return a},savePageConfig:function(){var e=d("#mds-page-config-form").serialize(),t=d("#mds-page-config-form").data("original-implementation"),s=d("#implementation_type").val();t&&t!==s&&!confirm("Changing the implementation type will convert the page content. Are you sure you want to continue?")||d.ajax({url:this.config.ajaxUrl,type:"POST",data:e+"&action=mds_save_page_config&nonce="+this.config.nonce+"&convert_implementation=1",success:function(e){e.success?(c.show("success","Configuration Saved",e.data.message),d("#mds-page-config-modal").dialog("close"),setTimeout(function(){window.location.reload()},2e3)):r.showNotice("error",e.data.message)},error:function(){r.showNotice("error","An error occurred while saving configuration.")}})},closeModal:function(){d("#mds-page-details-modal").hasClass("ui-dialog-content")&&d("#mds-page-details-modal").dialog("close"),d("#mds-page-config-modal").hasClass("ui-dialog-content")&&d("#mds-page-config-modal").dialog("close")},showProgress:function(t,s=0){if(0!==s||d("#mds-progress-indicator").length||(this.currentProgress=0),!d("#mds-progress-indicator").length){let e=d("<div>",{class:"mds-notification-modal",id:"mds-progress-indicator"});var a=d("<div>",{class:"mds-modal-overlay"}),o=d("<div>",{class:"mds-modal-content mds-progress-content"}),i=d("<div>",{class:"mds-modal-header"}).append(d("<h3>").text("Processing...")),r=d("<div>",{class:"mds-modal-body"}).append(d("<div>",{class:"mds-progress-spinner"}).append(d("<div>",{class:"mds-spinner"})),d("<div>",{class:"mds-progress"}).append(d("<div>",{class:"mds-progress-bar",id:"mds-progress-bar",style:`width: ${Math.max(s,10)}%`}).text(Math.round(s)+"%")),d("<p>",{class:"mds-progress-message",id:"mds-progress-message"}).text(t));o.append(i,r),e.append(a,o),d("body").append(e)}i=Math.max(s,this.currentProgress),this.currentProgress=i,r=Math.max(i,10);d("#mds-progress-message").text(t),d("#mds-progress-bar").css("width",r+"%").text(Math.round(i)+"%");let e=d("#mds-progress-indicator");e.fadeIn(300),e.find(".mds-modal-content").addClass("mds-modal-show"),0===s&&0===this.currentProgress&&this.startSimulatedProgress()},updateProgress:function(e,t){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null);var t=Math.max(t,this.currentProgress),s=(this.currentProgress=t,Math.max(t,10));d("#mds-progress-message").text(e),d("#mds-progress-bar").css("width",s+"%").text(Math.round(t)+"%")},startSimulatedProgress:function(){this.progressInterval&&clearInterval(this.progressInterval);let t=10;this.progressInterval=setInterval(()=>{var e;this.progressInterval&&(e=3*Math.random()+1,t=Math.min(t+e,75),(e=d("#mds-progress-bar")).length&&e.css("width",t+"%").text(Math.round(t)+"%"),75<=t)&&(clearInterval(this.progressInterval),this.progressInterval=null)},300+200*Math.random())},hideProgress:function(){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=null),this.currentProgress=0;let e=d("#mds-progress-indicator");e.length&&(e.find(".mds-modal-content").removeClass("mds-modal-show"),e.fadeOut(300,function(){e.remove()}))},scanForErrors:function(e){e.preventDefault();let t=d(e.target);e=d("#mds-error-results");let s=d("#mds-error-progress");var a=d("#mds-error-progress-text");let o=d("#mds-fix-all-errors");t.prop("disabled",!0),s.show(),a.text("Scanning for errors..."),e.hide(),o.hide(),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_errors",nonce:this.config.nonce},success:function(e){e.success?(r.displayErrorResults(e.data),0<e.data.auto_fixable&&o.show().text(`Fix ${e.data.auto_fixable} Auto-Fixable Errors`)):r.showNotice("error","Error scanning failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while scanning for errors.")},complete:function(){t.prop("disabled",!1),s.hide()}})},fixAllErrors:function(s){if(s.preventDefault(),confirm("Are you sure you want to fix all auto-fixable errors? This will modify page content.")){let e=d(s.target),t=d("#mds-error-progress");s=d("#mds-error-progress-text");e.prop("disabled",!0),t.show(),s.text("Fixing errors..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_all_errors",nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success",e.data.message),d("#mds-scan-errors").trigger("click"),r.refreshStats()):r.showNotice("error","Error fixing failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while fixing errors.")},complete:function(){e.prop("disabled",!1),t.hide()}})}},resetPageStatuses:function(s){if(s.preventDefault(),confirm("Are you sure you want to reset all page statuses? This will re-validate all pages and update their statuses based on current validation rules.")){let e=d(s.target),t=d("#mds-error-progress");s=d("#mds-error-progress-text");e.prop("disabled",!0),t.show(),s.text("Resetting page statuses..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_reset_page_statuses",nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success",e.data.message),setTimeout(function(){window.location.reload()},1500)):r.showNotice("error","Status reset failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while resetting page statuses.")},complete:function(){e.prop("disabled",!1),t.hide()}})}},displayErrorResults:function(e){var t=d("#mds-error-results"),s=t.find(".mds-error-list");if(0===e.total_errors)s.html('<div class="mds-no-errors"><p>No errors found! All pages appear to be functioning correctly.</p></div>');else{let a="";e.errors.forEach(function(e){var t=e.auto_fixable?"auto-fixable":"manual-fix",s="high"===e.severity?"critical":"";a+=`
                        <div class="mds-error-item ${t} ${s}" data-page-id="${e.page_id}">
                            <div class="mds-error-item-content">
                                <div class="mds-error-item-title">
                                    <span class="dashicons dashicons-warning"></span>
                                    ${e.page_title} - ${e.message}
                                </div>
                                <div class="mds-error-item-details">
                                    ${e.description}
                                </div>
                                <div class="mds-error-item-meta">
                                    <span class="error-type">Type: ${e.type}</span>
                                    <span class="error-severity">Severity: ${e.severity}</span>
                                    <span class="error-fixable">${e.auto_fixable?"Auto-fixable":"Manual fix required"}</span>
                                </div>
                            </div>
                            <div class="mds-error-item-actions">
                                <button type="button" class="button button-small mds-view-error-details" data-error='${JSON.stringify(e)}'>
                                    Details
                                </button>
                                ${e.auto_fixable?'<button type="button" class="button button-primary button-small mds-fix-single-error" data-error=\''+JSON.stringify(e)+"'>Fix</button>":""}
                            </div>
                        </div>
                    `}),s.html(a)}t.show(),d(".mds-view-error-details").off("click").on("click",this.showErrorDetails.bind(this)),d(".mds-fix-single-error").off("click").on("click",this.fixSingleError.bind(this))},showErrorDetails:function(e){e=JSON.parse(d(e.target).attr("data-error"));let t=`
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Page:</div>
                    <div class="mds-error-detail-value">${e.page_title} (ID: ${e.page_id})</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Error Type:</div>
                    <div class="mds-error-detail-value">${e.type}</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Severity:</div>
                    <div class="mds-error-detail-value">${e.severity}</div>
                </div>
                <div class="mds-error-detail">
                    <div class="mds-error-detail-label">Description:</div>
                    <div class="mds-error-detail-value">${e.description}</div>
                </div>
            `;e.suggested_fix&&(t+=`
                    <div class="mds-suggested-fixes">
                        <h4>Suggested Fix:</h4>
                        <div class="mds-suggested-fix ${e.auto_fixable?"mds-auto-fixable":""}">
                            <div class="mds-suggested-fix-title">${e.auto_fixable?"Automatic Fix Available":"Manual Fix Required"}</div>
                            <div class="mds-suggested-fix-description">
                                <code>${e.suggested_fix}</code>
                            </div>
                        </div>
                    </div>
                `),d("#mds-error-modal").length?(d("#mds-modal-title").text("Error Details"),d("#mds-modal-body").html(t),d("#mds-modal-fix").toggle(e.auto_fixable).attr("data-error",JSON.stringify(e)),d("#mds-error-modal").show()):alert("Error Details:\n\nPage: "+e.page_title+"\nType: "+e.type+"\nDescription: "+e.description)},fixSingleError:function(e){var t=JSON.parse(d(e.target).attr("data-error"));let s=d(e.target);confirm(`Are you sure you want to fix this error on "${t.page_title}"?`)&&(s.prop("disabled",!0).text("Fixing..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_error",error:JSON.stringify(t),nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),s.closest(".mds-error-item").fadeOut(),r.refreshStats()):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){s.prop("disabled",!1).text("Fix")}}))},showPageErrorHelp:function(e){e.preventDefault();let t=d(e.target).closest("[data-page-id]").data("page-id")||d(e.target).data("page-id");t?(this.showProgress("Scanning page for specific errors...",0),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_scan_page_errors",page_id:t,nonce:this.config.nonce},success:function(e){e.success?e.data.errors&&0<e.data.errors.length?r.showPageErrorModal(e.data,t):r.showNotice("info","No specific errors found for this page. It may have resolved automatically."):r.showNotice("error","Error scanning failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while scanning the page.")},complete:function(){r.hideProgress()}})):this.showNotice("error","Unable to identify page for error scanning")},showPageErrorModal:function(e,s){var t=e.errors;let a=`
                <div class="mds-page-error-help">
                    <h3>Errors found for: ${e.page_title||"Page ID "+s}</h3>
                    <p>The following issues were detected on this page:</p>
                    <div class="mds-page-errors-list">
            `;t.forEach(function(e){var t=e.auto_fixable?'<span class="dashicons dashicons-yes-alt" style="color: #46b450;"></span>':'<span class="dashicons dashicons-warning" style="color: #ffb900;"></span>';a+=`
                    <div class="mds-page-error-item ${e.auto_fixable?"auto-fixable":"manual-fix"}">
                        <div class="mds-error-header">
                            ${t}
                            <strong>${e.message}</strong>
                            <span class="mds-error-severity mds-severity-${e.severity}">${e.severity}</span>
                        </div>
                        <div class="mds-error-description">${e.description}</div>
                        ${e.suggested_fix?`<div class="mds-error-fix"><strong>Suggested Fix:</strong> <code>${e.suggested_fix}</code></div>`:""}
                        ${e.auto_fixable?`<button type="button" class="button button-primary button-small mds-fix-page-error" data-page-id="${s}" data-error='${JSON.stringify(e)}'>Apply Fix</button>`:"<p><em>This error requires manual intervention.</em></p>"}
                    </div>
                `}),a+=`
                    </div>
                    <div class="mds-error-help-actions">
                        <button type="button" class="button button-secondary mds-rescan-page" data-page-id="${s}">Re-scan Page</button>
                        <button type="button" class="button mds-view-all-errors">View All Page Errors</button>
                    </div>
                </div>
            `,d.fn.dialog?(0===d("#mds-page-error-help-modal").length&&d("body").append('<div id="mds-page-error-help-modal" style="display: none;"></div>'),d("#mds-page-error-help-modal").html(a),d("#mds-page-error-help-modal").dialog({title:"Page Error Details & Solutions",modal:!0,width:700,maxHeight:.8*d(window).height(),resizable:!0,draggable:!0,close:function(){d(this).empty()}}),d(".mds-fix-page-error").on("click",this.fixSinglePageError.bind(this)),d(".mds-rescan-page").on("click",function(){d("#mds-page-error-help-modal").dialog("close"),d(`.mds-status-help-link[data-page-id="${s}"]`).trigger("click")}),d(".mds-view-all-errors").on("click",function(){d("#mds-page-error-help-modal").dialog("close"),d("#mds-scan-errors").trigger("click"),setTimeout(function(){d("html, body").animate({scrollTop:d("#mds-error-results").offset().top-50},500)},500)})):alert("Page Errors Found:\n\n"+t.map(e=>e.message+": "+e.description).join("\n\n"))},fixSinglePageError:function(e){var t=d(e.target).data("page-id"),s=JSON.parse(d(e.target).attr("data-error"));let a=d(e.target);confirm(`Fix this error: "${s.message}"?`)&&(a.prop("disabled",!0).text("Fixing..."),d.ajax({url:this.config.ajaxUrl,type:"POST",data:{action:"mds_fix_single_page_error",page_id:t,error:JSON.stringify(s),nonce:this.config.nonce},success:function(e){e.success?(r.showNotice("success","Error fixed successfully"),a.closest(".mds-page-error-item").fadeOut(),r.refreshStats(),setTimeout(function(){window.location.reload()},1e3)):r.showNotice("error","Fix failed: "+e.data)},error:function(){r.showNotice("error","An error occurred while applying the fix.")},complete:function(){a.prop("disabled",!1).text("Apply Fix")}}))},showNotice:function(e,t){var s="error"===e?"Error":"success"===e?"Success":"warning"===e?"Warning":"Information";c.show(e,s,t)}};d(document).ready(function(){"undefined"!=typeof mdsPageManagement&&mdsPageManagement?r.init():console.error("MDS Page Management: Localization object not found. Please ensure the page management interface is properly loaded.")}),window.MDSPageManagement=r})(jQuery);